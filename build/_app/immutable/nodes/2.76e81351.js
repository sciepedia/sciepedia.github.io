var _e=Object.defineProperty;var be=(l,t,e)=>t in l?_e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var L=(l,t,e)=>(be(l,typeof t!="symbol"?t+"":t,e),e);import{S as Ee,i as Ce,s as Le,k as A,a as Y,q as oe,l as j,m as I,h as w,c as K,r as re,n as X,b as N,G as he,J as ce,u as ke,H as de,K as ye,t as xe}from"../chunks/index.9010cc84.js";import{g as Te,s as we,r as Se,i as H,a as Ne,m as Re,b as Me,l as He}from"../chunks/util.ca65e827.js";function Oe({fetch:l,params:t}){return{fetch:l}}const st=Object.freeze(Object.defineProperty({__proto__:null,load:Oe},Symbol.toStringTag,{value:"Module"}));function ue(l){if(!H(l))throw new Error("illegal title "+l)}function pe(l){return l.startsWith("#")}function V(l){return l.slice(1)}let T={getitem:(l,t)=>{ue(l);var e={Title:l,Content:"…",Rating:-1};if(T.has(l))try{e=JSON.parse(localStorage[l]),typeof e=="string"&&(e={Title:l,Content:e,Rating:-1})}catch{console.warn("error parsing json",localStorage[l]),e={Title:l,Content:"<Error>",Rating:-1}}if(pe(l)){let n=V(l);Te(n).then(i=>{i.Content!=e.Content&&(e=i,localStorage[l]=JSON.stringify(e),t(e))}).catch(i=>{console.warn("error fetching",i)})}return e},setitem:l=>{const t=JSON.stringify(l);ue(l.Title),localStorage[l.Title]=t,pe(l.Title)&&we(V(l.Title),l.Content).then()},set_linkstate:(l,t)=>{localStorage["ls_"+l]=JSON.stringify(t)},get_linkstate:l=>{let t=localStorage["ls_"+l];return t?JSON.parse(t):[]},rate:(l,t)=>{localStorage["rating_"+l]=t,Se(V(l),t)},has:l=>localStorage[l]!=null};var $=new Set,P=[],Z=!1;function Pe(){for(let l=0;l<localStorage.length;l++){const t=localStorage.key(l);t.startsWith("#")&&ie(t)}}function ie(l){const t=l.split("."),e=$.size;for(let n=0;n<t.length;n++){const i=t.slice(0,n+1).join(".");$.add(i)}e!=$.size&&(Z=!0)}function ze(l){Z&&(P=Array.from($),P.sort(),Z=!1);for(var t=[],e=0;e<P.length;e++)P[e].toLowerCase().startsWith(l.toLowerCase())&&t.push(P[e]);return t}class Fe{constructor(){L(this,"element");L(this,"parent",null);L(this,"open",!1)}create(t){this.open=!0,console.log("creating autocomplete ",t),document.addEventListener("click",a=>{a.target.parentElement!=this.element&&this.clear()});const e=F(t.id),n=e.path;this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="";const i=ze(n).filter(a=>a!=n);i.length!=0&&(i.forEach(a=>{const s=document.createElement("p");s.innerHTML=a,this.element.appendChild(s),s.addEventListener("click",()=>{e.rename(a),this.clear()})}),t.appendChild(this.element))}fill(t,e){console.log("filling autocomplete ",t),this.open=!0,document.addEventListener("click",n=>{n.target.parentElement!=this.element&&this.clear()}),this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="",e.forEach(n=>{const i=document.createElement("p");i.innerHTML=n,this.element.appendChild(i),i.addEventListener("click",()=>{const a=new Text(n);t.replaceWith(a),le(a,n.length),this.clear()})}),t.appendChild(this.element)}clear(){this.open=!1,this.element!=null&&this.element.remove()}restore(){this.open=!0,this.element!=null&&this.parent.appendChild(this.element)}}let q=new Map,Ue=0;class fe{constructor(t,e,n){L(this,"name");L(this,"path");L(this,"element");L(this,"childnote",null);L(this,"is_open",!1);L(this,"parent");L(this,"expanded",!0);this.name=t,this.element=document.createElement("span"),this.parent=e,this.element.classList.add("link"),this.path=t,(this.path.endsWith(".")||this.path.endsWith(":"))&&(this.path=this.path.slice(0,this.path.length-1));var i=e.path;if(this.path.startsWith("..")){let a=i.split(".");a.length==1?this.element.classList.add("error"):(i=a.slice(0,a.length-1).join("."),this.path=i+this.path.slice(1))}else this.path.startsWith(".")&&(this.path=i+this.path);if(this.path.startsWith("~")){const a=localStorage.username,s=a==null?"#home":`#home:${a}@${a}`;this.path=s+"."+this.path.substring(1)}this.element.innerHTML=t,this.element.onclick=a=>{a.target==this.element&&(this.is_open?this.close():this.open(),this.parent.body.save_linkstate())},this.element.id="link"+Ue++,q.set(this.element.id,this),n&&this.set_expanded(!1)}remove(){this.is_open&&this.close(),q.delete(this.element.id)}rename(t){if(this.path=t,t.startsWith(this.parent.path)&&this.parent.path.length<t.length){const e=t.slice(this.parent.path.length);e.startsWith(".")&&(t=e)}else if(t.startsWith(x.path))t=t.slice(x.path.length+1),t="~"+t;else if(this.parent.path.includes(".")){const e=this.parent.path.split(".").slice(0,-1).join(".");if(t.startsWith(e)){const n=t.slice(e.length);n.startsWith(".")&&(t="."+n)}}if(console.log(t),console.log(x),this.name=t,!this.expanded&&!this.is_open){let e=me(this.name);this.element.innerHTML=e}else this.element.innerHTML=this.name;return this.parent.body.save_lazy(),le(this.element,1),this.name}open(t=[]){this.is_open=!0,this.is_open=!0,this.element.classList.add("open"),this.childnote=new J(this.name,this.path,this,t),this.element.parentElement.appendChild(this.childnote.element),B.push({element:this.childnote.head.title_element,fullpath:this.path}),this.set_expanded(!0),ie(this.path)}close(){this.element.classList.remove("open"),this.is_open&&(this.is_open=!1,this.is_open=!1,this.element.parentElement,this.childnote.close(),this.parent.body.editable||this.set_expanded(!1))}set_expanded(t){if(this.expanded=t,!t&&!this.is_open){let e=this.name;if(e=="")return;let n=me(e);this.element.innerHTML=n}else this.element.innerHTML=this.name}}function F(l){return q.get(l)}function me(l){let t="";[".",":"].forEach(a=>{l.endsWith(a)&&(t=a,l=l.slice(0,l.length-1))});let n=l.replace(/.*\./g,"").replace(/[@,:].*/g,"");return["#","_","~"].forEach(a=>{n.startsWith(a)&&(n=n.slice(1))}),n=n.replaceAll("_"," "),n+t}function z(l){return l instanceof HTMLSpanElement&&l.classList.contains("link")}function We(l){let t=document.createElement("textarea");return t.innerHTML=l,t.value}class De{constructor(t,e,n,i){L(this,"element");e>5&&(e=5),this.element=document.createElement("div"),this.element.classList.add("bg"),this.element.addEventListener("click",u=>{u.target==this.element&&this.element.remove()});const a=document.createElement("div");a.classList.add("container"),this.element.appendChild(a),a.innerHTML=`<h2>${t}</h2>`;var s=document.createElement("p");s.classList.add("stars");var c=[];const o=()=>{console.log("setrating",e);for(let u=0;u<5;u++)u<e?c[u].innerHTML="★":c[u].innerHTML="☆"};for(let u=0;u<5;u++){let _=document.createElement("span");_.classList.add("star"),_.innerHTML="☆",s.appendChild(_),c.push(_),_.addEventListener("click",h=>{e=u+1,o()})}o(),a.appendChild(s);const r=document.createElement("button");r.classList.add("ready"),r.innerHTML="rate",a.appendChild(r),r.addEventListener("click",u=>{this.element.remove(),i(e)}),n.appendChild(this.element)}}var Ae=l=>new Promise((t,e)=>{console.log("rename_note",l);const n=document.createElement("div");n.classList.add("bg"),n.addEventListener("click",u=>{u.target==n&&(n.remove(),e())}),document.querySelector("#page").appendChild(n);const i=document.createElement("div");i.classList.add("container"),n.appendChild(i);const a=document.createElement("h2");a.innerHTML="rename note";const s=document.createElement("input");s.value=l;const c=document.createElement("p"),o=()=>{const u=s.value;u!=l&&H(u)?(t(u),n.remove()):c.innerHTML="invalid name"};s.addEventListener("keyup",u=>{u.key=="Enter"&&o()});const r=document.createElement("button");r.innerHTML="rename",r.onclick=()=>o(),i.appendChild(a),i.appendChild(s),i.appendChild(c),i.appendChild(document.createElement("br")),i.appendChild(r)});function je(l){if(l.__esModule)return l;var t=l.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var a=Function.bind.apply(t,i);return new a}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(l).forEach(function(n){var i=Object.getOwnPropertyDescriptor(l,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return l[n]}})}),e}function Ie(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ee={},Xe={get exports(){return ee},set exports(l){ee=l}};const Ge={},$e=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"})),Be=je($e);(function(l){var t;(function(){t=function(e,n,i,a){a=a||{},this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=a.flags||{},this.memoized={},this.loaded=!1;var s=this,c,o,r,u,_;e&&(s.dictionary=e,n&&i?b():typeof window<"u"&&"chrome"in window&&"extension"in window.chrome&&"getURL"in window.chrome.extension?(a.dictionaryPath?c=a.dictionaryPath:c="typo/dictionaries",n||h(chrome.extension.getURL(c+"/"+e+"/"+e+".aff"),g),i||h(chrome.extension.getURL(c+"/"+e+"/"+e+".dic"),p)):(a.dictionaryPath?c=a.dictionaryPath:typeof __dirname<"u"?c=__dirname+"/dictionaries":c="./dictionaries",n||h(c+"/"+e+"/"+e+".aff",g),i||h(c+"/"+e+"/"+e+".dic",p)));function h(m,v){var d=s._readFile(m,null,a.asyncLoad);a.asyncLoad?d.then(function(f){v(f)}):v(d)}function g(m){n=m,i&&b()}function p(m){i=m,n&&b()}function b(){for(s.rules=s._parseAFF(n),s.compoundRuleCodes={},o=0,u=s.compoundRules.length;o<u;o++){var m=s.compoundRules[o];for(r=0,_=m.length;r<_;r++)s.compoundRuleCodes[m[r]]=[]}"ONLYINCOMPOUND"in s.flags&&(s.compoundRuleCodes[s.flags.ONLYINCOMPOUND]=[]),s.dictionaryTable=s._parseDIC(i);for(o in s.compoundRuleCodes)s.compoundRuleCodes[o].length===0&&delete s.compoundRuleCodes[o];for(o=0,u=s.compoundRules.length;o<u;o++){var v=s.compoundRules[o],d="";for(r=0,_=v.length;r<_;r++){var f=v[r];f in s.compoundRuleCodes?d+="("+s.compoundRuleCodes[f].join("|")+")":d+=f}s.compoundRules[o]=new RegExp(d,"i")}s.loaded=!0,a.asyncLoad&&a.loadedCallback&&a.loadedCallback(s)}return this},t.prototype={load:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);return this},_readFile:function(e,n,i){if(n=n||"utf8",typeof XMLHttpRequest<"u"){var a,s=new XMLHttpRequest;return s.open("GET",e,i),i&&(a=new Promise(function(o,r){s.onload=function(){s.status===200?o(s.responseText):r(s.statusText)},s.onerror=function(){r(s.statusText)}})),s.overrideMimeType&&s.overrideMimeType("text/plain; charset="+n),s.send(null),i?a:s.responseText}else if(typeof Ie<"u"){var c=Be;try{if(c.existsSync(e))return c.readFileSync(e,n);console.log("Path "+e+" does not exist.")}catch(o){return console.log(o),""}}},_parseAFF:function(e){var n={},i,a,s,c,o,r,u,_,h=e.split(/\r?\n/);for(o=0,u=h.length;o<u;o++)if(i=this._removeAffixComments(h[o]),i=i.trim(),!!i){var g=i.split(/\s+/),p=g[0];if(p=="PFX"||p=="SFX"){var b=g[1],m=g[2];s=parseInt(g[3],10);var v=[];for(r=o+1,_=o+1+s;r<_;r++){a=h[r],c=a.split(/\s+/);var d=c[2],f=c[3].split("/"),C=f[0];C==="0"&&(C="");var E=this.parseRuleCodes(f[1]),y=c[4],k={};k.add=C,E.length>0&&(k.continuationClasses=E),y!=="."&&(p==="SFX"?k.match=new RegExp(y+"$"):k.match=new RegExp("^"+y)),d!="0"&&(p==="SFX"?k.remove=new RegExp(d+"$"):k.remove=d),v.push(k)}n[b]={type:p,combineable:m=="Y",entries:v},o+=s}else if(p==="COMPOUNDRULE"){for(s=parseInt(g[1],10),r=o+1,_=o+1+s;r<_;r++)i=h[r],c=i.split(/\s+/),this.compoundRules.push(c[1]);o+=s}else p==="REP"?(c=i.split(/\s+/),c.length===3&&this.replacementTable.push([c[1],c[2]])):this.flags[p]=g[1]}return n},_removeAffixComments:function(e){return e.match(/^\s*#/,"")?"":e},_parseDIC:function(e){e=this._removeDicComments(e);var n=e.split(/\r?\n/),i={};function a(O,ae){i.hasOwnProperty(O)||(i[O]=null),ae.length>0&&(i[O]===null&&(i[O]=[]),i[O].push(ae))}for(var s=1,c=n.length;s<c;s++){var o=n[s];if(o){var r=o.split("/",2),u=r[0];if(r.length>1){var _=this.parseRuleCodes(r[1]);(!("NEEDAFFIX"in this.flags)||_.indexOf(this.flags.NEEDAFFIX)==-1)&&a(u,_);for(var h=0,g=_.length;h<g;h++){var p=_[h],b=this.rules[p];if(b)for(var m=this._applyRule(u,b),v=0,d=m.length;v<d;v++){var f=m[v];if(a(f,[]),b.combineable)for(var C=h+1;C<g;C++){var E=_[C],y=this.rules[E];if(y&&y.combineable&&b.type!=y.type)for(var k=this._applyRule(f,y),R=0,W=k.length;R<W;R++){var D=k[R];a(D,[])}}}p in this.compoundRuleCodes&&this.compoundRuleCodes[p].push(u)}}else a(u.trim(),[])}}return i},_removeDicComments:function(e){return e=e.replace(/^\t.*$/mg,""),e},parseRuleCodes:function(e){if(e)if("FLAG"in this.flags)if(this.flags.FLAG==="long"){for(var n=[],i=0,a=e.length;i<a;i+=2)n.push(e.substr(i,2));return n}else return this.flags.FLAG==="num"?e.split(","):this.flags.FLAG==="UTF-8"?Array.from(e):e.split("");else return e.split("");else return[]},_applyRule:function(e,n){for(var i=n.entries,a=[],s=0,c=i.length;s<c;s++){var o=i[s];if(!o.match||e.match(o.match)){var r=e;if(o.remove&&(r=r.replace(o.remove,"")),n.type==="SFX"?r=r+o.add:r=o.add+r,a.push(r),"continuationClasses"in o)for(var u=0,_=o.continuationClasses.length;u<_;u++){var h=this.rules[o.continuationClasses[u]];h&&(a=a.concat(this._applyRule(r,h)))}}}return a},check:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(n))return!0;if(n.toUpperCase()===n){var i=n[0]+n.substring(1).toLowerCase();if(this.hasFlag(i,"KEEPCASE"))return!1;if(this.checkExact(i)||this.checkExact(n.toLowerCase()))return!0}var a=n[0].toLowerCase()+n.substring(1);if(a!==n){if(this.hasFlag(a,"KEEPCASE"))return!1;if(this.checkExact(a))return!0}return!1},checkExact:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=this.dictionaryTable[e],i,a;if(typeof n>"u"){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN){for(i=0,a=this.compoundRules.length;i<a;i++)if(e.match(this.compoundRules[i]))return!0}}else{if(n===null)return!0;if(typeof n=="object"){for(i=0,a=n.length;i<a;i++)if(!this.hasFlag(e,"ONLYINCOMPOUND",n[i]))return!0}}return!1},hasFlag:function(e,n,i){if(!this.loaded)throw"Dictionary not loaded.";return!!(n in this.flags&&(typeof i>"u"&&(i=Array.prototype.concat.apply([],this.dictionaryTable[e])),i&&i.indexOf(this.flags[n])!==-1))},alphabet:"",suggest:function(e,n){if(!this.loaded)throw"Dictionary not loaded.";if(n=n||5,this.memoized.hasOwnProperty(e)){var i=this.memoized[e].limit;if(n<=i||this.memoized[e].suggestions.length<i)return this.memoized[e].suggestions.slice(0,n)}if(this.check(e))return[];for(var a=0,s=this.replacementTable.length;a<s;a++){var c=this.replacementTable[a];if(e.indexOf(c[0])!==-1){var o=e.replace(c[0],c[1]);if(this.check(o))return[o]}}var r=this;r.alphabet="abcdefghijklmnopqrstuvwxyz";function u(h,g){var p={},b,m,v,d,f=r.alphabet.length;if(typeof h=="string"){var C=h;h={},h[C]=!0}for(var C in h)for(b=0,v=C.length+1;b<v;b++){var E=[C.substring(0,b),C.substring(b)];if(E[1]&&(d=E[0]+E[1].substring(1),(!g||r.check(d))&&(d in p?p[d]+=1:p[d]=1)),E[1].length>1&&E[1][1]!==E[1][0]&&(d=E[0]+E[1][1]+E[1][0]+E[1].substring(2),(!g||r.check(d))&&(d in p?p[d]+=1:p[d]=1)),E[1]){var y=E[1].substring(0,1).toUpperCase()===E[1].substring(0,1)?"uppercase":"lowercase";for(m=0;m<f;m++){var k=r.alphabet[m];y==="uppercase"&&(k=k.toUpperCase()),k!=E[1].substring(0,1)&&(d=E[0]+k+E[1].substring(1),(!g||r.check(d))&&(d in p?p[d]+=1:p[d]=1))}}if(E[1])for(m=0;m<f;m++){var y=E[0].substring(-1).toUpperCase()===E[0].substring(-1)&&E[1].substring(0,1).toUpperCase()===E[1].substring(0,1)?"uppercase":"lowercase",k=r.alphabet[m];y==="uppercase"&&(k=k.toUpperCase()),d=E[0]+k+E[1],(!g||r.check(d))&&(d in p?p[d]+=1:p[d]=1)}}return p}function _(h){var g=u(h),p=u(g,!0),b=p;for(var m in g)r.check(m)&&(m in b?b[m]+=g[m]:b[m]=g[m]);var v,d=[];for(v in b)b.hasOwnProperty(v)&&d.push([v,b[v]]);function f(k,R){var W=k[1],D=R[1];return W<D?-1:W>D?1:R[0].localeCompare(k[0])}d.sort(f).reverse();var C=[],E="lowercase";h.toUpperCase()===h?E="uppercase":h.substr(0,1).toUpperCase()+h.substr(1).toLowerCase()===h&&(E="capitalized");var y=n;for(v=0;v<Math.min(y,d.length);v++)E==="uppercase"?d[v][0]=d[v][0].toUpperCase():E==="capitalized"&&(d[v][0]=d[v][0].substr(0,1).toUpperCase()+d[v][0].substr(1)),!r.hasFlag(d[v][0],"NOSUGGEST")&&C.indexOf(d[v][0])==-1?C.push(d[v][0]):y++;return C}return this.memoized[e]={suggestions:_(e),limit:n},this.memoized[e].suggestions}}})(),l.exports=t})(Xe);const ge=ee;var se,U;async function Je(){return new Promise((t,e)=>{setTimeout(()=>{se=new ge("de",null,null,{dictionaryPath:"/dictionaries"}),U=new ge("en_GB",null,null,{dictionaryPath:"/dictionaries"}),t(!0)},500)})}function ve(l){if(Ye(l))return;const t=document.createElement("span");return t.classList.add("typo"),t.innerHTML=l,t.addEventListener("contextmenu",e=>{var i;const n=Ke(l);console.log(n),S.fill(t,n),console.log("my parent is ",(i=S.element)==null?void 0:i.parentElement),e.preventDefault()}),t}function Ye(l){return l=l.replace(/\p{P}$/ug,""),U===void 0||/\d/.test(l)||(l=l.trim(),l.length<2)?!0:!(!se.check(l)&&!U.check(l))}function Ke(l){if(l=l.replace(/\p{P}$/ug,""),U===void 0)return[];if(/\d/.test(l))return[];if(l=l.trim(),l.length<2)return[];let t=U.suggest(l,5);return t=t.concat(se.suggest(l,5)),t=t.filter((e,n)=>t.indexOf(e)===n),t}var B=[],x={path:"_home"};let M=[],S=new Fe;class J{constructor(t,e,n,i=[]){L(this,"path");L(this,"txt");L(this,"rating");L(this,"element");L(this,"head");L(this,"body");console.log("creating note",t),e==null&&(e=t),this.path=e;let a=T.getitem(e,s=>{this.rating=s.Rating,this.body.free(),this.body.render(s.Content),this.head.set_rating(this.rating)});this.txt=a.Content,this.txt==null&&(this.txt="<error getting content>"),this.rating=a.Rating,this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new Ve(t,this.rating,this,n),this.body=new Qe(this.txt,this,e,i),this.element.appendChild(this.head.element),this.element.appendChild(this.body.element)}close(){this.body.save(),this.body.free(),this.element.remove()}}class Ve{constructor(t,e,n,i){L(this,"element");L(this,"title","");L(this,"title_element");L(this,"note");L(this,"istop");L(this,"ratebutton");this.title_element=document.createElement("span"),this.title_element.classList.add("title"),this.note=n,i!=null&&this.title_element.addEventListener("click",a=>{Ae(this.note.path).then(s=>{this.note.path=s;const c=i.rename(s);this.set_title(c),this.note.body.get_links().forEach(o=>{o.name.startsWith(".")&&(o.close(),o.rename(o.path))}),this.note.body.save_lazy()})}),this.set_title(t),this.istop=i==null,this.element=document.createElement("div"),this.element.classList.add("head"),this.create_expand_button(),this.create_rate_button(e),this.create_share_button()}set_title(t){t=ne(t),t=t.replaceAll("_"," "),t.endsWith(":")&&(t=t.slice(0,-1)),this.title_element.innerHTML=t,this.title=t}create_share_button(){let t=document.createElement("span");t.innerHTML="share",t.classList.add("sharebutton"),t.classList.add("navbutton"),t.addEventListener("click",async e=>{let n=this.note.path.startsWith("#")?this.note.path.slice(1):this.note.path;await navigator.clipboard.writeText(location.origin+"?"+n),t.innerHTML="copied"}),this.element.appendChild(t)}create_expand_button(){const t=document.createElement("span");t.classList.add("expandbutton"),t.classList.add("navbutton"),this.element.appendChild(t);const e=document.querySelector("#page"),n=a=>{e.removeChild(e.firstChild),M.pop();let s=M[M.length-1],c=new J(s,s);e.append(c.element),B=[{element:c.head.title_element,fullpath:s}];let o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+s.slice(1);window.history.pushState({path:o},"",o)},i=a=>{this.title=ne(this.note.path),this.title_element.innerHTML=this.title,e.removeChild(e.firstChild),e.appendChild(this.note.element),t.innerHTML="⇦",M.push(this.note.path),t.removeEventListener("click",i),t.addEventListener("click",n),t.focus(),window.location.origin+""+this.note.path.slice(1);let s=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+this.note.path.slice(1);window.history.pushState({path:s},"",s),x.path=this.note.path};this.istop?M.length>1?(t.innerHTML="⇦",t.addEventListener("click",n)):M.push(this.note.path):(t.innerHTML="⇨",t.addEventListener("click",i)),this.element.appendChild(this.title_element)}set_rating(t){t==-1||t==null||(this.ratebutton.classList.add("liked"),this.ratebutton.innerHTML=t+"★",this.note.rating=t,this.note.body.save())}create_rate_button(t){this.note.rating=t,this.ratebutton=document.createElement("span"),this.note.rating==-1||this.note.rating==5||this.note.rating==null?(this.ratebutton.classList.remove("liked"),this.ratebutton.innerHTML="☆"):(this.ratebutton.classList.add("liked"),this.ratebutton.innerHTML=this.note.rating+"★"),this.ratebutton.classList.add("ratebutton"),this.ratebutton.classList.add("navbutton"),this.ratebutton.addEventListener("click",async e=>{const n=document.querySelector("#page");new De(this.note.path,this.note.rating,n,i=>{this.set_rating(i),T.rate(this.note.path,i)})}),this.element.appendChild(this.ratebutton)}}var G=null;function te(l){l!=G&&(G!=null&&G.body.set_editable(!1),l!=null&&l.body.set_editable(!0),G=l)}class Qe{constructor(t,e,n,i=[]){L(this,"element");L(this,"txt");L(this,"note");L(this,"saves_pending",!1);L(this,"on_paste",t=>{for(var e=t.target;e.nodeName!="DIV";)if(e=e.parentElement,e==null)return;if(e!=this.element)return;let n=t.clipboardData.getData("text");if(n=We(n),n.startsWith(window.location.origin)&&n.includes("?")){console.log("pasting link"),t.preventDefault();let i=n.split("?")[1];if(H(i)||(i="#"+i),i.startsWith(this.note.path)&&i.length>this.note.path.length)i=i.substring(this.note.path.length);else if(this.note.path.includes(".")){const s=this.note.path.split(".").slice(0,-1).join(".");i.startsWith(s)&&i.length>s.length&&(i="."+i.substring(s.length))}const a=new fe(i,this.note,!1);this.insert_text(a.element)}else if(console.log("pasting normal text",n),t.preventDefault(),this.insert_text(document.createTextNode(n)),n.includes(`
`)){let i=this.get_content_text();this.render(i)}this.save_lazy()});L(this,"editable",!1);if(i.length==0&&(i=[e.path]),this.txt=t,this.element=document.createElement("div"),this.element.classList.add("content"),this.note=e,t==""){let s=document.createElement("p");s.innerHTML="<br>",this.element.appendChild(s)}else t.split(`
`).forEach(c=>{let o=this.make_line(c);this.element.appendChild(o)});this.element.addEventListener("click",s=>{(s.target.parentElement==this.element||s.target==this.element)&&(te(this.note),S.clear())}),this.element.addEventListener("input",s=>this.on_input(s)),this.element.addEventListener("blur",s=>{this.editable&&te(null)}),this.element.addEventListener("paste",this.on_paste),this.element.addEventListener("copy",this.on_copy);const a=T.get_linkstate(n);this.get_links().forEach((s,c)=>{a[c]&&!i.includes(s.path)&&s.open(i.concat([s.path])),ie(s.path)})}on_copy(t){t.preventDefault();let n=window.getSelection().toString().replaceAll(`

`,`
`);t.clipboardData.setData("text/plain",n)}render(t){if(this.txt=t,this.free(),t==""){let e=document.createElement("p");e.innerHTML="<br>",this.element.appendChild(e)}else t.split(`
`).forEach(n=>{let i=this.make_line(n);this.element.appendChild(i)})}insert_text(t){const e=window.getSelection();e.deleteFromDocument(),e.getRangeAt(0).insertNode(t),t.parentElement instanceof HTMLBRElement&&(t.parentElement.replaceWith(t),console.log("replaced br")),e.collapseToEnd();const n=document.createRange();n.selectNodeContents(t),n.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(n)}free(){this.get_links().forEach(e=>{e.remove()}),this.element.innerHTML=""}get_links(){let t=[];return this.element.childNodes.forEach(e=>{e.childNodes.forEach(n=>{if(z(n)){const i=F(n.id);i!=null&&t.push(i)}})}),t}make_line(t,e=!0){if(t==""){let s=document.createElement("p");return s.innerHTML="<br>",s}t=t.replaceAll(" "," "),t=t.replace(/(\S)\u00A0(\S)/g,"$1 $2");let n=t.split(/(\s+)/),i=document.createElement("p");return n.map(s=>{if(H(s))return new fe(s,this.note,e).element;if(Ne(s))return Re(s);{const c=ve(s);return c??new Text(s)}}).forEach(s=>{i.appendChild(s)}),i}spellcheck(){this.element.childNodes.forEach(t=>{t.nodeName=="P"&&t.childNodes.forEach(e=>{if(e.nodeType==Node.TEXT_NODE){const n=ve(e.textContent);if(n!=null){e.replaceWith(n);return}}})})}async on_input(t){var r,u,_,h,g,p,b,m,v,d;if(this.element.contentEditable!="true"||t.target!=this.element||t.type=="input"&&["¨"].includes(t.data))return;S.clear();const e=window.getSelection(),n=e==null?void 0:e.focusNode;var i=e==null?void 0:e.focusOffset,a;if(n.nodeName=="P")a=n;else if(n.nodeName=="DIV")a=n.firstChild;else if(((r=n.parentElement)==null?void 0:r.nodeName)=="P")a=n.parentElement;else if(((_=(u=n.parentElement)==null?void 0:u.parentElement)==null?void 0:_.nodeName)=="P")a=(h=n.parentElement)==null?void 0:h.parentElement;else{this.element.childNodes.forEach(f=>{if(f.nodeName!="P"){const C=document.createElement("p");f.nodeName=="DIV"?(f.replaceWith(C),C.appendChild(f.firstChild)):(f.replaceWith(C),C.appendChild(f)),Q(C,0)}});return}if(t.inputType=="insertParagraph"){const f=a.previousElementSibling;((g=f.lastChild)==null?void 0:g.textContent)==""&&((p=f.lastChild)==null||p.remove()),this.reload_line(f),S.clear(),(m=a.firstChild)==null||m.replaceWith((b=a.firstChild)==null?void 0:b.textContent);const C=this.reload_line(a);Q(C,0);return}let s=this.get_line_text(a);if(s!=""){let f=n;if(n.nodeName=="P"?(f=n.childNodes[i],i=0):((v=n.parentElement)==null?void 0:v.nodeName)=="SPAN"&&(f=n.parentElement),f==null){console.warn("prev is undefined");return}for(f=f.previousSibling;f!=null;)i+=(d=f.textContent)==null?void 0:d.length,f=f.previousSibling}else i=0;const c=this.reload_line(a,s),o=Q(c,i);this.save_lazy(),o!=null&&t.type=="input"&&z(o)&&S.create(o)}reload_line(t,e){e==null&&(e=this.get_line_text(t));const n=this.make_line(e,!1);return t.replaceWith(n),t.childNodes.forEach(i=>{if(z(i)){const a=F(i.id);a==null||a.remove()}}),n}set_editable(t){this.editable=t,this.element.contentEditable=t.toString(),this.element.classList.toggle("editable",t),this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(n=>{var i;z(n)&&((i=F(n.id))==null||i.set_expanded(t))})})}save(){let t=this.get_content_text();T.setitem({Title:this.note.path,Content:t,Rating:this.note.rating}),this.saves_pending=!1}save_linkstate(){const t=[];this.get_links().forEach(n=>t.push(n.is_open)),T.set_linkstate(this.note.path,t)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}get_content_text(){let t=[];return this.element.childNodes.forEach(n=>{n.nodeName=="P"&&t.push(this.get_line_text(n))}),t.join(`
`)}get_line_text(t){let e="";const n=S.open;return n&&S.clear(),t.childNodes.forEach(i=>{if(z(i)){const s=F(i.id);s==null?e+="":s!=null&&s.expanded?e+=i.textContent:e+=s==null?void 0:s.name}else(i.nodeName=="#text"||i.nodeName=="SPAN")&&(e+=i.textContent)}),n&&S.restore(),e}}function Q(l,t){var i,a;let e=l.firstChild;for(;t>((i=e==null?void 0:e.textContent)==null?void 0:i.length);)t-=(a=e==null?void 0:e.textContent)==null?void 0:a.length,e=e==null?void 0:e.nextSibling;let n=null;return e!=null&&(e.nodeName=="SPAN"?(n=e,e=e.firstChild):n=e),le(e,t),n}function le(l,t){var e=document.createRange(),n=window.getSelection();try{e.setStart(l,t),e.collapse(!0)}catch{}n!=null&&(n.removeAllRanges(),n.addRange(e))}function ne(l){l.startsWith("..")?l=l.slice(2):(l.startsWith("#")||l.startsWith("_")||l.startsWith("."))&&(l=l.slice(1));let t="",e=l.split(".").map(n=>n.split("@")[0]).map(n=>{const i=n.split(":");return i.length>1&&(t=i[1]),n.split(":")[0]}).join(".");if(t!=""){const n="<span class='author'> by "+t+"</span>";e+=n}return e}new TextEncoder;function Ze(l){let t,e,n,i,a,s,c,o,r,u,_;return{c(){t=A("h2"),e=Y(),n=A("button"),i=oe("❋"),a=Y(),s=A("button"),c=oe(l[1]),o=Y(),r=A("div"),this.h()},l(h){t=j(h,"H2",{id:!0});var g=I(t);g.forEach(w),e=K(h),n=j(h,"BUTTON",{id:!0});var p=I(n);i=re(p,"❋"),p.forEach(w),a=K(h),s=j(h,"BUTTON",{id:!0});var b=I(s);c=re(b,l[1]),b.forEach(w),o=K(h),r=j(h,"DIV",{id:!0});var m=I(r);m.forEach(w),this.h()},h(){X(t,"id","fullheader"),X(n,"id","light_btn"),X(s,"id","loggedin_btn"),X(r,"id","page")},m(h,g){N(h,t,g),t.innerHTML=l[0],N(h,e,g),N(h,n,g),he(n,i),N(h,a,g),N(h,s,g),he(s,c),N(h,o,g),N(h,r,g),u||(_=[ce(n,"click",qe),ce(s,"click",l[4])],u=!0)},p(h,[g]){g&1&&(t.innerHTML=h[0]),g&2&&ke(c,h[1])},i:de,o:de,d(h){h&&w(t),h&&w(e),h&&w(n),h&&w(a),h&&w(s),h&&w(o),h&&w(r),u=!1,ye(_)}}}function qe(){document.body.classList.toggle("light"),localStorage.light=document.body.classList.contains("light")}function et(l,t,e){let{data:n}=t;var i,a="<br>";i=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,a=i,xe().then(_);let s;const c=`
doppel klick mich und schreib was: xzxysl ... *&^*
du kannst einen neuen link erstellen mit # und dann text zb.: #link #rekursion #wasauchimmer
klick einen link an um eine seite zu öffnen. wenn die seite schon existiert wird sie dir angezeigt.
alles was du unter einem #link schreibst ist öffentlich sichtbar.
wenn du eine geheime notiz schreiben willst schreibe statdesseneinen unterstrich: _link. solche links sind nicht für andere sichtbar. zb.: _home
fast vergessen! erstelle einen account: {}/login dann kannst du eine öffentliche notiz erstellen die nur du verändern kannst oder du kannst eine Notiz an einen Kontakt schicken
wenn du mehr wissen willst: #sciepedia:kormann

`;let o,r,u="";async function _(){Pe(),Me(),window.fetch=n.fetch,localStorage.light!="false"&&document.body.classList.add("light"),s=document.createElement("div"),s.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",s.id="pred";let p=localStorage.username,b=localStorage.passhash;if(localStorage.username!=null)try{const d=await He(p,b);localStorage.session_token=d,e(1,u=p[0]),T.setitem({Title:"_account",Content:"you are logged in as "+p+`
switch account: `+window.origin+"/login",Rating:-1})}catch(d){const f=d;console.log("login error",f.message=="NetworkError when attempting to fetch resource."),f.message.startsWith("NetworkError")?(console.warn("network error"),alert("offline version.")):(alert("failed to log in as "+p),T.setitem({Title:"_account",Content:"you are not logged in."+d+" "+window.origin+"/login",Rating:-1}),p=void 0)}else T.setitem({Title:"_account",Content:"you are not logged in. "+window.origin+"/login",Rating:-1});i=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,e(0,a=i);let m=window.location.search;if(p!=null){x.path=`#home:${p}@${p}`;const d=localStorage._home;localStorage[x.path]==null&&d==""&&T.setitem({Title:x.path,Content:d,Rating:-1})}r=[x.path],m&&m.length>1&&(m=m.slice(1),H(m)||(m="#"+m),H(m)&&(r.push(x.path),x.path=m)),o=document.querySelector("#page"),window.addEventListener("scroll",d=>{e(0,a=i);let f={element:{offsetTop:0},fullpath:"<span id=homebtn>sciepedia</span>"};B.forEach(C=>{window.scrollY+C.element.offsetHeight>C.element.offsetTop&&f.element.offsetTop<C.element.offsetTop&&(f=C)}),e(0,a=f.fullpath),e(0,a=ne(a))}),T.setitem({Title:"_tutorial",Content:c.replace("{}",window.location.origin),Rating:-1}),T.has("_home")||T.setitem({Title:"_home",Content:`willkommen zu sciepedia
wenn du neu hier bist: _tutorial`,Rating:-1});let v=new J(x.path,x.path);B.push({element:v.head.title_element,fullpath:x.path}),o.appendChild(v.element),document.body.addEventListener("click",d=>{d.target==document.body&&te(null)}),window.addEventListener("onunload",d=>{localStorage.unloading=!0,v.body.free(),localStorage.unloaded=!0}),Je().then(()=>{v.body.spellcheck()})}function h(p){r.push("_account");let b=new J("_account");o.removeChild(o.firstChild),o.appendChild(b.element)}const g=()=>{h()};return l.$$set=p=>{"data"in p&&e(3,n=p.data)},[a,u,h,n,g]}class lt extends Ee{constructor(t){super(),Ce(this,t,et,Ze,Le,{data:3})}}export{lt as component,st as universal};
