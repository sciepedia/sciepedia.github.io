var Ee=Object.defineProperty;var Ce=(l,t,e)=>t in l?Ee(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var E=(l,t,e)=>(Ce(l,typeof t!="symbol"?t+"":t,e),e);import{J as K,S as ye,i as Le,s as ke,k as I,a as $,q as he,l as j,m as X,h as x,c as Q,r as ce,n as G,b as S,G as pe,K as ue,H as de,L as xe,I as fe,t as we,M as Ne}from"../chunks/index.6cba8ff5.js";import{u as D,g as Te,s as Se,i as W,a as Me,b as Re,m as Oe,l as me}from"../chunks/backend.94164aa2.js";function Pe({fetch:l,params:t}){return{fetch:l}}const tt=Object.freeze(Object.defineProperty({__proto__:null,load:Pe},Symbol.toStringTag,{value:"Module"}));var B=new Set,P=[],q=!1;function He(){for(let l=0;l<localStorage.length;l++){const t=localStorage.key(l);t.startsWith("#")&&se(t)}}function se(l){const t=l.split("."),e=B.size;for(let n=0;n<t.length;n++){const i=t.slice(0,n+1).join(".");B.add(i)}e!=B.size&&(q=!0)}function Ue(l){q&&(P=Array.from(B),P.sort(),q=!1);for(var t=[],e=0;e<P.length;e++)P[e].toLowerCase().startsWith(l.toLowerCase())&&t.push(P[e]);return t}class We{constructor(){E(this,"element");E(this,"parent",null);E(this,"open",!1)}create(t){this.open=!0,document.addEventListener("click",a=>{a.target.parentElement!=this.element&&this.clear()});const e=U(t.id),n=e.path;this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="";const i=Ue(n).filter(a=>a!=n);i.length!=0&&(i.forEach(a=>{const s=document.createElement("p");s.innerHTML=a,this.element.appendChild(s),s.addEventListener("click",()=>{e.rename(a),this.clear()})}),t.appendChild(this.element))}fill(t,e){console.log("filling autocomplete ",t),this.open=!0,document.addEventListener("click",n=>{n.target.parentElement!=this.element&&this.clear()}),this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="",e.forEach(n=>{const i=document.createElement("p");i.innerHTML=n,this.element.appendChild(i),i.addEventListener("click",()=>{const a=new Text(n);t.replaceWith(a),oe(a,n.length),this.clear()})}),t.appendChild(this.element)}clear(){this.open=!1,this.element!=null&&this.element.remove()}restore(){this.open=!0,this.element!=null&&this.parent.appendChild(this.element)}}let ee=new Map,Ae=0;class ge{constructor(t,e,n){E(this,"name");E(this,"path");E(this,"element");E(this,"childnote",null);E(this,"is_open",!1);E(this,"parent");E(this,"expanded",!0);this.name=t,this.element=document.createElement("span"),this.parent=e,this.element.classList.add("link"),this.path=t,(this.path.endsWith(".")||this.path.endsWith(":"))&&(this.path=this.path.slice(0,this.path.length-1));var i=e.path;if(this.path.startsWith("..")){let a=i.split(".");a.length==1?this.element.classList.add("error"):(i=a.slice(0,a.length-1).join("."),this.path=i+this.path.slice(1))}else this.path.startsWith(".")&&(this.path=i+this.path);if(!this.path.includes(":")){let a=e.username;this.path+=`:${a}`}this.element.innerHTML=t,this.element.onclick=a=>{a.target==this.element&&(this.is_open?this.close():this.open(),this.parent.body.save_linkstate())},this.element.id="link"+Ae++,ee.set(this.element.id,this),n&&this.set_expanded(!1)}remove(){this.is_open&&this.close(),ee.delete(this.element.id)}rename(t){if(this.path=t,t.startsWith(this.parent.path)&&this.parent.path.length<t.length){const e=t.slice(this.parent.path.length);e.startsWith(".")&&(t=e)}else if(this.parent.path.includes(".")){const e=this.parent.path.split(".").slice(0,-1).join(".");if(t.startsWith(e)){const n=t.slice(e.length);n.startsWith(".")&&(t="."+n)}}if(this.name=t,!this.expanded&&!this.is_open){let e=ve(this.name);this.element.innerHTML=e}else this.element.innerHTML=this.name;return this.parent.body.save_lazy(),oe(this.element,1),this.name}open(t=[]){this.is_open=!0,this.is_open=!0,this.element.classList.add("open"),this.childnote=new ae(this.name,this.path,this,t),this.element.parentElement.appendChild(this.childnote.element),V.push({element:this.childnote.head.title_element,fullpath:this.path}),this.set_expanded(!0),se(this.path)}close(){this.element.classList.remove("open"),this.is_open&&(this.is_open=!1,this.is_open=!1,this.element.parentElement,this.childnote.close(),this.parent.body.editable||this.set_expanded(!1))}set_expanded(t){if(this.expanded=t,!t&&!this.is_open){let e=this.name;if(e=="")return;let n=ve(e);this.element.innerHTML=n}else this.element.innerHTML=this.name}}function U(l){return ee.get(l)}function ve(l){let t="";[".",":"].forEach(a=>{l.endsWith(a)&&(t=a,l=l.slice(0,l.length-1))});let n=l.replace(/.*\./g,"").replace(/[@,:].*/g,"");return["#","_"].forEach(a=>{n.startsWith(a)&&(n=n.slice(1))}),n=n.replaceAll("_"," "),n+t}function H(l){return l instanceof HTMLSpanElement&&l.classList.contains("link")}function Y(l){let t=l.startsWith("#");if(!l.startsWith("#")&&!l.startsWith("_"))throw new Error("invalid path: "+l);l=l.substring(1);let e=K(D);const n=l.split(".").map(i=>{const a=i.split(":");return a.length>1&&(e=a[1]),a[0]});return{pub:t,author:e,location:n}}let T={getitem:(l,t)=>{var e={Path:l,Content:"…"};const n=JSON.stringify(l);if(T.has(l))try{e=JSON.parse(localStorage[n]),typeof e=="string"&&(e={Path:l,Content:e})}catch{console.warn("error parsing json",localStorage[n]),e={Path:l,Content:"<Error>"}}return Te(l).then(i=>{i!=null&&i!=e.Content&&(e={...e,Content:i},localStorage[n]=JSON.stringify(e),t(e))}),e},setitem:l=>{const t=JSON.stringify(l),e=JSON.stringify(l.Path);localStorage[e]=t,l.Path.author!="me"&&Se(l.Path,l.Content)},set_linkstate:(l,t)=>{localStorage["ls_"+l]=JSON.stringify(t)},get_linkstate:l=>{let t=localStorage["ls_"+l];return t?JSON.parse(t):[]},has:l=>{const t=JSON.stringify(l);return localStorage[t]!=null}};function De(l){let t=document.createElement("textarea");return t.innerHTML=l,t.value}var Fe=l=>new Promise((t,e)=>{console.log("rename_note",l);const n=document.createElement("div");n.classList.add("bg"),n.addEventListener("click",v=>{v.target==n&&(n.remove(),e())}),document.querySelector("#page").appendChild(n);const i=document.createElement("div");i.classList.add("container"),n.appendChild(i);const a=document.createElement("h2");a.innerHTML="rename note";const s=document.createElement("input");s.value=l;const r=document.createElement("p"),o=()=>{const v=s.value;v!=l&&W(v)?(t(v),n.remove()):r.innerHTML="invalid name"};s.addEventListener("keyup",v=>{v.key=="Enter"&&o()});const c=document.createElement("button");c.innerHTML="rename",c.onclick=()=>o(),i.appendChild(a),i.appendChild(s),i.appendChild(r),i.appendChild(document.createElement("br")),i.appendChild(c)});function ze(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var te={},Ie={get exports(){return te},set exports(l){te=l}};const je={},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"})),Ge=Me(Xe);(function(l){var t;(function(){t=function(e,n,i,a){a=a||{},this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=a.flags||{},this.memoized={},this.loaded=!1;var s=this,r,o,c,v,y;e&&(s.dictionary=e,n&&i?b():typeof window<"u"&&"chrome"in window&&"extension"in window.chrome&&"getURL"in window.chrome.extension?(a.dictionaryPath?r=a.dictionaryPath:r="typo/dictionaries",n||h(chrome.extension.getURL(r+"/"+e+"/"+e+".aff"),f),i||h(chrome.extension.getURL(r+"/"+e+"/"+e+".dic"),m)):(a.dictionaryPath?r=a.dictionaryPath:typeof __dirname<"u"?r=__dirname+"/dictionaries":r="./dictionaries",n||h(r+"/"+e+"/"+e+".aff",f),i||h(r+"/"+e+"/"+e+".dic",m)));function h(u,_){var p=s._readFile(u,null,a.asyncLoad);a.asyncLoad?p.then(function(d){_(d)}):_(p)}function f(u){n=u,i&&b()}function m(u){i=u,n&&b()}function b(){for(s.rules=s._parseAFF(n),s.compoundRuleCodes={},o=0,v=s.compoundRules.length;o<v;o++){var u=s.compoundRules[o];for(c=0,y=u.length;c<y;c++)s.compoundRuleCodes[u[c]]=[]}"ONLYINCOMPOUND"in s.flags&&(s.compoundRuleCodes[s.flags.ONLYINCOMPOUND]=[]),s.dictionaryTable=s._parseDIC(i);for(o in s.compoundRuleCodes)s.compoundRuleCodes[o].length===0&&delete s.compoundRuleCodes[o];for(o=0,v=s.compoundRules.length;o<v;o++){var _=s.compoundRules[o],p="";for(c=0,y=_.length;c<y;c++){var d=_[c];d in s.compoundRuleCodes?p+="("+s.compoundRuleCodes[d].join("|")+")":p+=d}s.compoundRules[o]=new RegExp(p,"i")}s.loaded=!0,a.asyncLoad&&a.loadedCallback&&a.loadedCallback(s)}return this},t.prototype={load:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);return this},_readFile:function(e,n,i){if(n=n||"utf8",typeof XMLHttpRequest<"u"){var a,s=new XMLHttpRequest;return s.open("GET",e,i),i&&(a=new Promise(function(o,c){s.onload=function(){s.status===200?o(s.responseText):c(s.statusText)},s.onerror=function(){c(s.statusText)}})),s.overrideMimeType&&s.overrideMimeType("text/plain; charset="+n),s.send(null),i?a:s.responseText}else if(typeof ze<"u"){var r=Ge;try{if(r.existsSync(e))return r.readFileSync(e,n);console.log("Path "+e+" does not exist.")}catch(o){return console.log(o),""}}},_parseAFF:function(e){var n={},i,a,s,r,o,c,v,y,h=e.split(/\r?\n/);for(o=0,v=h.length;o<v;o++)if(i=this._removeAffixComments(h[o]),i=i.trim(),!!i){var f=i.split(/\s+/),m=f[0];if(m=="PFX"||m=="SFX"){var b=f[1],u=f[2];s=parseInt(f[3],10);var _=[];for(c=o+1,y=o+1+s;c<y;c++){a=h[c],r=a.split(/\s+/);var p=r[2],d=r[3].split("/"),C=d[0];C==="0"&&(C="");var g=this.parseRuleCodes(d[1]),k=r[4],L={};L.add=C,g.length>0&&(L.continuationClasses=g),k!=="."&&(m==="SFX"?L.match=new RegExp(k+"$"):L.match=new RegExp("^"+k)),p!="0"&&(m==="SFX"?L.remove=new RegExp(p+"$"):L.remove=p),_.push(L)}n[b]={type:m,combineable:u=="Y",entries:_},o+=s}else if(m==="COMPOUNDRULE"){for(s=parseInt(f[1],10),c=o+1,y=o+1+s;c<y;c++)i=h[c],r=i.split(/\s+/),this.compoundRules.push(r[1]);o+=s}else m==="REP"?(r=i.split(/\s+/),r.length===3&&this.replacementTable.push([r[1],r[2]])):this.flags[m]=f[1]}return n},_removeAffixComments:function(e){return e.match(/^\s*#/,"")?"":e},_parseDIC:function(e){e=this._removeDicComments(e);var n=e.split(/\r?\n/),i={};function a(O,re){i.hasOwnProperty(O)||(i[O]=null),re.length>0&&(i[O]===null&&(i[O]=[]),i[O].push(re))}for(var s=1,r=n.length;s<r;s++){var o=n[s];if(o){var c=o.split("/",2),v=c[0];if(c.length>1){var y=this.parseRuleCodes(c[1]);(!("NEEDAFFIX"in this.flags)||y.indexOf(this.flags.NEEDAFFIX)==-1)&&a(v,y);for(var h=0,f=y.length;h<f;h++){var m=y[h],b=this.rules[m];if(b)for(var u=this._applyRule(v,b),_=0,p=u.length;_<p;_++){var d=u[_];if(a(d,[]),b.combineable)for(var C=h+1;C<f;C++){var g=y[C],k=this.rules[g];if(k&&k.combineable&&b.type!=k.type)for(var L=this._applyRule(d,k),M=0,F=L.length;M<F;M++){var z=L[M];a(z,[])}}}m in this.compoundRuleCodes&&this.compoundRuleCodes[m].push(v)}}else a(v.trim(),[])}}return i},_removeDicComments:function(e){return e=e.replace(/^\t.*$/mg,""),e},parseRuleCodes:function(e){if(e)if("FLAG"in this.flags)if(this.flags.FLAG==="long"){for(var n=[],i=0,a=e.length;i<a;i+=2)n.push(e.substr(i,2));return n}else return this.flags.FLAG==="num"?e.split(","):this.flags.FLAG==="UTF-8"?Array.from(e):e.split("");else return e.split("");else return[]},_applyRule:function(e,n){for(var i=n.entries,a=[],s=0,r=i.length;s<r;s++){var o=i[s];if(!o.match||e.match(o.match)){var c=e;if(o.remove&&(c=c.replace(o.remove,"")),n.type==="SFX"?c=c+o.add:c=o.add+c,a.push(c),"continuationClasses"in o)for(var v=0,y=o.continuationClasses.length;v<y;v++){var h=this.rules[o.continuationClasses[v]];h&&(a=a.concat(this._applyRule(c,h)))}}}return a},check:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(n))return!0;if(n.toUpperCase()===n){var i=n[0]+n.substring(1).toLowerCase();if(this.hasFlag(i,"KEEPCASE"))return!1;if(this.checkExact(i)||this.checkExact(n.toLowerCase()))return!0}var a=n[0].toLowerCase()+n.substring(1);if(a!==n){if(this.hasFlag(a,"KEEPCASE"))return!1;if(this.checkExact(a))return!0}return!1},checkExact:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=this.dictionaryTable[e],i,a;if(typeof n>"u"){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN){for(i=0,a=this.compoundRules.length;i<a;i++)if(e.match(this.compoundRules[i]))return!0}}else{if(n===null)return!0;if(typeof n=="object"){for(i=0,a=n.length;i<a;i++)if(!this.hasFlag(e,"ONLYINCOMPOUND",n[i]))return!0}}return!1},hasFlag:function(e,n,i){if(!this.loaded)throw"Dictionary not loaded.";return!!(n in this.flags&&(typeof i>"u"&&(i=Array.prototype.concat.apply([],this.dictionaryTable[e])),i&&i.indexOf(this.flags[n])!==-1))},alphabet:"",suggest:function(e,n){if(!this.loaded)throw"Dictionary not loaded.";if(n=n||5,this.memoized.hasOwnProperty(e)){var i=this.memoized[e].limit;if(n<=i||this.memoized[e].suggestions.length<i)return this.memoized[e].suggestions.slice(0,n)}if(this.check(e))return[];for(var a=0,s=this.replacementTable.length;a<s;a++){var r=this.replacementTable[a];if(e.indexOf(r[0])!==-1){var o=e.replace(r[0],r[1]);if(this.check(o))return[o]}}var c=this;c.alphabet="abcdefghijklmnopqrstuvwxyz";function v(h,f){var m={},b,u,_,p,d=c.alphabet.length;if(typeof h=="string"){var C=h;h={},h[C]=!0}for(var C in h)for(b=0,_=C.length+1;b<_;b++){var g=[C.substring(0,b),C.substring(b)];if(g[1]&&(p=g[0]+g[1].substring(1),(!f||c.check(p))&&(p in m?m[p]+=1:m[p]=1)),g[1].length>1&&g[1][1]!==g[1][0]&&(p=g[0]+g[1][1]+g[1][0]+g[1].substring(2),(!f||c.check(p))&&(p in m?m[p]+=1:m[p]=1)),g[1]){var k=g[1].substring(0,1).toUpperCase()===g[1].substring(0,1)?"uppercase":"lowercase";for(u=0;u<d;u++){var L=c.alphabet[u];k==="uppercase"&&(L=L.toUpperCase()),L!=g[1].substring(0,1)&&(p=g[0]+L+g[1].substring(1),(!f||c.check(p))&&(p in m?m[p]+=1:m[p]=1))}}if(g[1])for(u=0;u<d;u++){var k=g[0].substring(-1).toUpperCase()===g[0].substring(-1)&&g[1].substring(0,1).toUpperCase()===g[1].substring(0,1)?"uppercase":"lowercase",L=c.alphabet[u];k==="uppercase"&&(L=L.toUpperCase()),p=g[0]+L+g[1],(!f||c.check(p))&&(p in m?m[p]+=1:m[p]=1)}}return m}function y(h){var f=v(h),m=v(f,!0),b=m;for(var u in f)c.check(u)&&(u in b?b[u]+=f[u]:b[u]=f[u]);var _,p=[];for(_ in b)b.hasOwnProperty(_)&&p.push([_,b[_]]);function d(L,M){var F=L[1],z=M[1];return F<z?-1:F>z?1:M[0].localeCompare(L[0])}p.sort(d).reverse();var C=[],g="lowercase";h.toUpperCase()===h?g="uppercase":h.substr(0,1).toUpperCase()+h.substr(1).toLowerCase()===h&&(g="capitalized");var k=n;for(_=0;_<Math.min(k,p.length);_++)g==="uppercase"?p[_][0]=p[_][0].toUpperCase():g==="capitalized"&&(p[_][0]=p[_][0].substr(0,1).toUpperCase()+p[_][0].substr(1)),!c.hasFlag(p[_][0],"NOSUGGEST")&&C.indexOf(p[_][0])==-1?C.push(p[_][0]):k++;return C}return this.memoized[e]={suggestions:y(e),limit:n},this.memoized[e].suggestions}}})(),l.exports=t})(Ie);const _e=te;var le,A;async function Je(){return new Promise((t,e)=>{setTimeout(()=>{le=new _e("de",null,null,{dictionaryPath:"/dictionaries"}),A=new _e("en_GB",null,null,{dictionaryPath:"/dictionaries"}),t(!0)},500)})}function be(l){if(Be(l))return;const t=document.createElement("span");return t.classList.add("typo"),t.innerHTML=l,t.addEventListener("contextmenu",e=>{const n=Ye(l);N.fill(t,n),e.preventDefault()}),t}function Be(l){return l=l.replace(/\p{P}$/ug,""),A===void 0||/\d/.test(l)||(l=l.trim(),l.length<2)?!0:!(!le.check(l)&&!A.check(l))}function Ye(l){if(l=l.replace(/\p{P}$/ug,""),A===void 0)return[];if(/\d/.test(l))return[];if(l=l.trim(),l.length<2)return[];let t=A.suggest(l,5);return t=t.concat(le.suggest(l,5)),t=t.filter((e,n)=>t.indexOf(e)===n),t}var V=[],w={path:"_home:"+K(D)};let R=[],N=new We;class ae{constructor(t,e,n,i=[]){E(this,"path");E(this,"txt");E(this,"element");E(this,"head");E(this,"body");E(this,"username");e==null&&(e=t),this.path=e;const a=Y(e);this.username=a.author;let s=T.getitem(a,r=>{this.body.free(),this.body.render(r.Content)});this.txt=s.Content,this.txt==null&&(this.txt="<error getting content>"),this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new Ve(t,K(D),this,n),this.body=new Ke(this.txt,this,e,i),this.element.appendChild(this.head.element),this.element.appendChild(this.body.element)}close(){this.body.save(),this.body.free(),this.element.remove()}}class Ve{constructor(t,e,n,i){E(this,"element");E(this,"title","");E(this,"title_element");E(this,"note");E(this,"istop");E(this,"username","");this.title_element=document.createElement("span"),this.title_element.classList.add("title"),this.note=n,this.username=e,i!=null&&this.title_element.addEventListener("click",a=>{Fe(this.note.path).then(s=>{this.note.path=s;const r=i.rename(s);this.set_title(r),this.note.body.get_links().forEach(o=>{o.name.startsWith(".")&&(o.close(),o.rename(o.path))}),this.note.body.save_lazy()})}),this.set_title(t),this.istop=i==null,this.element=document.createElement("div"),this.element.classList.add("head"),this.create_expand_button(),this.create_share_button()}set_title(t){t=ie(t),t=t.replaceAll("_"," "),t.endsWith(":")&&(t=t.slice(0,-1)),this.title_element.innerHTML=t,this.title=t}create_share_button(){let t=document.createElement("span");t.innerHTML="share",t.classList.add("sharebutton"),t.classList.add("navbutton"),t.addEventListener("click",async e=>{let n=this.note.path.startsWith("#")?this.note.path.slice(1):this.note.path;await navigator.clipboard.writeText(location.origin+"?"+n),t.innerHTML="copied"}),this.element.appendChild(t)}create_expand_button(){const t=document.createElement("span");t.classList.add("expandbutton"),t.classList.add("navbutton"),this.element.appendChild(t);const e=document.querySelector("#page"),n=a=>{e.removeChild(e.firstChild),R.pop();let s=R[R.length-1],r=new ae(s,s);e.append(r.element),V=[{element:r.head.title_element,fullpath:s}];let o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+s.slice(1);window.history.pushState({path:o},"",o)},i=a=>{this.title=ie(this.note.path),this.title_element.innerHTML=this.title,e.removeChild(e.firstChild),e.appendChild(this.note.element),t.innerHTML="⇦",R.push(this.note.path),t.removeEventListener("click",i),t.addEventListener("click",n),t.focus(),window.location.origin+""+this.note.path.slice(1);let s=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+this.note.path.slice(1);window.history.pushState({path:s},"",s),w.path=this.note.path};this.istop?R.length>1?(t.innerHTML="⇦",t.addEventListener("click",n)):R.push(this.note.path):(t.innerHTML="⇨",t.addEventListener("click",i)),this.element.appendChild(this.title_element)}}var J=null;function ne(l){l!=J&&(J!=null&&J.body.set_editable(!1),l!=null&&l.body.set_editable(!0),J=l)}class Ke{constructor(t,e,n,i=[]){E(this,"element");E(this,"txt");E(this,"note");E(this,"can_write",!1);E(this,"saves_pending",!1);E(this,"on_paste",t=>{for(var e=t.target;e.nodeName!="DIV";)if(e=e.parentElement,e==null)return;if(e!=this.element)return;let n=t.clipboardData.getData("text");if(n=De(n),n.startsWith(window.location.origin)&&n.includes("?")){console.log("pasting link"),t.preventDefault();let i=n.split("?")[1];if(W(i)||(i="#"+i),i.startsWith(this.note.path)&&i.length>this.note.path.length)i=i.substring(this.note.path.length);else if(this.note.path.includes(".")){const s=this.note.path.split(".").slice(0,-1).join(".");i.startsWith(s)&&i.length>s.length&&(i="."+i.substring(s.length))}const a=new ge(i,this.note,!1);this.insert_text(a.element)}else if(console.log("pasting normal text",n),t.preventDefault(),this.insert_text(document.createTextNode(n)),n.includes(`
`)){let i=this.get_content_text();this.render(i)}this.save_lazy()});E(this,"editable",!1);if(i.length==0&&(i=[e.path]),this.txt=t,this.element=document.createElement("div"),this.element.classList.add("content"),this.note=e,this.can_write=e.username==K(D),t==""){let s=document.createElement("p");s.innerHTML="<br>",this.element.appendChild(s)}else t.split(`
`).forEach(r=>{let o=this.make_line(r);this.element.appendChild(o)});this.element.addEventListener("click",s=>{(s.target.parentElement==this.element||s.target==this.element)&&(ne(this.note),N.clear())}),this.element.addEventListener("input",s=>this.on_input(s)),this.element.addEventListener("blur",s=>{this.editable&&ne(null)}),this.element.addEventListener("paste",this.on_paste),this.element.addEventListener("copy",this.on_copy);const a=T.get_linkstate(n);this.get_links().forEach((s,r)=>{a[r]&&!i.includes(s.path)&&s.open(i.concat([s.path])),se(s.path)})}on_copy(t){t.preventDefault();let n=window.getSelection().toString().replaceAll(`

`,`
`);t.clipboardData.setData("text/plain",n)}render(t){if(this.txt=t,this.free(),t==""){let e=document.createElement("p");e.innerHTML="<br>",this.element.appendChild(e)}else t.split(`
`).forEach(n=>{let i=this.make_line(n);this.element.appendChild(i)})}insert_text(t){const e=window.getSelection();e.deleteFromDocument(),e.getRangeAt(0).insertNode(t),t.parentElement instanceof HTMLBRElement&&(t.parentElement.replaceWith(t),console.log("replaced br")),e.collapseToEnd();const n=document.createRange();n.selectNodeContents(t),n.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(n)}free(){this.get_links().forEach(e=>{e.remove()}),this.element.innerHTML=""}get_links(){let t=[];return this.element.childNodes.forEach(e=>{e.childNodes.forEach(n=>{if(H(n)){const i=U(n.id);i!=null&&t.push(i)}})}),t}make_line(t,e=!0){if(t==""){let s=document.createElement("p");return s.innerHTML="<br>",s}t=t.replaceAll(" "," "),t=t.replace(/(\S)\u00A0(\S)/g,"$1 $2");let n=t.split(/(\s+)/),i=document.createElement("p");return n.map(s=>{if(W(s))return new ge(s,this.note,e).element;if(Re(s))return Oe(s);{const r=be(s);return r??new Text(s)}}).forEach(s=>{i.appendChild(s)}),i}spellcheck(){this.element.childNodes.forEach(t=>{t.nodeName=="P"&&t.childNodes.forEach(e=>{if(e.nodeType==Node.TEXT_NODE){const n=be(e.textContent);if(n!=null){e.replaceWith(n);return}}})})}async on_input(t){var c,v,y,h,f,m,b,u,_,p;if(this.element.contentEditable!="true"||t.target!=this.element||t.type=="input"&&["¨"].includes(t.data))return;N.clear();const e=window.getSelection(),n=e==null?void 0:e.focusNode;var i=e==null?void 0:e.focusOffset,a;if(n.nodeName=="P")a=n;else if(n.nodeName=="DIV")a=n.firstChild;else if(((c=n.parentElement)==null?void 0:c.nodeName)=="P")a=n.parentElement;else if(((y=(v=n.parentElement)==null?void 0:v.parentElement)==null?void 0:y.nodeName)=="P")a=(h=n.parentElement)==null?void 0:h.parentElement;else{this.element.childNodes.forEach(d=>{if(d.nodeName!="P"){const C=document.createElement("p");d.nodeName=="DIV"?(d.replaceWith(C),C.appendChild(d.firstChild)):(d.replaceWith(C),C.appendChild(d)),Z(C,0)}});return}if(t.inputType=="insertParagraph"){const d=a.previousElementSibling;((f=d.lastChild)==null?void 0:f.textContent)==""&&((m=d.lastChild)==null||m.remove()),this.reload_line(d),N.clear(),(u=a.firstChild)==null||u.replaceWith((b=a.firstChild)==null?void 0:b.textContent);const C=this.reload_line(a);Z(C,0);return}let s=this.get_line_text(a);if(s!=""){let d=n;if(n.nodeName=="P"?(d=n.childNodes[i],i=0):((_=n.parentElement)==null?void 0:_.nodeName)=="SPAN"&&(d=n.parentElement),d==null){console.warn("prev is undefined");return}for(d=d.previousSibling;d!=null;)i+=(p=d.textContent)==null?void 0:p.length,d=d.previousSibling}else i=0;const r=this.reload_line(a,s),o=Z(r,i);this.save_lazy(),o!=null&&t.type=="input"&&H(o)&&N.create(o)}reload_line(t,e){e==null&&(e=this.get_line_text(t));const n=this.make_line(e,!1);return t.replaceWith(n),t.childNodes.forEach(i=>{if(H(i)){const a=U(i.id);a==null||a.remove()}}),n}set_editable(t){this.can_write&&(this.editable=t,this.element.contentEditable=t.toString(),this.element.classList.toggle("editable",t),this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(n=>{var i;H(n)&&((i=U(n.id))==null||i.set_expanded(t))})}))}save(){let t=this.get_content_text();T.setitem({Path:Y(this.note.path),Content:t}),this.saves_pending=!1}save_linkstate(){const t=[];this.get_links().forEach(n=>t.push(n.is_open)),T.set_linkstate(this.note.path,t)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}get_content_text(){let t=[];return this.element.childNodes.forEach(n=>{n.nodeName=="P"&&t.push(this.get_line_text(n))}),t.join(`
`)}get_line_text(t){let e="";const n=N.open;return n&&N.clear(),t.childNodes.forEach(i=>{if(H(i)){const s=U(i.id);s==null?e+="":s!=null&&s.expanded?e+=i.textContent:e+=s==null?void 0:s.name}else(i.nodeName=="#text"||i.nodeName=="SPAN")&&(e+=i.textContent)}),n&&N.restore(),e}}function Z(l,t){var i,a;let e=l.firstChild;for(;t>((i=e==null?void 0:e.textContent)==null?void 0:i.length);)t-=(a=e==null?void 0:e.textContent)==null?void 0:a.length,e=e==null?void 0:e.nextSibling;let n=null;return e!=null&&(e.nodeName=="SPAN"?(n=e,e=e.firstChild):n=e),oe(e,t),n}function oe(l,t){var e=document.createRange(),n=window.getSelection();try{e.setStart(l,t),e.collapse(!0)}catch{}n!=null&&(n.removeAllRanges(),n.addRange(e))}function ie(l){l.startsWith("..")?l=l.slice(2):(l.startsWith("#")||l.startsWith("_")||l.startsWith("."))&&(l=l.slice(1));let t="",e=l.split(".").map(n=>n.split("@")[0]).map(n=>{const i=n.split(":");return i.length>1&&(t=i[1]),n.split(":")[0]}).join(".");if(t!=""){const n="<span class='author'> by "+t+"</span>";e+=n}return e}new TextEncoder;function $e(l){let t,e,n,i,a,s,r,o,c,v,y;return{c(){t=I("h2"),e=$(),n=I("button"),i=he("❋"),a=$(),s=I("button"),r=he(l[1]),o=$(),c=I("div"),this.h()},l(h){t=j(h,"H2",{id:!0});var f=X(t);f.forEach(x),e=Q(h),n=j(h,"BUTTON",{id:!0});var m=X(n);i=ce(m,"❋"),m.forEach(x),a=Q(h),s=j(h,"BUTTON",{id:!0});var b=X(s);r=ce(b,l[1]),b.forEach(x),o=Q(h),c=j(h,"DIV",{id:!0});var u=X(c);u.forEach(x),this.h()},h(){G(t,"id","fullheader"),G(n,"id","light_btn"),G(s,"id","loggedin_btn"),G(c,"id","page")},m(h,f){S(h,t,f),t.innerHTML=l[0],S(h,e,f),S(h,n,f),pe(n,i),S(h,a,f),S(h,s,f),pe(s,r),S(h,o,f),S(h,c,f),v||(y=[ue(n,"click",l[2]),ue(s,"click",l[4])],v=!0)},p(h,[f]){f&1&&(t.innerHTML=h[0])},i:de,o:de,d(h){h&&x(t),h&&x(e),h&&x(n),h&&x(a),h&&x(s),h&&x(o),h&&x(c),v=!1,xe(y)}}}function Qe(l,t,e){let n,i;fe(l,me,u=>e(10,n=u)),fe(l,D,u=>e(11,i=u));let{data:a}=t;var s,r="<br>";s=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,r=s,we().then(f);let o;const c=`Click me and write something: xzxysl ... &^

You can create a new link with # followed by text, for example: #link:${i} #recursion #whatever

Click on a link to open a page. If the page already exists, it will be displayed to you.

Almost forgot! Create an account: {}/login, and then you can create a public note.

If you want to learn more, check out: #sciepedia:kormann
`;let v,y,h=i[0];async function f(){He(),window.fetch=a.fetch,n&&document.body.classList.add("light"),o=document.createElement("div"),o.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",o.id="pred",s=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,e(0,r=s);let u=window.location.search;y=[w.path],u&&u.length>1&&(u=u.slice(1),W(u)||(u="#"+u),W(u)&&(y.push(w.path),w.path=u)),v=document.querySelector("#page"),window.addEventListener("scroll",d=>{e(0,r=s);let C={element:{offsetTop:0},fullpath:"<span id=homebtn>sciepedia</span>"};V.forEach(g=>{window.scrollY+g.element.offsetHeight>g.element.offsetTop&&C.element.offsetTop<g.element.offsetTop&&(C=g)}),e(0,r=C.fullpath),e(0,r=ie(r))}),T.setitem({Path:Y("#tutorial"),Content:c.replace("{}",window.location.origin)});let _=Y(w.path);T.has(_)||T.setitem({Path:_,Content:`welcome to sciepedia
try out the tutorial: #tutorial`});let p=new ae(w.path,w.path);V.push({element:p.head.title_element,fullpath:w.path}),v.appendChild(p.element),document.body.addEventListener("click",d=>{d.target==document.body&&ne(null)}),window.addEventListener("onunload",d=>{localStorage.unloading=!0,p.body.free(),localStorage.unloaded=!0}),Je().then(()=>{p.body.spellcheck()})}function m(){Ne(me,n=!n,n)}const b=()=>{window.location.pathname="login"};return l.$$set=u=>{"data"in u&&e(3,a=u.data)},[r,h,m,a,b]}class nt extends ye{constructor(t){super(),Le(this,t,Qe,$e,ke,{data:3})}}export{nt as component,tt as universal};
