var Ee=Object.defineProperty;var Ce=(l,t,e)=>t in l?Ee(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var E=(l,t,e)=>(Ce(l,typeof t!="symbol"?t+"":t,e),e);import{J as W,S as ke,i as ye,s as Le,k as X,a as Q,q as he,l as G,m as J,h as x,c as Z,r as ce,n as B,b as T,G as pe,K as ue,H as de,L as xe,I as fe,t as we,M as Ne}from"../chunks/index.6cba8ff5.js";import{u as M,g as Te,s as Se,i as D,a as Me,b as Re,m as Oe,l as me}from"../chunks/backend.ebab5f51.js";function Pe({fetch:l,params:t}){return{fetch:l}}const tt=Object.freeze(Object.defineProperty({__proto__:null,load:Pe},Symbol.toStringTag,{value:"Module"}));var K=new Set,H=[],ee=!1;function He(){for(let l=0;l<localStorage.length;l++){const t=localStorage.key(l);t.startsWith("#")&&le(t)}}function le(l){const t=l.split("."),e=K.size;for(let n=0;n<t.length;n++){const i=t.slice(0,n+1).join(".");K.add(i)}e!=K.size&&(ee=!0)}function ze(l){ee&&(H=Array.from(K),H.sort(),ee=!1);for(var t=[],e=0;e<H.length;e++)H[e].toLowerCase().startsWith(l.toLowerCase())&&t.push(H[e]);return t}class Fe{constructor(){E(this,"element");E(this,"parent",null);E(this,"open",!1)}create(t){this.open=!0,document.addEventListener("click",a=>{a.target.parentElement!=this.element&&this.clear()});const e=F(t.id),n=e.path;this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="";const i=ze(n).filter(a=>a!=n);i.length!=0&&(i.forEach(a=>{const s=document.createElement("p");s.innerHTML=a,this.element.appendChild(s),s.addEventListener("click",()=>{e.rename(a),this.clear()})}),t.appendChild(this.element))}fill(t,e){console.log("filling autocomplete ",t),this.open=!0,document.addEventListener("click",n=>{n.target.parentElement!=this.element&&this.clear()}),this.parent=t,this.element=document.createElement("div"),this.element.id="autocomplete",this.element.innerHTML="",e.forEach(n=>{const i=document.createElement("p");i.innerHTML=n,this.element.appendChild(i),i.addEventListener("click",()=>{const a=new Text(n);t.replaceWith(a),oe(a,n.length),this.clear()})}),t.appendChild(this.element)}clear(){this.open=!1,this.element!=null&&this.element.remove()}restore(){this.open=!0,this.element!=null&&this.parent.appendChild(this.element)}}let te=new Map,Ue=0;class ge{constructor(t,e,n){E(this,"name");E(this,"path");E(this,"element");E(this,"childnote",null);E(this,"is_open",!1);E(this,"parent");E(this,"expanded",!0);this.name=t,this.element=document.createElement("span"),this.parent=e,this.element.classList.add("link"),this.path=t,(this.path.endsWith(".")||this.path.endsWith(":"))&&(this.path=this.path.slice(0,this.path.length-1));var i=e.path;if(this.path.startsWith("..")){let a=i.split(".");a.length==1?this.element.classList.add("error"):(i=a.slice(0,a.length-1).join("."),this.path=i+this.path.slice(1))}else this.path.startsWith(".")&&(this.path=i+this.path);this.path.includes(":")||(this.path+=`:${W(M)}`,this.name+=`:${W(M)}`),this.element.innerHTML=t,this.element.onclick=a=>{a.target==this.element&&(this.is_open?this.close():this.open(),this.parent.body.save_linkstate())},this.element.id="link"+Ue++,te.set(this.element.id,this),n&&this.set_expanded(!1)}remove(){this.is_open&&this.close(),te.delete(this.element.id)}rename(t){if(this.path=t,t.startsWith(this.parent.path)&&this.parent.path.length<t.length){const e=t.slice(this.parent.path.length);e.startsWith(".")&&(t=e)}else if(this.parent.path.includes(".")){const e=this.parent.path.split(".").slice(0,-1).join(".");if(t.startsWith(e)){const n=t.slice(e.length);n.startsWith(".")&&(t="."+n)}}if(this.name=t,!this.expanded&&!this.is_open){let e=ve(this.name);this.element.innerHTML=e}else this.element.innerHTML=this.name;return this.parent.body.save_lazy(),oe(this.element,1),this.name}open(t=[]){this.is_open=!0,this.is_open=!0,this.element.classList.add("open"),this.childnote=new $(this.name,this.path,this,t),this.element.parentElement.appendChild(this.childnote.element),V.push({element:this.childnote.head.title_element,fullpath:this.path}),this.set_expanded(!0),le(this.path)}close(){this.element.classList.remove("open"),this.is_open&&(this.is_open=!1,this.is_open=!1,this.element.parentElement,this.childnote.close(),this.parent.body.editable||this.set_expanded(!1))}set_expanded(t){if(this.expanded=t,!t&&!this.is_open){let e=this.name;if(e=="")return;let n=ve(e);this.element.innerHTML=n}else this.element.innerHTML=this.name}}function F(l){return te.get(l)}function ve(l){let t="";[".",":"].forEach(a=>{l.endsWith(a)&&(t=a,l=l.slice(0,l.length-1))});let n=l.replace(/.*\./g,"").replace(/[@,:].*/g,"");return["#","_"].forEach(a=>{n.startsWith(a)&&(n=n.slice(1))}),n=n.replaceAll("_"," "),n+t}function z(l){return l instanceof HTMLSpanElement&&l.classList.contains("link")}function U(l){let t=l.startsWith("#");if(!l.startsWith("#")&&!l.startsWith("_"))throw new Error("invalid path: "+l);l=l.substring(1);let e="None";const n=l.split(".").map(i=>{const a=i.split(":");return a.length>1&&(e=a[1]),a[0]});return{pub:t,author:e,location:n}}let N={getitem:(l,t)=>{var e={Path:l,Content:"…"};const n=JSON.stringify(l);if(N.has(l))try{e=JSON.parse(localStorage[n]),typeof e=="string"&&(e={Path:l,Content:e})}catch{console.warn("error parsing json",localStorage[n]),e={Path:l,Content:"<Error>"}}return Te(l).then(i=>{console.log("got new content",i),t({...e,Content:i})}),e},setitem:l=>{const t=JSON.stringify(l),e=JSON.stringify(l.Path);localStorage[e]=t,Se(l.Path,l.Content)},set_linkstate:(l,t)=>{localStorage["ls_"+l]=JSON.stringify(t)},get_linkstate:l=>{let t=localStorage["ls_"+l];return t?JSON.parse(t):[]},has:l=>{const t=JSON.stringify(l);return localStorage[t]!=null}};function We(l){let t=document.createElement("textarea");return t.innerHTML=l,t.value}var De=l=>new Promise((t,e)=>{console.log("rename_note",l);const n=document.createElement("div");n.classList.add("bg"),n.addEventListener("click",f=>{f.target==n&&(n.remove(),e())}),document.querySelector("#page").appendChild(n);const i=document.createElement("div");i.classList.add("container"),n.appendChild(i);const a=document.createElement("h2");a.innerHTML="rename note";const s=document.createElement("input");s.value=l;const r=document.createElement("p"),o=()=>{const f=s.value;f!=l&&D(f)?(t(f),n.remove()):r.innerHTML="invalid name"};s.addEventListener("keyup",f=>{f.key=="Enter"&&o()});const c=document.createElement("button");c.innerHTML="rename",c.onclick=()=>o(),i.appendChild(a),i.appendChild(s),i.appendChild(r),i.appendChild(document.createElement("br")),i.appendChild(c)});function Ae(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ne={},Ie={get exports(){return ne},set exports(l){ne=l}};const je={},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"})),Ge=Me(Xe);(function(l){var t;(function(){t=function(e,n,i,a){a=a||{},this.dictionary=null,this.rules={},this.dictionaryTable={},this.compoundRules=[],this.compoundRuleCodes={},this.replacementTable=[],this.flags=a.flags||{},this.memoized={},this.loaded=!1;var s=this,r,o,c,f,C;e&&(s.dictionary=e,n&&i?b():typeof window<"u"&&"chrome"in window&&"extension"in window.chrome&&"getURL"in window.chrome.extension?(a.dictionaryPath?r=a.dictionaryPath:r="typo/dictionaries",n||h(chrome.extension.getURL(r+"/"+e+"/"+e+".aff"),g),i||h(chrome.extension.getURL(r+"/"+e+"/"+e+".dic"),m)):(a.dictionaryPath?r=a.dictionaryPath:typeof __dirname<"u"?r=__dirname+"/dictionaries":r="./dictionaries",n||h(r+"/"+e+"/"+e+".aff",g),i||h(r+"/"+e+"/"+e+".dic",m)));function h(_,u){var p=s._readFile(_,null,a.asyncLoad);a.asyncLoad?p.then(function(d){u(d)}):u(p)}function g(_){n=_,i&&b()}function m(_){i=_,n&&b()}function b(){for(s.rules=s._parseAFF(n),s.compoundRuleCodes={},o=0,f=s.compoundRules.length;o<f;o++){var _=s.compoundRules[o];for(c=0,C=_.length;c<C;c++)s.compoundRuleCodes[_[c]]=[]}"ONLYINCOMPOUND"in s.flags&&(s.compoundRuleCodes[s.flags.ONLYINCOMPOUND]=[]),s.dictionaryTable=s._parseDIC(i);for(o in s.compoundRuleCodes)s.compoundRuleCodes[o].length===0&&delete s.compoundRuleCodes[o];for(o=0,f=s.compoundRules.length;o<f;o++){var u=s.compoundRules[o],p="";for(c=0,C=u.length;c<C;c++){var d=u[c];d in s.compoundRuleCodes?p+="("+s.compoundRuleCodes[d].join("|")+")":p+=d}s.compoundRules[o]=new RegExp(p,"i")}s.loaded=!0,a.asyncLoad&&a.loadedCallback&&a.loadedCallback(s)}return this},t.prototype={load:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);return this},_readFile:function(e,n,i){if(n=n||"utf8",typeof XMLHttpRequest<"u"){var a,s=new XMLHttpRequest;return s.open("GET",e,i),i&&(a=new Promise(function(o,c){s.onload=function(){s.status===200?o(s.responseText):c(s.statusText)},s.onerror=function(){c(s.statusText)}})),s.overrideMimeType&&s.overrideMimeType("text/plain; charset="+n),s.send(null),i?a:s.responseText}else if(typeof Ae<"u"){var r=Ge;try{if(r.existsSync(e))return r.readFileSync(e,n);console.log("Path "+e+" does not exist.")}catch(o){return console.log(o),""}}},_parseAFF:function(e){var n={},i,a,s,r,o,c,f,C,h=e.split(/\r?\n/);for(o=0,f=h.length;o<f;o++)if(i=this._removeAffixComments(h[o]),i=i.trim(),!!i){var g=i.split(/\s+/),m=g[0];if(m=="PFX"||m=="SFX"){var b=g[1],_=g[2];s=parseInt(g[3],10);var u=[];for(c=o+1,C=o+1+s;c<C;c++){a=h[c],r=a.split(/\s+/);var p=r[2],d=r[3].split("/"),k=d[0];k==="0"&&(k="");var v=this.parseRuleCodes(d[1]),L=r[4],y={};y.add=k,v.length>0&&(y.continuationClasses=v),L!=="."&&(m==="SFX"?y.match=new RegExp(L+"$"):y.match=new RegExp("^"+L)),p!="0"&&(m==="SFX"?y.remove=new RegExp(p+"$"):y.remove=p),u.push(y)}n[b]={type:m,combineable:_=="Y",entries:u},o+=s}else if(m==="COMPOUNDRULE"){for(s=parseInt(g[1],10),c=o+1,C=o+1+s;c<C;c++)i=h[c],r=i.split(/\s+/),this.compoundRules.push(r[1]);o+=s}else m==="REP"?(r=i.split(/\s+/),r.length===3&&this.replacementTable.push([r[1],r[2]])):this.flags[m]=g[1]}return n},_removeAffixComments:function(e){return e.match(/^\s*#/,"")?"":e},_parseDIC:function(e){e=this._removeDicComments(e);var n=e.split(/\r?\n/),i={};function a(P,re){i.hasOwnProperty(P)||(i[P]=null),re.length>0&&(i[P]===null&&(i[P]=[]),i[P].push(re))}for(var s=1,r=n.length;s<r;s++){var o=n[s];if(o){var c=o.split("/",2),f=c[0];if(c.length>1){var C=this.parseRuleCodes(c[1]);(!("NEEDAFFIX"in this.flags)||C.indexOf(this.flags.NEEDAFFIX)==-1)&&a(f,C);for(var h=0,g=C.length;h<g;h++){var m=C[h],b=this.rules[m];if(b)for(var _=this._applyRule(f,b),u=0,p=_.length;u<p;u++){var d=_[u];if(a(d,[]),b.combineable)for(var k=h+1;k<g;k++){var v=C[k],L=this.rules[v];if(L&&L.combineable&&b.type!=L.type)for(var y=this._applyRule(d,L),R=0,I=y.length;R<I;R++){var j=y[R];a(j,[])}}}m in this.compoundRuleCodes&&this.compoundRuleCodes[m].push(f)}}else a(f.trim(),[])}}return i},_removeDicComments:function(e){return e=e.replace(/^\t.*$/mg,""),e},parseRuleCodes:function(e){if(e)if("FLAG"in this.flags)if(this.flags.FLAG==="long"){for(var n=[],i=0,a=e.length;i<a;i+=2)n.push(e.substr(i,2));return n}else return this.flags.FLAG==="num"?e.split(","):this.flags.FLAG==="UTF-8"?Array.from(e):e.split("");else return e.split("");else return[]},_applyRule:function(e,n){for(var i=n.entries,a=[],s=0,r=i.length;s<r;s++){var o=i[s];if(!o.match||e.match(o.match)){var c=e;if(o.remove&&(c=c.replace(o.remove,"")),n.type==="SFX"?c=c+o.add:c=o.add+c,a.push(c),"continuationClasses"in o)for(var f=0,C=o.continuationClasses.length;f<C;f++){var h=this.rules[o.continuationClasses[f]];h&&(a=a.concat(this._applyRule(c,h)))}}}return a},check:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=e.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(this.checkExact(n))return!0;if(n.toUpperCase()===n){var i=n[0]+n.substring(1).toLowerCase();if(this.hasFlag(i,"KEEPCASE"))return!1;if(this.checkExact(i)||this.checkExact(n.toLowerCase()))return!0}var a=n[0].toLowerCase()+n.substring(1);if(a!==n){if(this.hasFlag(a,"KEEPCASE"))return!1;if(this.checkExact(a))return!0}return!1},checkExact:function(e){if(!this.loaded)throw"Dictionary not loaded.";var n=this.dictionaryTable[e],i,a;if(typeof n>"u"){if("COMPOUNDMIN"in this.flags&&e.length>=this.flags.COMPOUNDMIN){for(i=0,a=this.compoundRules.length;i<a;i++)if(e.match(this.compoundRules[i]))return!0}}else{if(n===null)return!0;if(typeof n=="object"){for(i=0,a=n.length;i<a;i++)if(!this.hasFlag(e,"ONLYINCOMPOUND",n[i]))return!0}}return!1},hasFlag:function(e,n,i){if(!this.loaded)throw"Dictionary not loaded.";return!!(n in this.flags&&(typeof i>"u"&&(i=Array.prototype.concat.apply([],this.dictionaryTable[e])),i&&i.indexOf(this.flags[n])!==-1))},alphabet:"",suggest:function(e,n){if(!this.loaded)throw"Dictionary not loaded.";if(n=n||5,this.memoized.hasOwnProperty(e)){var i=this.memoized[e].limit;if(n<=i||this.memoized[e].suggestions.length<i)return this.memoized[e].suggestions.slice(0,n)}if(this.check(e))return[];for(var a=0,s=this.replacementTable.length;a<s;a++){var r=this.replacementTable[a];if(e.indexOf(r[0])!==-1){var o=e.replace(r[0],r[1]);if(this.check(o))return[o]}}var c=this;c.alphabet="abcdefghijklmnopqrstuvwxyz";function f(h,g){var m={},b,_,u,p,d=c.alphabet.length;if(typeof h=="string"){var k=h;h={},h[k]=!0}for(var k in h)for(b=0,u=k.length+1;b<u;b++){var v=[k.substring(0,b),k.substring(b)];if(v[1]&&(p=v[0]+v[1].substring(1),(!g||c.check(p))&&(p in m?m[p]+=1:m[p]=1)),v[1].length>1&&v[1][1]!==v[1][0]&&(p=v[0]+v[1][1]+v[1][0]+v[1].substring(2),(!g||c.check(p))&&(p in m?m[p]+=1:m[p]=1)),v[1]){var L=v[1].substring(0,1).toUpperCase()===v[1].substring(0,1)?"uppercase":"lowercase";for(_=0;_<d;_++){var y=c.alphabet[_];L==="uppercase"&&(y=y.toUpperCase()),y!=v[1].substring(0,1)&&(p=v[0]+y+v[1].substring(1),(!g||c.check(p))&&(p in m?m[p]+=1:m[p]=1))}}if(v[1])for(_=0;_<d;_++){var L=v[0].substring(-1).toUpperCase()===v[0].substring(-1)&&v[1].substring(0,1).toUpperCase()===v[1].substring(0,1)?"uppercase":"lowercase",y=c.alphabet[_];L==="uppercase"&&(y=y.toUpperCase()),p=v[0]+y+v[1],(!g||c.check(p))&&(p in m?m[p]+=1:m[p]=1)}}return m}function C(h){var g=f(h),m=f(g,!0),b=m;for(var _ in g)c.check(_)&&(_ in b?b[_]+=g[_]:b[_]=g[_]);var u,p=[];for(u in b)b.hasOwnProperty(u)&&p.push([u,b[u]]);function d(y,R){var I=y[1],j=R[1];return I<j?-1:I>j?1:R[0].localeCompare(y[0])}p.sort(d).reverse();var k=[],v="lowercase";h.toUpperCase()===h?v="uppercase":h.substr(0,1).toUpperCase()+h.substr(1).toLowerCase()===h&&(v="capitalized");var L=n;for(u=0;u<Math.min(L,p.length);u++)v==="uppercase"?p[u][0]=p[u][0].toUpperCase():v==="capitalized"&&(p[u][0]=p[u][0].substr(0,1).toUpperCase()+p[u][0].substr(1)),!c.hasFlag(p[u][0],"NOSUGGEST")&&k.indexOf(p[u][0])==-1?k.push(p[u][0]):L++;return k}return this.memoized[e]={suggestions:C(e),limit:n},this.memoized[e].suggestions}}})(),l.exports=t})(Ie);const _e=ne;var ae,A;async function Je(){return new Promise((t,e)=>{setTimeout(()=>{ae=new _e("de",null,null,{dictionaryPath:"/dictionaries"}),A=new _e("en_GB",null,null,{dictionaryPath:"/dictionaries"}),t(!0)},500)})}function be(l){if(Be(l))return;const t=document.createElement("span");return t.classList.add("typo"),t.innerHTML=l,t.addEventListener("contextmenu",e=>{var i;const n=Ye(l);console.log(n),w.fill(t,n),console.log("my parent is ",(i=w.element)==null?void 0:i.parentElement),e.preventDefault()}),t}function Be(l){return l=l.replace(/\p{P}$/ug,""),A===void 0||/\d/.test(l)||(l=l.trim(),l.length<2)?!0:!(!ae.check(l)&&!A.check(l))}function Ye(l){if(l=l.replace(/\p{P}$/ug,""),A===void 0)return[];if(/\d/.test(l))return[];if(l=l.trim(),l.length<2)return[];let t=A.suggest(l,5);return t=t.concat(ae.suggest(l,5)),t=t.filter((e,n)=>t.indexOf(e)===n),t}var V=[];console.log(W(M));var S={path:"_home:"+W(M)};let O=[],w=new Fe;class ${constructor(t,e,n,i=[]){E(this,"path");E(this,"txt");E(this,"element");E(this,"head");E(this,"body");E(this,"username");e==null&&(e=t),this.path=e;const a=U(e);this.username=a.author;let s=N.getitem(a,r=>{this.body.free(),this.body.render(r.Content)});this.txt=s.Content,this.txt==null&&(this.txt="<error getting content>"),this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new Ke(t,M,this,n),this.body=new Ve(this.txt,this,e,i),this.element.appendChild(this.head.element),this.element.appendChild(this.body.element)}close(){this.body.save(),this.body.free(),this.element.remove()}}class Ke{constructor(t,e,n,i){E(this,"element");E(this,"title","");E(this,"title_element");E(this,"note");E(this,"istop");E(this,"username","");this.title_element=document.createElement("span"),this.title_element.classList.add("title"),this.note=n,this.username=e,i!=null&&this.title_element.addEventListener("click",a=>{De(this.note.path).then(s=>{this.note.path=s;const r=i.rename(s);this.set_title(r),this.note.body.get_links().forEach(o=>{o.name.startsWith(".")&&(o.close(),o.rename(o.path))}),this.note.body.save_lazy()})}),this.set_title(t),this.istop=i==null,this.element=document.createElement("div"),this.element.classList.add("head"),this.create_expand_button(),this.create_share_button()}set_title(t){t=se(t),t=t.replaceAll("_"," "),t.endsWith(":")&&(t=t.slice(0,-1)),this.title_element.innerHTML=t,this.title=t}create_share_button(){let t=document.createElement("span");t.innerHTML="share",t.classList.add("sharebutton"),t.classList.add("navbutton"),t.addEventListener("click",async e=>{let n=this.note.path.startsWith("#")?this.note.path.slice(1):this.note.path;await navigator.clipboard.writeText(location.origin+"?"+n),t.innerHTML="copied"}),this.element.appendChild(t)}create_expand_button(){const t=document.createElement("span");t.classList.add("expandbutton"),t.classList.add("navbutton"),this.element.appendChild(t);const e=document.querySelector("#page"),n=a=>{e.removeChild(e.firstChild),O.pop();let s=O[O.length-1],r=new $(s,"",s);e.append(r.element),V=[{element:r.head.title_element,fullpath:s}];let o=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+s.slice(1);window.history.pushState({path:o},"",o)},i=a=>{this.title=se(this.note.path),this.title_element.innerHTML=this.title,e.removeChild(e.firstChild),e.appendChild(this.note.element),t.innerHTML="⇦",O.push(this.note.path),t.removeEventListener("click",i),t.addEventListener("click",n),t.focus(),window.location.origin+""+this.note.path.slice(1);let s=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+this.note.path.slice(1);window.history.pushState({path:s},"",s),S.path=this.note.path};this.istop?O.length>1?(t.innerHTML="⇦",t.addEventListener("click",n)):O.push(this.note.path):(t.innerHTML="⇨",t.addEventListener("click",i)),this.element.appendChild(this.title_element)}}var Y=null;function ie(l){l!=Y&&(Y!=null&&Y.body.set_editable(!1),l!=null&&l.body.set_editable(!0),Y=l)}class Ve{constructor(t,e,n,i=[]){E(this,"element");E(this,"txt");E(this,"note");E(this,"can_write",!1);E(this,"saves_pending",!1);E(this,"on_paste",t=>{for(var e=t.target;e.nodeName!="DIV";)if(e=e.parentElement,e==null)return;if(e!=this.element)return;let n=t.clipboardData.getData("text");if(n=We(n),n.startsWith(window.location.origin)&&n.includes("?")){console.log("pasting link"),t.preventDefault();let i=n.split("?")[1];if(D(i)||(i="#"+i),i.startsWith(this.note.path)&&i.length>this.note.path.length)i=i.substring(this.note.path.length);else if(this.note.path.includes(".")){const s=this.note.path.split(".").slice(0,-1).join(".");i.startsWith(s)&&i.length>s.length&&(i="."+i.substring(s.length))}const a=new ge(i,this.note,!1);this.insert_text(a.element)}else if(console.log("pasting normal text",n),t.preventDefault(),this.insert_text(document.createTextNode(n)),n.includes(`
`)){let i=this.get_content_text();this.render(i)}this.save_lazy()});E(this,"editable",!1);if(i.length==0&&(i=[e.path]),this.txt=t,this.element=document.createElement("div"),this.element.classList.add("content"),this.note=e,this.can_write=e.username==W(M),t==""){let s=document.createElement("p");s.innerHTML="<br>",this.element.appendChild(s)}else t.split(`
`).forEach(r=>{let o=this.make_line(r);this.element.appendChild(o)});this.element.addEventListener("click",s=>{(s.target.parentElement==this.element||s.target==this.element)&&(ie(this.note),w.clear())}),this.element.addEventListener("input",s=>this.on_input(s)),this.element.addEventListener("blur",s=>{this.editable&&ie(null)}),this.element.addEventListener("paste",this.on_paste),this.element.addEventListener("copy",this.on_copy);const a=N.get_linkstate(n);this.get_links().forEach((s,r)=>{a[r]&&!i.includes(s.path)&&s.open(i.concat([s.path])),le(s.path)})}on_copy(t){t.preventDefault();let n=window.getSelection().toString().replaceAll(`

`,`
`);t.clipboardData.setData("text/plain",n)}render(t){if(this.txt=t,this.free(),t==""){let e=document.createElement("p");e.innerHTML="<br>",this.element.appendChild(e)}else t.split(`
`).forEach(n=>{let i=this.make_line(n);this.element.appendChild(i)})}insert_text(t){const e=window.getSelection();e.deleteFromDocument(),e.getRangeAt(0).insertNode(t),t.parentElement instanceof HTMLBRElement&&(t.parentElement.replaceWith(t),console.log("replaced br")),e.collapseToEnd();const n=document.createRange();n.selectNodeContents(t),n.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(n)}free(){this.get_links().forEach(e=>{e.remove()}),this.element.innerHTML=""}get_links(){let t=[];return this.element.childNodes.forEach(e=>{e.childNodes.forEach(n=>{if(z(n)){const i=F(n.id);i!=null&&t.push(i)}})}),t}make_line(t,e=!0){if(t==""){let s=document.createElement("p");return s.innerHTML="<br>",s}t=t.replaceAll(" "," "),t=t.replace(/(\S)\u00A0(\S)/g,"$1 $2");let n=t.split(/(\s+)/),i=document.createElement("p");return n.map(s=>{if(D(s))return new ge(s,this.note,e).element;if(Re(s))return Oe(s);{const r=be(s);return r??new Text(s)}}).forEach(s=>{i.appendChild(s)}),i}spellcheck(){this.element.childNodes.forEach(t=>{t.nodeName=="P"&&t.childNodes.forEach(e=>{if(e.nodeType==Node.TEXT_NODE){const n=be(e.textContent);if(n!=null){e.replaceWith(n);return}}})})}async on_input(t){var c,f,C,h,g,m,b,_,u,p;if(this.element.contentEditable!="true"||t.target!=this.element||t.type=="input"&&["¨"].includes(t.data))return;w.clear();const e=window.getSelection(),n=e==null?void 0:e.focusNode;var i=e==null?void 0:e.focusOffset,a;if(n.nodeName=="P")a=n;else if(n.nodeName=="DIV")a=n.firstChild;else if(((c=n.parentElement)==null?void 0:c.nodeName)=="P")a=n.parentElement;else if(((C=(f=n.parentElement)==null?void 0:f.parentElement)==null?void 0:C.nodeName)=="P")a=(h=n.parentElement)==null?void 0:h.parentElement;else{this.element.childNodes.forEach(d=>{if(d.nodeName!="P"){const k=document.createElement("p");d.nodeName=="DIV"?(d.replaceWith(k),k.appendChild(d.firstChild)):(d.replaceWith(k),k.appendChild(d)),q(k,0)}});return}if(t.inputType=="insertParagraph"){const d=a.previousElementSibling;((g=d.lastChild)==null?void 0:g.textContent)==""&&((m=d.lastChild)==null||m.remove()),this.reload_line(d),w.clear(),(_=a.firstChild)==null||_.replaceWith((b=a.firstChild)==null?void 0:b.textContent);const k=this.reload_line(a);q(k,0);return}let s=this.get_line_text(a);if(s!=""){let d=n;if(n.nodeName=="P"?(d=n.childNodes[i],i=0):((u=n.parentElement)==null?void 0:u.nodeName)=="SPAN"&&(d=n.parentElement),d==null){console.warn("prev is undefined");return}for(d=d.previousSibling;d!=null;)i+=(p=d.textContent)==null?void 0:p.length,d=d.previousSibling}else i=0;const r=this.reload_line(a,s),o=q(r,i);this.save_lazy(),o!=null&&t.type=="input"&&z(o)&&w.create(o)}reload_line(t,e){e==null&&(e=this.get_line_text(t));const n=this.make_line(e,!1);return t.replaceWith(n),t.childNodes.forEach(i=>{if(z(i)){const a=F(i.id);a==null||a.remove()}}),n}set_editable(t){this.can_write&&(this.editable=t,this.element.contentEditable=t.toString(),this.element.classList.toggle("editable",t),this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(n=>{var i;z(n)&&((i=F(n.id))==null||i.set_expanded(t))})}))}save(){let t=this.get_content_text();N.setitem({Path:U(this.note.path),Content:t}),this.saves_pending=!1}save_linkstate(){const t=[];this.get_links().forEach(n=>t.push(n.is_open)),N.set_linkstate(this.note.path,t)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}get_content_text(){let t=[];return this.element.childNodes.forEach(n=>{n.nodeName=="P"&&t.push(this.get_line_text(n))}),t.join(`
`)}get_line_text(t){let e="";const n=w.open;return n&&w.clear(),t.childNodes.forEach(i=>{if(z(i)){const s=F(i.id);s==null?e+="":s!=null&&s.expanded?e+=i.textContent:e+=s==null?void 0:s.name}else(i.nodeName=="#text"||i.nodeName=="SPAN")&&(e+=i.textContent)}),n&&w.restore(),e}}function q(l,t){var i,a;let e=l.firstChild;for(;t>((i=e==null?void 0:e.textContent)==null?void 0:i.length);)t-=(a=e==null?void 0:e.textContent)==null?void 0:a.length,e=e==null?void 0:e.nextSibling;let n=null;return e!=null&&(e.nodeName=="SPAN"?(n=e,e=e.firstChild):n=e),oe(e,t),n}function oe(l,t){var e=document.createRange(),n=window.getSelection();try{e.setStart(l,t),e.collapse(!0)}catch{}n!=null&&(n.removeAllRanges(),n.addRange(e))}function se(l){l.startsWith("..")?l=l.slice(2):(l.startsWith("#")||l.startsWith("_")||l.startsWith("."))&&(l=l.slice(1));let t="",e=l.split(".").map(n=>n.split("@")[0]).map(n=>{const i=n.split(":");return i.length>1&&(t=i[1]),n.split(":")[0]}).join(".");if(t!=""){const n="<span class='author'> by "+t+"</span>";e+=n}return e}new TextEncoder;function $e(l){let t,e,n,i,a,s,r,o,c,f,C;return{c(){t=X("h2"),e=Q(),n=X("button"),i=he("❋"),a=Q(),s=X("button"),r=he(l[1]),o=Q(),c=X("div"),this.h()},l(h){t=G(h,"H2",{id:!0});var g=J(t);g.forEach(x),e=Z(h),n=G(h,"BUTTON",{id:!0});var m=J(n);i=ce(m,"❋"),m.forEach(x),a=Z(h),s=G(h,"BUTTON",{id:!0});var b=J(s);r=ce(b,l[1]),b.forEach(x),o=Z(h),c=G(h,"DIV",{id:!0});var _=J(c);_.forEach(x),this.h()},h(){B(t,"id","fullheader"),B(n,"id","light_btn"),B(s,"id","loggedin_btn"),B(c,"id","page")},m(h,g){T(h,t,g),t.innerHTML=l[0],T(h,e,g),T(h,n,g),pe(n,i),T(h,a,g),T(h,s,g),pe(s,r),T(h,o,g),T(h,c,g),f||(C=[ue(n,"click",l[3]),ue(s,"click",l[5])],f=!0)},p(h,[g]){g&1&&(t.innerHTML=h[0])},i:de,o:de,d(h){h&&x(t),h&&x(e),h&&x(n),h&&x(a),h&&x(s),h&&x(o),h&&x(c),f=!1,xe(C)}}}function Qe(l,t,e){let n,i;fe(l,me,u=>e(11,n=u)),fe(l,M,u=>e(12,i=u));let{data:a}=t;var s,r="<br>";s=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,r=s,we().then(g);let o;const c=`click mich und schreib was: xzxysl ... *&^*

du kannst einen neuen link erstellen mit # und dann text zb.: #link #rekursion #wasauchimmer

click einen link an um eine Seite zu öffnen. wenn die Seite schon existiert wird sie dir angezeigt.

fast vergessen! erstelle einen account: {}/login dann kannst du eine öffentliche Notiz erstellen die nur du verändern kannst oder du kannst eine Notiz an einen Kontakt schicken.

wenn du mehr wissen willst: #sciepedia:kormann
`;let f,C,h=i[0];async function g(){He(),window.fetch=a.fetch,n&&document.body.classList.add("light"),o=document.createElement("div"),o.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",o.id="pred",s=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,e(0,r=s);let u=window.location.search;C=[S.path],u&&u.length>1&&(u=u.slice(1),D(u)||(u="#"+u),D(u)&&(C.push(S.path),S.path=u)),f=document.querySelector("#page"),window.addEventListener("scroll",d=>{e(0,r=s);let k={element:{offsetTop:0},fullpath:"<span id=homebtn>sciepedia</span>"};V.forEach(v=>{window.scrollY+v.element.offsetHeight>v.element.offsetTop&&k.element.offsetTop<v.element.offsetTop&&(k=v)}),e(0,r=k.fullpath),e(0,r=se(r))}),N.setitem({Path:U("_turorial"),Content:c.replace("{}",window.location.origin)}),N.has(U("_home"))||N.setitem({Path:U("_home"),Content:`willkommen zu sciepedia
wenn du neu hier bist: #tutorial:system`}),console.log(`creating home for ${i}`);let p=new $(S.path,S.path);V.push({element:p.head.title_element,fullpath:S.path}),f.appendChild(p.element),document.body.addEventListener("click",d=>{d.target==document.body&&ie(null)}),window.addEventListener("onunload",d=>{localStorage.unloading=!0,p.body.free(),localStorage.unloaded=!0}),Je().then(()=>{p.body.spellcheck()})}function m(u){C.push("_account");let p=new $("_account","");f.removeChild(f.firstChild),f.appendChild(p.element)}function b(){Ne(me,n=!n,n)}const _=()=>{m()};return l.$$set=u=>{"data"in u&&e(4,a=u.data)},[r,h,m,b,a,_]}class nt extends ke{constructor(t){super(),ye(this,t,Qe,$e,Le,{data:4})}}export{nt as component,tt as universal};
