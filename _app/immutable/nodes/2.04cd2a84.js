var xe=Object.defineProperty;var Ne=(s,n,e)=>n in s?xe(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var _=(s,n,e)=>(Ne(s,typeof n!="symbol"?n+"":n,e),e);import{J as O,S as he,i as pe,s as ue,a as A,k as T,q as F,c as H,l as P,m as M,r as q,h as v,n as L,b as C,G as E,K as se,L as G,H as K,M as Te,t as me,u as fe,w as Pe,y as Se,N as De,z as Me,O as Ae,A as He,g as We,d as Ie,B as Oe,I as le}from"../chunks/index.393b6558.js";import{u as Re,s as x,i as U,a as ze,b as je,m as Ue,c as Fe,g as W,d as Z,P as ge,e as qe,o as Ve,f as V,l as ee,h as Je}from"../chunks/data_store.7071c88e.js";import{_ as Ke}from"../chunks/preload-helper.41c905a7.js";function Be({fetch:s,params:n}){return{fetch:s}}const Nt=Object.freeze(Object.defineProperty({__proto__:null,load:Be},Symbol.toStringTag,{value:"Module"}));let _e=new WeakMap,ae=0;function B(s){return _e.get(s)}class Y{constructor(n,e,t=!1){_(this,"name","");_(this,"parent");_(this,"element");_(this,"open");_(this,"child");_(this,"path");_(this,"linenumber",null);for(let i of n.split(".").slice(-1)[0].split(":").slice(1))/^[0-9]+$/.test(i)&&(this.linenumber=+i);this.name=n,this.parent=e,this.element=document.createElement("span"),this.element.textContent=n,this.element.classList.add("link"),this.element.spellcheck=!1,this.open=t,this.element.addEventListener("click",()=>{this.set_open(!this.open)}),ae++,this.element.id=`L${ae}`,_e.set(this.element,this),this.path=this.parent.path().create_child(this.name)}set_path(n){console.log("renaming link",n.tostring(),this.parent.path().tostring()),this.path=n,this.name=n.relative_path_string(this.parent.path()),console.log("new name:",this.name),this.element.textContent=this.name}set_collapsed(n){this.open||this.path.get_language()!="txt"||(n?this.element.textContent=this.path.collapsed_link_name(this.parent.path()):this.element.textContent=this.name)}remove(){var n;(n=this.child)==null||n.remove()}set_open(n){var e;if(n!=this.open){if(this.element.classList.toggle("open"),n){this.set_collapsed(!1);let t=this.element.parentElement;if(this.child=this.parent.create_child(this.path,this),this.linenumber!=null){console.log(this.linenumber);let i=this.child.content.element.childNodes.item(this.linenumber-1);i.style.background="var(--focus)"}((e=t.textContent)==null?void 0:e.trim())==this.name&&this.element.remove(),t.append(this.child.element)}else this.element.parentElement==null&&this.child.element.replaceWith(this.element),this.child.remove();this.open=n,this.parent.content&&this.parent.content.save_linkstate()}}}class we{constructor(n){_(this,"element");_(this,"editable");let e=n.split("#");console.log(n);let t=decodeURI(e[1]);n=e[0],this.editable=!1,this.element=document.createElement("img"),this.element.classList.add("image"),this.element.src=n,this.element.style.width=t,document.addEventListener("click",i=>{i.target!=this.element&&i.target!=this.element.parentElement&&this.set_sizable(!1)}),this.element.addEventListener("dblclick",()=>{this.set_sizable(!0)})}set_sizable(n){var e;if(n){let t=document.createElement("div");this.element.replaceWith(t),t.style.width=this.element.style.width,this.element.style.width="100%",t.appendChild(this.element),t.style.resize="both",t.style.overflow="auto",t.style.border="2px solid white"}else if(this.editable){let t=this.element.width;this.element.style.width=`min(${t}px, 100%)`,(e=this.element.parentElement)==null||e.replaceWith(this.element)}this.editable=n}}function Ye(s){console.log("create image",s);const n=new we("");return Re(crypto.randomUUID(),s).then(e=>n.element.src=e),n}class ye{constructor(n){_(this,"note");_(this,"element");_(this,"data");_(this,"saves_pending");this.note=n,this.element=document.createElement("div"),this.element.classList.add("content"),n.element.append(this.element),this.data=x.getitem(n.path(),e=>{this.set_data(e)}),this.set_data(this.data),oe++,this.element.id=`C${oe}`,be.set(this.element,this),this.saves_pending=!1}set_data(n){throw"not implemented"}on_input(n){}get_text(){let n=[];for(let e of this.element.children)e.nodeName=="P"&&n.push(this.get_line_text(e));return n.join(`
`)}save(){this.data.Content=this.get_text(),this.saves_pending=!1,x.setitem(this.data)}save_linkstate(){let n=[];this.get_links().forEach(e=>n.push(e.open)),x.set_linkstate(this.note.path(),n),console.log(n)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}get_links(){let n=[];return this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(t=>{if(console.log(t),$(t)){let i=B(t);i&&n.push(i)}else if($e(t)){console.log("note",t);let i=ve(t.querySelector(".content"));i!=null&&i.note.creator&&!i.note.creator.element.parentElement&&n.push(i.note.creator)}})}),console.log(n),n}get_line_text(n){let e="";return n.childNodes.forEach(t=>{if($(t)){let i=t;B(i)==null?e+="":e+=i.textContent}else if(t.classList&&t.classList.contains("image")){let i=t;console.log(i==null?void 0:i.style.width),e+=`##image:${i==null?void 0:i.src}#${encodeURI(i==null?void 0:i.style.width)}`,console.log(e)}else t.classList&&t.classList.contains("youtubeplayer")?e+=t.src:(t.nodeName=="#text"||t.nodeName=="SPAN")&&(e+=t.textContent)}),e}make_word(n){return new Text(n)}make_line(n,e=!0){if(n==""){let l=document.createElement("p");return l.innerHTML="<br>",l}n=n.replaceAll(" "," "),n=n.replace(/(\S)\u00A0(\S)/g,"$1 $2");let t=n.split(/([\s+[\]{}(),])/),i=document.createElement("p"),a=[];for(let l in t){let o=t[l];if(U(o)&&(!o.startsWith(".")||/\s+| | /.test(t[+l-1])||t[+l-1]==null))try{const r=new Y(o,this.note);a.push(r.element)}catch(r){console.log("failed link",o,r),a.push(this.make_word(o))}else if(ze(o))je(o)?a.push(Ue(o)):a.push(Fe(o));else if(o.startsWith("##image:")){const r=new we(n.slice(8));a.push(r.element);break}else a.push(this.make_word(o))}return a.forEach(l=>{i.appendChild(l)}),i}}let be=new WeakMap,oe=0;function $(s){return s instanceof HTMLElement&&s.classList.contains("link")}function $e(s){return s instanceof HTMLElement&&s.classList.contains("note")}function ve(s){return be.get(s)}function z(s,n){var i,a;let e=s.firstChild;for(;n>((i=e==null?void 0:e.textContent)==null?void 0:i.length);)n-=(a=e==null?void 0:e.textContent)==null?void 0:a.length,e=e==null?void 0:e.nextSibling;let t=null;return e!=null&&(e.nodeName=="SPAN"?(t=e,e=e.firstChild):t=e),Ge(e,n),t}function Ge(s,n){var e=document.createRange(),t=window.getSelection();try{e.setStart(s,n),e.collapse(!0)}catch{}t!=null&&(t.removeAllRanges(),t.addRange(e))}var Xe=s=>new Promise((n,e)=>{console.log("rename_note",s);const t=document.createElement("div");t.classList.add("bg"),t.addEventListener("click",p=>{p.target==t&&(t.remove(),e())}),document.querySelector("#page").appendChild(t);const i=document.createElement("div");i.classList.add("container"),t.appendChild(i);const a=document.createElement("h2");a.innerHTML="rename note";const l=document.createElement("input");l.value=s.tostring();const o=document.createElement("p"),r=()=>{const p=W(l.value);p!=s?(n(p),t.remove()):o.innerHTML="invalid name"};l.addEventListener("keyup",p=>{p.key=="Enter"&&r()});const d=document.createElement("button");d.innerHTML="rename",d.onclick=()=>r(),i.appendChild(a),i.appendChild(l),i.appendChild(o),i.appendChild(document.createElement("br")),i.appendChild(d)});function Qe(s,n){s.preventDefault();let e=document.createElement("div");e.style.position="fixed",e.style.top=s.pageY-window.scrollY+"px",e.style.left=s.pageX+"px",e.style.backgroundColor="var(--focus)",e.style.border="2px solid grey",e.style.padding=".5em",e.style.cursor="pointer";{const i=[{tag:"share link",fn:async a=>{await navigator.clipboard.writeText(location.origin+"?"+n.path().tostring().replace("#","")),a.textContent="copied."}},{tag:`expand note ${n.path().tostring()}`,fn:async a=>{window.location.search=n.path().tostring().replace("#","")}},{tag:"rename note",fn:async a=>{Xe(n.content.data.Path).catch(()=>{}).then(l=>{l&&n.rename(l)})}}];for(let{tag:a,fn:l}of i){let o=document.createElement("p");o.textContent=a,o.addEventListener("click",r=>l(o)),o.style.padding=".2em",e.append(o)}}let t=document.querySelector("#page");t==null||t.appendChild(e),window.addEventListener("click",()=>e.remove()),e.addEventListener("mouseleave",()=>e.remove())}class Ze extends ye{constructor(e){var p;super(e);_(this,"table");_(this,"rows");_(this,"columns");this.element.innerHTML="",this.element.contentEditable="false",this.element.style.padding="0";let t=document.createElement("div"),i=document.createElement("div");(p=this.note.head)==null||p.element.remove(),t.classList.add("tablecontainer"),i.classList.add("supercontainer"),this.table=document.createElement("table"),this.table.classList.add("tablecontent");let a=this.data.Content.split(`
`).map(c=>this.make_line(c,!0));console.log("creating table",this.data.Content),this.table.append(...a),this.rows=this.table.childNodes.length,this.columns=this.table.childNodes[0].childNodes.length,this.element.innerHTML="",this.element.replaceWith(i),this.element=i;const l=document.createElement("tr");for(var o=0;o<this.columns;o++)o==0?l.append(document.createElement("span")):l.append(this.removecolumn(this.table,o));this.table.prepend(l),i.append(t),t.append(this.table);const r=document.createElement("button");r.addEventListener("click",c=>{this.table.childNodes.forEach((f,w)=>{let h;w==0?h=this.removecolumn(this.table,this.columns):(h=document.createElement("td"),h.append(super.make_line("")),console.log(h)),f.appendChild(h)}),this.columns++}),r.classList.add("newcolumn"),r.innerHTML="+",t.appendChild(r);const d=document.createElement("button");d.addEventListener("click",c=>{this.table.insertRow(-1).replaceWith(this.make_line(",".repeat(this.columns-2)))}),d.innerHTML="+",d.classList.add("newrow"),i.append(d),this.element.addEventListener("click",c=>{var w;let f=c.target;if(f.nodeName!="BUTTON"&&(f.nodeName=="TD"||((w=f.parentNode)==null?void 0:w.nodeName)=="TD")){let h=c.target.nodeName=="TD"?c.target:c.target.parentNode;h.contentEditable="true";let m=h.querySelector("p");if([m,m.parentElement].includes(document.activeElement))return;m.focus(),z(m,this.get_line_text(m).length)}}),this.element.addEventListener("input",c=>{var f;(c.target.nodeName=="TD"||((f=c.target.parentNode)==null?void 0:f.nodeName)=="TD")&&this.on_input(c)})}set_data(e){}removecolumn(e,t){let i=document.createElement("td"),a=document.createElement("span");return a.innerHTML="-",a.addEventListener("click",l=>{console.log("remove col",t),e.childNodes.forEach((o,r)=>o.childNodes[t].remove())}),this.save_lazy(),a.style.width="100%",i.style.padding="0",i.append(a),i.classList.add("removecolumn"),i.style.border="unset",i}make_line(e,t){const i=document.createElement("tr");i.append(this.removerow(i));for(let a of e.split(",")){let l=document.createElement("td");l.append(super.make_line(a)),i.append(l)}return i}removerow(e){let t=document.createElement("button");return t.innerHTML="-",t.addEventListener("click",()=>e.remove()),t.classList.add("removerow"),t}get_text(){const e=this.element.querySelector("table");let t="";for(let i=1;i<e.childNodes.length;i++){const a=e==null?void 0:e.childNodes[i];for(let l=1;l<a.childNodes.length;l++){const o=a.childNodes[l];console.log(o);let r=this.get_line_text(o.querySelector("p"));t+=r+","}t=t.slice(0,-1)+`
`}return t=t.slice(0,-1),console.log(t),t}async on_input(e){this.save_lazy()}}class te extends ye{constructor(e){super(e);_(this,"on_paste",e=>{for(var t=e.target;t.nodeName!="DIV";)if(t=t.parentElement,t==null)return;if(t!=this.element)return;const i=e.clipboardData;for(var a=0;a<i.items.length;a++)if(i.items[a].type.indexOf("image")!==-1){var l=i.items[a].getAsFile();if(l){const r=Ye(l);this.insert_text(r.element)}}let o=e.clipboardData.getData("text");if(o=qe(o),o.startsWith(window.location.origin)&&o.includes("?")){console.log("pasting link"),e.preventDefault();let r=o.split("?")[1];U(r)||(r="#"+r);const d=new Y(r,this.note,!1);this.insert_text(d.element)}else console.log("pasting normal text",o),e.preventDefault(),this.insert_text(document.createTextNode(o)),o.includes(`
`)&&this.get_text();this.save_lazy()});this.element.addEventListener("keydown",a=>{a.key=="Tab"&&a.target==this.element&&(a.preventDefault(),this.insert_text(document.createTextNode("  ")))});function t(a){for(;!(a.classList&&a.classList.contains("content"));)a=a.parentNode;return a}this.element.addEventListener("input",a=>{var r;let l=t((r=window.getSelection())==null?void 0:r.focusNode),o=ve(l);o==null||o.on_input(a)}),this.element.addEventListener("paste",this.on_paste),this.element.contentEditable=String(this.data.Path.author==O(Z)),this.element.contentEditable=="false"&&this.element.addEventListener("click",()=>{let a=new ge(this.data.Path.pub,O(Z),this.data.Path.location),l=window.prompt(`to edit ${this.data.Path.author}'s note you need to make a copy`,a.tostring());l!=null&&(console.log(l),this.note.rename(W(l)))});let i=x.get_linkstate(e.path());this.get_links().forEach((a,l)=>{i[l]&&!this.note.call_hist.includes(a.path)&&a.set_open(!0)})}set_data(e){this.element.innerHTML="",this.data=e,this.setText(this.data.Content)}setText(e){let t=e.split(`
`);for(let i of t)this.element.append(this.make_line(i))}on_input(e){var d,p,c,f,w,h,m,y,g,b;if(e.type=="input"&&["¨"].includes(e.data))return;const t=window.getSelection(),i=t==null?void 0:t.focusNode;var a=t==null?void 0:t.focusOffset,l;if(i.nodeName=="P")l=i;else if(i.nodeName=="DIV")l=i.firstChild;else if(((d=i.parentElement)==null?void 0:d.nodeName)=="P")l=i.parentElement;else if(((c=(p=i.parentElement)==null?void 0:p.parentElement)==null?void 0:c.nodeName)=="P")l=(f=i.parentElement)==null?void 0:f.parentElement;else{this.element.childNodes.forEach(u=>{if(u.nodeName!="P"){const k=document.createElement("p");u.nodeName=="DIV"?(u.replaceWith(k),k.appendChild(u.firstChild)):(u.replaceWith(k),k.appendChild(u)),z(k,0)}});return}if(e.inputType=="insertParagraph"){const u=l.previousElementSibling;((w=u.lastChild)==null?void 0:w.textContent)==""&&((h=u.lastChild)==null||h.remove()),this.reload_line(u),(y=l.firstChild)==null||y.replaceWith((m=l.firstChild)==null?void 0:m.textContent);const k=this.reload_line(l);z(k,0);const N=u.textContent;if(N){const X=(N==null?void 0:N.length)-N.trimStart().length+(["{","[","("].includes(N.slice(-1))?2:0);X&&(this.insert_text(document.createTextNode(" ".repeat(X))),z(k,X))}return}let o=this.get_line_text(l);if(o!=""){let u=i;if(i.nodeName=="P"?(u=i.childNodes[a],a=0):((g=i.parentElement)==null?void 0:g.nodeName)=="SPAN"&&(u=i.parentElement),u==null){console.warn("prev is undefined");return}for(u=u.previousSibling;u!=null;)a+=(b=u.textContent)==null?void 0:b.length,u=u.previousSibling}else a=0;const r=this.reload_line(l,o);z(r,a),this.save_lazy()}reload_line(e,t){t==null&&(t=this.get_line_text(e));const i=this.make_line(t);return e.replaceWith(i),e.childNodes.forEach(a=>{if($(a)){const l=B(a);l==null||l.remove()}}),i}insert_text(e){const t=window.getSelection();t.deleteFromDocument(),t.getRangeAt(0).insertNode(e),e.parentElement instanceof HTMLBRElement&&(e.parentElement.replaceWith(e),console.log("replaced br")),t.collapseToEnd();const i=document.createRange();i.selectNodeContents(e),i.collapse(!1);const a=window.getSelection();a.removeAllRanges(),a.addRange(i)}}let S=null;window.addEventListener("keydown",s=>{s.ctrlKey&&s.key=="Enter"&&S!=null&&S.runnable&&(S.runbutton.textContent="O",console.log("start running"),S.execute(),S.runbutton.textContent="▶")});class ke extends te{constructor(e){super(e);_(this,"outfield");_(this,"runnable",!1);_(this,"runbutton",null);this.element.classList.add("js"),this.element.spellcheck=!1,this.data.Path.location[this.data.Path.location.length-1]==this.data.Path.get_language()&&(this.runnable=!0,this.runbutton=document.createElement("div"),this.runbutton.classList.add("runbutton"),this.runbutton.textContent="▶",this.runbutton.contentEditable="false",this.runbutton.addEventListener("click",async t=>{S=this,this.runbutton.textContent="O",await this.execute(),this.runbutton.textContent="▶"}),S==null&&(S=this),this.element.parentElement.append(this.runbutton)),this.outfield=document.createElement("div"),this.outfield.classList.add("content"),this.outfield.contentEditable="false",this.element.parentElement.append(this.outfield)}make_word(e){let t=new Text(e);return tt.forEach(i=>{i.pattern(e)&&(t=document.createElement("span"),t.textContent=e,t.style.color=i.color)}),t}on_input(e){this.runnable&&(S=this),super.on_input(e)}async get_flat_text(e,t){e=e.replaceAll(/print\s*\(/g,"print(");const i=e.split(`
`);let a=[];return[(await Promise.all(i.map(async(o,r)=>{if(/print\s*\(/.test(o)&&(o=o.replaceAll(/print\s*\(/g,`print('${t.data.Path.tostring()}:${r+1}',`)),o.trimStart().startsWith("//"))return;let d=o.split(/([\s+[\]{}(),])/);return(await Promise.all(d.map(async(p,c)=>{if(U(p)&&(!p.startsWith(".")||/\s+| | /.test(d[c-1])||d[c-1]==null)){const f=new Y(p,t.note,!0),w=f.path.tostring().replaceAll(".","$").replaceAll(":","$$$$").replace("#","");return a.push([w,f]),w}return p}))).join("")}))).filter(o=>!(o!=null&&o.startsWith("//"))).join(`
`),a]}async get_content_text(e,t,i){const a=(await x.getitemblocking(t)).Content;let[l,o]=await this.get_flat_text(a,e);for(let[r,d]of o)if(!i.vars.has(r)){i.vars.add(r);const p=new I(d.path,d),c=await this.get_content_text(p.content,d.path,i);i.values.push([r,c])}return l}async execute(){this.save(),this.outfield.innerHTML="",window.print=(...i)=>{this.print(...i)},window.putout=i=>this.outfield.append(i);let e={vars:new Set,values:new Array},t=await this.get_content_text(this,this.data.Path,e);for(let[i,a]of e.values)t=`${i} = ${a};
`+t;console.log(t);try{let a=await Function(`return async()=>{${t}}`)()();console.log(a),this.print(a)}catch(i){console.error(i)}}print(...e){let t=e[0];e=e.slice(1);let i=document.createElement("p");if(t!=null){let a=new Y(t,this.note);a.element.style.float="right",i.append(a.element)}for(let a of e)i.append(Ee(a)),i.append(document.createTextNode(" "));this.outfield.append(i)}}let et=["abstract","arguments","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function Ee(s){console.log("parse",s);let n=i=>["string","number","boolean","symbol","undefined","function"].includes(typeof i)||i==null,e=document.createElement("span"),t=s.constructor.name;if(n(s)){["number","boolean"].includes(typeof s)&&(e.style.color="orange");let i=String(s);e.textContent=i}else{let i=function(){a=!0,l=document.createElement("p"),l.style.paddingLeft="2em",e.append(l);for(let d of Object.keys(s))l.append(d,": "),l.append(Ee(s[d])),l.append(document.createElement("br"))};t+=` [${Object.keys(s).length}]`,e.style.color="var(--blue)",e.style.cursor="pointer";let a=!1,l;e.addEventListener("click",d=>{if(d.target==e){if(a){l==null||l.remove(),a=!1;return}i()}});let o=[];for(let d of Object.keys(s)){if(o.length>3){o.push("...");break}let p="";s instanceof Array||(p+=d+": "),p+=s[d],o.push(p)}let r=document.createElement("span");r.textContent=o.join(", "),r.style.color="var(--color)",e.textContent=t+" ",e.append(r)}return e}const tt=[{pattern:s=>/[\[\]{}()]/.test(s),color:"yellow"},{pattern:s=>et.includes(s),color:"lightblue"},{pattern:s=>!isNaN(parseFloat(s)),color:"orange"},{pattern:s=>/^"(.*)"/.test(s),color:"orange"}];let D,R=null,ne=(...s)=>{R==null||R.print(...s)};async function nt(){console.log("python setup..."),ne("python setup ..."),await Ke(()=>import("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"),[],import.meta.url),D=await loadPyodide(),R.outfield.innerHTML="",window.pyo=D}let it=["False","await","else","import","pass","None","break","except","in","raise","True","class","finally","is","return","and","continue","for","lambda","try","as","def","from","nonlocal","while","assert","del","global","not","with","async","elif","if","or","yield"];const st=[{pattern:s=>/[\[\]{}()]/.test(s),color:"yellow"},{pattern:s=>it.includes(s),color:"lightblue"},{pattern:s=>!isNaN(parseFloat(s)),color:"orange"},{pattern:s=>/^"(.*)"/.test(s),color:"orange"}];function lt(s){let n=new Text(s);return st.forEach(e=>{e.pattern(s)&&(n=document.createElement("span"),n.textContent=s,n.style.color=e.color)}),n}class at extends ke{async execute(){this.outfield.innerHTML="";let n=this.get_text();R=this,n=n.replaceAll(" "," ");try{let e=await this.run_python_code(n);e!=null&&ne(e)}catch(e){console.log(e),this.handle_error(e)}}async run_python_code(n){console.log("run python"),D==null&&await nt(),await D.loadPackage("micropip");let e=!1;return n=n.split(`
`).map((a,l)=>{if(/^\%pip\s*install/.test(a)){let o=a.split(/^\%pip\s*install/)[1].trim();return e=!0,o=="tinygrad"?`await micropip.install("tinygrad")
await micropip.install("sqlite3")`:`await micropip.install("${o}")`}return a}).join(`
`),e&&(n=`import micropip
`+n),console.log(n),(D==null?void 0:D.globals).set("print",(...a)=>this.print(...a.map(l=>l.toJs?l.toJs():l))),D.runPythonAsync(n)}handle_error(n){let e=n.stack.split(`
`);console.log(e),e.filter(t=>t.startsWith('  File "<exec>", line')||!t.startsWith(" ")&&!t.startsWith("PythonError:")).map(t=>ne(t))}on_input(n){this.data.Path.location.indexOf("py")==this.data.Path.location.length-1&&(R=this),super.on_input(n)}make_word(n){return lt(n)}print(...n){console.log("printing from",this);let e=document.createElement("p");e.style.whiteSpace="pre";for(let t of n)e.append(j(t)," ");this.outfield.append(e)}}function j(s){let n=t=>["string","number","boolean","symbol","undefined","function"].includes(typeof t)||t==null,e=document.createElement("span");if(n(s))if(["number","boolean"].includes(typeof s)&&(e.style.color="orange"),typeof s=="string"){for(let t of s.split(`
`))e.append(new Text(t)),e.append(document.createElement("br"));e.style.whiteSpace="pre"}else{let t=String(s);e.textContent=t}else{let t=function(){console.log("open",s,i),a=!0,l=document.createElement("p"),l.style.paddingLeft="2em";let r=20;if(i=="list")for(let d of s){if(r--<0)break;l.append(j(d)),l.append(document.createElement("br"))}else if(i=="dict"){console.log("print map");for(let d of s){if(r--<0)break;l.append(d,": "),l.append(j(s.get(d)))}}else try{for(let d of s.__dict__){if(r--<0)break;l.append(d,": "),l.append(j(s[d])),l.append(document.createElement("br"))}}catch{try{for(let d of s){if(r--<0)break;l.append(j(d)),l.append(document.createElement("br"))}}catch{}}l.innerHTML&&e.append(l)},i=s.type??s.constructor.name;e.style.color="var(--blue)",e.style.cursor="pointer";let a=!1,l;e.addEventListener("click",r=>{if(r.target==e){if(a){l==null||l.remove(),a=!1,e.style.color="var(--blue)";return}t(),e.style.color="var(--active)"}});let o=String(s);e.append(o)}return e}class I{constructor(n,e){_(this,"creator");_(this,"element");_(this,"head");_(this,"content");_(this,"language");_(this,"call_hist",[]);_(this,"init_path");this.init_path=n,console.log("creating note",n),this.creator=e,this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new ot(this,n),this.element.append(this.head.element),this.language=n.get_language(),this.element.addEventListener("keydown",t=>{var i,a;if(t.shiftKey&&t.key=="Enter"){let l=(a=(i=window.getSelection())==null?void 0:i.anchorNode)==null?void 0:a.parentElement;if($(l)){let o=B(l);o==null||o.set_open(!0),console.log("open",o),t.preventDefault()}}}),this.language=="txt"?this.content=new te(this):this.language=="js"?this.content=new ke(this):this.language=="py"?this.content=new at(this):this.language=="csv"?(console.log("creating csv"),this.content=new Ze(this)):this.content=new te(this),e&&(this.call_hist=e.parent.call_hist.concat(e.parent.path()))}path(){try{return this.content.data.Path}catch{return this.init_path}}remove(){var n,e;this.content.save(),this.content.save_linkstate(),this.creator&&!((n=this.creator)!=null&&n.element.parentElement)&&this.element.replaceWith((e=this.creator)==null?void 0:e.element),this.element.remove()}create_child(n,e){return new I(n,e)}rename(n){let e=x.getitem(n,i=>{this.content.data.id=i.id,this.content.save()});this.content.data.Path=n,this.content.data.id=e.id,this.content.get_links().forEach(i=>{i.set_path(i.path)}),this.content.save();let t=new I(this.path(),this.creator);this.element.replaceWith(t.element),this.creator?(this.creator.set_path(n),this.creator.child=t,this.creator.parent.content.save()):window.location.search=n.tostring().replace("#","")}}class ot{constructor(n,e){_(this,"note");_(this,"element");this.note=n,this.element=document.createElement("div"),this.element.classList.add("head"),this.element.contentEditable="false";let t=document.createElement("h2"),i;this.note.creator?i=e.title_string(this.note.creator.parent.path()):i=e.title_string(),t.textContent=i,this.element.append(t),this.note.element.append(this.element),this.element.addEventListener("click",a=>{var l;console.log(n),n.creator||console.log("no creator here"),(l=this.note.creator)==null||l.set_open(!1)}),this.element.addEventListener("contextmenu",a=>{Qe(a,this.note)})}}var J=new Map,Q=[],ie=!1;function rt(){for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);try{const e=JSON.parse(n);e.location&&ct(e)}catch{}}}function ct(s){const n=(s.pub?"":"_")+s.location.join(".")+":"+s.author,e=J.size;J.set(n,s),e!=J.size&&(ie=!0)}function dt(){return ie&&(Q=Array.from(J),Q.sort((s,n)=>s[0].localeCompare(n[0])),ie=!1),Q}function ht(){const s=prompt("enter openai key");s&&Ve.set(s)}const pt={tags:["openai","ai","gpt"],rep:"⚙️ add openai key",executor:ht};function Le(s,n){return typeof s=="string"?s.startsWith(n):typeof s=="function"?s(n):s.reduce((e,t)=>e||Le(t,n),!1)}let ut=[{tags:["lightmode","darkmode"],rep:"⚙️ switch lightmode",executor:()=>{ee.set(!O(ee))}},{tags:["account","login","signup","sign in","log out","sign out","user account"],rep:"⚙️ account settings",executor:()=>{window.location.pathname="login"}},pt],Ce;function mt(){let s=dt().map(n=>{const e=decodeURI(n[0]).replaceAll("_"," ").trimStart(),t=(n[1].pub?"📃 ":"🔒 ")+e.replace(":"," by ");return{tags:e,rep:t,executor:()=>{const a=new ge(n[1].pub,n[1].author,n[1].location).tostring();window.location.search=a.replace("#",""),V.update(l=>(l[t]=Date.now(),l)),console.log(O(V))}}}).sort((n,e)=>(O(V)[e.rep]??0)-(O(V)[n.rep]??0));Ce=ut.concat(...s)}function ft(s,n=10){return Ce.filter(t=>Le(t.tags,s)).slice(0,n)}function re(s,n,e){const t=s.slice();return t[11]=n[e],t[13]=e,t}function gt(s){let n,e,t,i;return{c(){n=T("button"),e=F("⚙︎"),this.h()},l(a){n=P(a,"BUTTON",{id:!0});var l=M(n);e=q(l,"⚙︎"),l.forEach(v),this.h()},h(){L(n,"id","search_btn")},m(a,l){C(a,n,l),E(n,e),t||(i=G(n,"click",s[7]),t=!0)},p:K,d(a){a&&v(n),t=!1,i()}}}function _t(s){let n,e,t,i;return{c(){n=T("span"),e=F(">> Cmd + P"),this.h()},l(a){n=P(a,"SPAN",{id:!0});var l=M(n);e=q(l,">> Cmd + P"),l.forEach(v),this.h()},h(){L(n,"id","search_btn")},m(a,l){C(a,n,l),E(n,e),t||(i=G(n,"click",s[6]),t=!0)},p:K,d(a){a&&v(n),t=!1,i()}}}function ce(s){let n,e=(typeof s[11].rep=="string"?s[11].rep:s[11].rep(s[2]))+"",t,i,a,l,o,r;function d(){return s[10](s[11])}return{c(){n=T("p"),t=F(e),a=A(),l=T("br"),this.h()},l(p){n=P(p,"P",{class:!0});var c=M(n);t=q(c,e),c.forEach(v),a=H(p),l=P(p,"BR",{}),this.h()},h(){L(n,"class",i=s[13]==s[4]?"highlighted":"")},m(p,c){C(p,n,c),E(n,t),C(p,a,c),C(p,l,c),o||(r=G(n,"click",d),o=!0)},p(p,c){s=p,c&12&&e!==(e=(typeof s[11].rep=="string"?s[11].rep:s[11].rep(s[2]))+"")&&fe(t,e),c&16&&i!==(i=s[13]==s[4]?"highlighted":"")&&L(n,"class",i)},d(p){p&&v(n),p&&v(a),p&&v(l),o=!1,r()}}}function wt(s){let n,e,t,i,a,l,o,r,d,p,c;function f(g,b){return g[5]?_t:gt}let w=f(s),h=w(s),m=s[3],y=[];for(let g=0;g<m.length;g+=1)y[g]=ce(re(s,m,g));return{c(){h.c(),n=A(),e=T("div"),t=T("p"),i=F(de),a=A(),l=T("input"),o=A(),r=T("div");for(let g=0;g<y.length;g+=1)y[g].c();this.h()},l(g){h.l(g),n=H(g),e=P(g,"DIV",{class:!0});var b=M(e);t=P(b,"P",{id:!0});var u=M(t);i=q(u,de),u.forEach(v),a=H(b),l=P(b,"INPUT",{placeholder:!0,type:!0}),o=H(b),r=P(b,"DIV",{class:!0});var k=M(r);for(let N=0;N<y.length;N+=1)y[N].l(k);k.forEach(v),b.forEach(v),this.h()},h(){L(t,"id","searchsuggestion"),L(l,"placeholder","search..."),L(l,"type","text"),L(r,"class","results"),L(e,"class","searchbar"),e.hidden=d=!s[0]},m(g,b){h.m(g,b),C(g,n,b),C(g,e,b),E(e,t),E(t,i),E(e,a),E(e,l),s[8](l),se(l,s[2]),E(e,o),E(e,r);for(let u=0;u<y.length;u+=1)y[u].m(r,null);p||(c=G(l,"input",s[9]),p=!0)},p(g,[b]){if(w===(w=f(g))&&h?h.p(g,b):(h.d(1),h=w(g),h&&(h.c(),h.m(n.parentNode,n))),b&4&&l.value!==g[2]&&se(l,g[2]),b&28){m=g[3];let u;for(u=0;u<m.length;u+=1){const k=re(g,m,u);y[u]?y[u].p(k,b):(y[u]=ce(k),y[u].c(),y[u].m(r,null))}for(;u<y.length;u+=1)y[u].d(1);y.length=m.length}b&1&&d!==(d=!g[0])&&(e.hidden=d)},i:K,o:K,d(g){h.d(g),g&&v(n),g&&v(e),s[8](null),Te(y,g),p=!1,c()}}}let de="";function yt(s,n,e){let t=!1,i="",a=[],l=0;window.addEventListener("keydown",h=>{h.key=="p"?h.metaKey&&(h.preventDefault(),e(0,t=!0)):h.key=="Escape"&&e(0,t=!1)}),window.addEventListener("keyup",h=>{if(t&&!(h.key=="Meta"||h.key=="Escape"))if(h.key=="ArrowUp")e(4,l=Math.max(l-1,0));else if(h.key=="ArrowDown")e(4,l=Math.min(l+1,a.length-1));else if(h.key=="Tab"){h.preventDefault();let m=a[l].tags;typeof m=="string"&&(m=m.split(":")[0],m=m.split(".").slice(0,i.split(".").length).join("."),e(2,i=m),o.focus())}else if(h.key=="Enter")a[l].executor(i);else{if(i==""){e(3,a=[]);return}e(4,l=0),e(3,a=ft(i)),a.length==0&&e(3,a=[{tags:m=>!0,rep:m=>`⚙️ create Page: ${m}`,executor:m=>{const y=new I(W("#"+m));x.setitem(y.content.data),window.location.search=m}},{tags:m=>!0,rep:m=>`⚙️ create secret Page: ${m}`,executor:m=>{const y=new I(W("_"+m));x.setitem(y.content.data),window.location.search="_"+m}}]),a[0]}}),window.addEventListener("click",h=>{h.target.id!="search_btn"&&(e(0,t=!1),e(5,r=!1))});let o,r=!1;const d=()=>{e(5,r=!1),e(0,t=!0)},p=h=>{e(5,r=!0)};function c(h){Pe[h?"unshift":"push"](()=>{o=h,e(1,o)})}function f(){i=this.value,e(2,i)}const w=h=>{h.executor(i)};return s.$$.update=()=>{s.$$.dirty&3&&t&&(mt(),me().then(()=>{o.focus()}))},[t,o,i,a,l,r,d,p,c,f,w]}class bt extends he{constructor(n){super(),pe(this,n,yt,wt,ue,{})}}function vt(s){let n,e,t,i,a,l=s[1]?"":"offline",o,r,d,p;return n=new bt({}),{c(){Se(n.$$.fragment),e=A(),t=T("h2"),i=new De(!1),a=A(),o=F(l),r=A(),d=T("div"),this.h()},l(c){Me(n.$$.fragment,c),e=H(c),t=P(c,"H2",{id:!0});var f=M(t);i=Ae(f,!1),a=H(f),o=q(f,l),f.forEach(v),r=H(c),d=P(c,"DIV",{id:!0});var w=M(d);w.forEach(v),this.h()},h(){i.a=a,L(t,"id","fullheader"),L(d,"id","page")},m(c,f){He(n,c,f),C(c,e,f),C(c,t,f),i.m(s[0],t),E(t,a),E(t,o),C(c,r,f),C(c,d,f),p=!0},p(c,[f]){(!p||f&1)&&i.p(c[0]),(!p||f&2)&&l!==(l=c[1]?"":"offline")&&fe(o,l)},i(c){p||(We(n.$$.fragment,c),p=!0)},o(c){Ie(n.$$.fragment,c),p=!1},d(c){Oe(n,c),c&&v(e),c&&v(t),c&&v(r),c&&v(d)}}}function kt(s,n,e){let t,i;le(s,Z,w=>e(7,t=w)),le(s,Je,w=>e(1,i=w));let{data:a}=n;document.title=window.location.hostname.split(".")[0]+(window.location.search?" | "+window.location.search.slice(1).split(":")[0]:"");var l,o="<br>";l=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,o=l,me().then(f);let r;const d=`Click me and write something: xzxysl ... &^

You can create a new link with # followed by text, for example: #link #recursion #whatever

Click on a link to open a page. If the page already exists, it will be displayed to you.

Almost forgot! Create an account: {}/login, and then you can create public pages.

If you want to learn more, check out: #sciepedia:kormann
`;let p,c=W("_home:"+t);async function f(){if(rt(),window.fetch=a.fetch,ee.subscribe(y=>{y?document.body.classList.add("light"):document.body.classList.remove("light")}),r=document.createElement("div"),r.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",r.id="pred",l=`<a href=/ onclick="setTimeout(()=>{window.location.href='${window.origin}'})" id=homebtn>sciepedia</a>`,e(0,o=l),!x.has(c)){const y={Path:c,Content:`welcome to #sciepedia:kormann
if you're new try out the tutorial: _tutorial`,id:crypto.randomUUID()};localStorage[JSON.stringify(y.Path)]=JSON.stringify(y)}const w=W("_tutorial:"+t);x.has(w)||x.setitem({Path:w,Content:d.replace("{}",window.location.origin),id:crypto.randomUUID()});let h=window.location.search;h&&h.length>1&&(h=decodeURI(h.slice(1)),U(h)||(h="#"+h),console.log("searching:",h),U(h)&&(c=W(h))),p=document.querySelector("#page");let m=new I(c);p.appendChild(m.element),window.addEventListener("onunload",y=>{localStorage.unloading=!0,m.remove(),localStorage.unloaded=!0})}return s.$$set=w=>{"data"in w&&e(2,a=w.data)},[o,i,a]}class Tt extends he{constructor(n){super(),pe(this,n,kt,vt,ue,{data:2})}}export{Tt as component,Nt as universal};
