var be=Object.defineProperty;var Ee=(i,t,e)=>t in i?be(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var w=(i,t,e)=>(Ee(i,typeof t!="symbol"?t+"":t,e),e);import{J as A,S as ce,i as he,s as de,a as M,k as P,q as R,c as D,l as N,m as S,r as j,h as v,n as C,b as L,G as E,K as te,L as J,H as K,M as Ce,t as pe,u as ue,w as Le,y as xe,N as Pe,z as Ne,O as Se,A as Te,g as Ae,d as Me,B as De,I as ne}from"../chunks/index.393b6558.js";import{s as x,u as U,P as fe,i as q,g as W,o as We,a as O,l as Q,b as He}from"../chunks/data_store.d41e63ee.js";import{_ as Ie}from"../chunks/preload-helper.41c905a7.js";function Re({fetch:i,params:t}){return{fetch:i}}const ft=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"}));let me=new WeakMap,ie=0;function Y(i){return me.get(i)}class Z{constructor(t,e,n=!1){w(this,"name","");w(this,"parent");w(this,"element");w(this,"open");w(this,"child");w(this,"path");w(this,"linenumber",null);console.log(t);const s=t.split(".");for(let l of s[s.length-1])/^[0-9]+$/.test(l)&&(this.linenumber=+l);this.name=t,this.parent=e,this.element=document.createElement("span"),this.element.textContent=t,this.element.classList.add("link"),this.element.spellcheck=!1,this.open=n,this.element.addEventListener("click",()=>{this.set_open(!this.open),this.parent.content.save_linkstate()}),ie++,this.element.id=`L${ie}`,me.set(this.element,this),this.path=this.parent.path().create_child(this.name)}set_path(t){console.log(t),this.path=t,this.name=t.relative_path_string(this.parent.path()),this.element.textContent=this.name}remove(){var t;(t=this.child)==null||t.remove()}set_open(t){if(t!=this.open){if(this.element.classList.toggle("open"),t){let e=this.element.parentElement;if(this.child=this.parent.create_child(this.path,this),e.append(this.child.element),this.linenumber!=null){let n=this.child.content.element.childNodes.item(this.linenumber-1);n.style.background="var(--focus)"}}else this.child.remove();this.open=t}}}let ge=new WeakMap,se=0;class ${constructor(t,e){w(this,"note");w(this,"element");w(this,"data");w(this,"saves_pending");this.note=t,this.element=document.createElement("div"),this.element.classList.add("content"),t.element.append(this.element),this.element.addEventListener("keydown",s=>{s.key=="Tab"&&s.target==this.element&&(s.preventDefault(),this.insert_text(document.createTextNode("  ")))}),this.element.addEventListener("input",s=>{var o;let l=(o=window.getSelection())==null?void 0:o.focusNode;for(;!(l.classList&&l.classList.contains("content"));)l=l.parentNode;let a=je(l);a==null||a.on_input(s)}),this.data=x.getitem(e,s=>{}),this.setText(this.data.Content),this.element.contentEditable=String(this.data.Path.author==A(U)),this.element.contentEditable=="false"&&this.element.addEventListener("click",()=>{let s=new fe(this.data.Path.pub,A(U),this.data.Path.location),l=window.prompt(`to edit ${this.data.Path.author}'s note you need to make a copy`,s.tostring());console.log(l)}),this.saves_pending=!1;let n=x.get_linkstate(e);this.get_links().forEach((s,l)=>{n[l]&&!this.note.call_hist.includes(s.path)&&s.set_open(!0)}),se++,this.element.id=`C${se}`,ge.set(this.element,this)}setText(t){let e=t.split(`
`);for(let n of e)this.element.append(this.make_line(n))}get_text(){let t=[];for(let e of this.element.children)e.nodeName=="P"&&t.push(this.get_line_text(e));return t.join(`
`)}get_line_text(t){let e="";return t.childNodes.forEach(n=>{if(G(n)){let s=n;Y(s)==null?e+="":e+=s.textContent}else if(n.classList&&n.classList.contains("image")){let s=n;console.log(s==null?void 0:s.style.width),e+=`##image:${s==null?void 0:s.src}#${encodeURI(s==null?void 0:s.style.width)}`,console.log(e)}else n.classList&&n.classList.contains("youtubeplayer")?e+=n.src:(n.nodeName=="#text"||n.nodeName=="SPAN")&&(e+=n.textContent)}),e}make_line(t,e=!0){if(t==""){let a=document.createElement("p");return a.innerHTML="<br>",a}t=t.replaceAll(" ","Â "),t=t.replace(/(\S)\u00A0(\S)/g,"$1 $2");let n=t.split(/([\s+[\]{}(),])/),s=document.createElement("p"),l=[];for(let a in n){let o=Number(a),d=n[o];if(q(d)&&(!d.startsWith(".")||/\s+|Â | /.test(n[o-1])||n[o-1]==null))try{const u=new Z(d,this.note);l.push(u.element)}catch(u){console.log("failed link",d,u),l.push(this.make_word(d))}else l.push(this.make_word(d))}return l.forEach(a=>{s.appendChild(a)}),s}make_word(t){return new Text(t)}on_input(t){var d,u,h,c,g,k,r,m,y,f;if(t.type=="input"&&["Â¨"].includes(t.data))return;const e=window.getSelection(),n=e==null?void 0:e.focusNode;var s=e==null?void 0:e.focusOffset,l;if(n.nodeName=="P")l=n;else if(n.nodeName=="DIV")l=n.firstChild;else if(((d=n.parentElement)==null?void 0:d.nodeName)=="P")l=n.parentElement;else if(((h=(u=n.parentElement)==null?void 0:u.parentElement)==null?void 0:h.nodeName)=="P")l=(c=n.parentElement)==null?void 0:c.parentElement;else{this.element.childNodes.forEach(p=>{if(p.nodeName!="P"){const _=document.createElement("p");p.nodeName=="DIV"?(p.replaceWith(_),_.appendChild(p.firstChild)):(p.replaceWith(_),_.appendChild(p)),F(_,0)}});return}if(t.inputType=="insertParagraph"){const p=l.previousElementSibling;((g=p.lastChild)==null?void 0:g.textContent)==""&&((k=p.lastChild)==null||k.remove()),this.reload_line(p),(m=l.firstChild)==null||m.replaceWith((r=l.firstChild)==null?void 0:r.textContent);const _=this.reload_line(l);F(_,0);const b=p.textContent;if(b){const T=(b==null?void 0:b.length)-b.trimStart().length+(["{","[","("].includes(b.slice(-1))?2:0);T&&(this.insert_text(document.createTextNode(" ".repeat(T))),F(_,T))}return}let a=this.get_line_text(l);if(a!=""){let p=n;if(n.nodeName=="P"?(p=n.childNodes[s],s=0):((y=n.parentElement)==null?void 0:y.nodeName)=="SPAN"&&(p=n.parentElement),p==null){console.warn("prev is undefined");return}for(p=p.previousSibling;p!=null;)s+=(f=p.textContent)==null?void 0:f.length,p=p.previousSibling}else s=0;const o=this.reload_line(l,a);F(o,s),this.save_lazy()}get_links(){let t=[];return this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(n=>{if(G(n)){let s=Y(n);s&&t.push(s)}})}),t}save_linkstate(){let t=[];this.get_links().forEach(e=>t.push(e.open)),x.set_linkstate(this.note.path(),t)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}save(){this.data.Content=this.get_text(),this.saves_pending=!1,x.setitem(this.data)}reload_line(t,e){e==null&&(e=this.get_line_text(t));const n=this.make_line(e);return t.replaceWith(n),t.childNodes.forEach(s=>{if(G(s)){const l=Y(s);l==null||l.remove()}}),n}insert_text(t){const e=window.getSelection();e.deleteFromDocument(),e.getRangeAt(0).insertNode(t),t.parentElement instanceof HTMLBRElement&&(t.parentElement.replaceWith(t),console.log("replaced br")),e.collapseToEnd();const n=document.createRange();n.selectNodeContents(t),n.collapse(!1);const s=window.getSelection();s.removeAllRanges(),s.addRange(n)}set_editable(t){A(U)==this.data.Path.author&&(t?(this.element.contentEditable="true",this.element.focus()):this.element.contentEditable="false")}}function je(i){return ge.get(i)}function G(i){return i instanceof HTMLElement&&i.classList.contains("link")}function F(i,t){var s,l;let e=i.firstChild;for(;t>((s=e==null?void 0:e.textContent)==null?void 0:s.length);)t-=(l=e==null?void 0:e.textContent)==null?void 0:l.length,e=e==null?void 0:e.nextSibling;let n=null;return e!=null&&(e.nodeName=="SPAN"?(n=e,e=e.firstChild):n=e),Oe(e,t),n}function Oe(i,t){var e=document.createRange(),n=window.getSelection();try{e.setStart(i,t),e.collapse(!0)}catch{}n!=null&&(n.removeAllRanges(),n.addRange(e))}function Fe(i,t){i.preventDefault();let e=document.createElement("div");e.style.position="fixed",e.style.top=i.pageY-window.scrollY+"px",e.style.left=i.pageX+"px",e.style.backgroundColor="var(--focus)",e.style.border="2px solid grey",e.style.padding=".5em",e.style.cursor="pointer";{const s=[{tag:"share link",fn:async l=>{await navigator.clipboard.writeText(location.origin+"?"+t.path().tostring().replace("#","")),l.textContent="copied."}},{tag:`expand note ${t.path().tostring()}`,fn:async l=>{window.location.search=t.path().tostring().replace("#","")}}];for(let{tag:l,fn:a}of s){let o=document.createElement("p");o.textContent=l,o.addEventListener("click",d=>a(o)),o.style.padding=".2em",e.append(o)}}let n=document.querySelector("#page");n==null||n.appendChild(e),window.addEventListener("click",()=>e.remove()),e.addEventListener("mouseleave",()=>e.remove())}class _e extends ${constructor(e,n){super(e,n);w(this,"outfield");this.element.classList.add("js"),this.element.spellcheck=!1;let s=document.createElement("div");s.classList.add("runbutton"),s.textContent="â–¶",s.addEventListener("click",l=>this.execute()),this.element.addEventListener("keydown",l=>{console.log(l),l.ctrlKey&&l.key=="Enter"&&this.execute()}),this.element.parentElement.append(s),this.outfield=document.createElement("div"),this.outfield.classList.add("content"),this.element.parentElement.append(this.outfield)}make_word(e){let n=new Text(e);return ze.forEach(s=>{s.pattern(e)&&(n=document.createElement("span"),n.textContent=e,n.style.color=s.color)}),n}async get_flat_text(e,n){e=e.replaceAll(/print\s*\(/g,"print(");const s=e.split(`
`);let l=[];return[(await Promise.all(s.map(async(o,d)=>{if(/print\s*\(/.test(o)&&(o=o.replaceAll(/print\s*\(/g,`print('${n.data.Path.tostring()}:${d+1}',`)),o.trimStart().startsWith("//"))return;let u=o.split(/([\s+[\]{}(),])/);return(await Promise.all(u.map(async(h,c)=>{if(q(h)&&(!h.startsWith(".")||/\s+|Â | /.test(u[c-1])||u[c-1]==null)){const g=new Z(h,n.note,!0),k=g.path.tostring().replaceAll(".","$").replaceAll(":","$$$$").replace("#","");return l.push([k,g]),k}return h}))).join("")}))).filter(o=>!(o!=null&&o.startsWith("//"))).join(`
`),l]}async get_content_text(e,n,s){const l=(await x.getitemblocking(n)).Content;let[a,o]=await this.get_flat_text(l,e);for(let[d,u]of o)if(!s.vars.has(d)){s.vars.add(d);const h=new H(u.path,u),c=await this.get_content_text(h.content,u.path,s);s.values.push([d,c])}return a}async execute(){this.save(),this.outfield.innerHTML="",window.print=(...s)=>{this.print(...s)};let e={vars:new Set,values:new Array},n=await this.get_content_text(this,this.data.Path,e);console.log(e),console.log(n);try{let l=Function(n)();console.log(l),this.print(l)}catch(s){console.error(s)}}print(...e){let n=e[0];e=e.slice(1);let s=document.createElement("p");if(n!=null){let l=new Z(n,this.note);l.element.style.float="right",s.append(l.element)}for(let l of e)s.append(ye(l)),s.append(document.createTextNode(" "));this.outfield.append(s)}}let Ue=["abstract","arguments","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function ye(i){console.log("parse",i);let t=s=>["string","number","boolean","symbol","undefined","function"].includes(typeof s)||s==null,e=document.createElement("span"),n=i.constructor.name;if(t(i)){["number","boolean"].includes(typeof i)&&(e.style.color="orange");let s=String(i);e.textContent=s}else{let s=function(){l=!0,a=document.createElement("p"),a.style.paddingLeft="2em",e.append(a);for(let u of Object.keys(i))a.append(u,": "),a.append(ye(i[u])),a.append(document.createElement("br"))};n+=` [${Object.keys(i).length}]`,e.style.color="var(--blue)",e.style.cursor="pointer";let l=!1,a;e.addEventListener("click",u=>{if(u.target==e){if(l){a==null||a.remove(),l=!1;return}s()}});let o=[];for(let u of Object.keys(i)){if(o.length>3){o.push("...");break}let h="";i instanceof Array||(h+=u+": "),h+=i[u],o.push(h)}let d=document.createElement("span");d.textContent=o.join(", "),d.style.color="var(--color)",e.textContent=n+" ",e.append(d)}return e}const ze=[{pattern:i=>/[\[\]{}()]/.test(i),color:"yellow"},{pattern:i=>Ue.includes(i),color:"lightblue"},{pattern:i=>!isNaN(parseFloat(i)),color:"orange"},{pattern:i=>/^"(.*)"/.test(i),color:"orange"}];let z,I=null,B=(...i)=>{I==null||I.print(...i)};async function Ve(){console.log("python setup..."),B("python setup ..."),await Ie(()=>import("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"),[],import.meta.url),z=await loadPyodide({stdout:B}),I.outfield.innerHTML=""}async function we(i){if(console.log("run python"),z==null)return await Ve(),we(i);let e=i.split(`
`).filter(s=>/^\%pip\s*install/.test(s)).map(s=>s.split(/^\%pip\s*install/)[1].trim());for(let s of e)await z.loadPackage(s);return i=i.replace(/^\%pip\s*install\s*.*/,""),z.runPython(i)}let Ke=["False","await","else","import","pass","None","break","except","in","raise","True","class","finally","is","return","and","continue","for","lambda","try","as","def","from","nonlocal","while","assert","del","global","not","with","async","elif","if","or","yield"];const qe=[{pattern:i=>/[\[\]{}()]/.test(i),color:"yellow"},{pattern:i=>Ke.includes(i),color:"lightblue"},{pattern:i=>!isNaN(parseFloat(i)),color:"orange"},{pattern:i=>/^"(.*)"/.test(i),color:"orange"}];function Be(i){let t=new Text(i);return qe.forEach(e=>{e.pattern(i)&&(t=document.createElement("span"),t.textContent=i,t.style.color=e.color)}),t}class Je extends _e{async execute(){this.outfield.innerHTML="";let t=this.get_text();I=this,t=t.replaceAll("Â "," "),we(t).catch(e=>{console.log(e),this.handle_error(e)}).then(e=>{B(e)})}handle_error(t){let e=t.stack.split(`
`);console.log(e),e.filter(n=>n.startsWith('  File "<exec>", line')||!n.startsWith(" ")&&!n.startsWith("PythonError:")).map(n=>B(n))}on_input(t){super.on_input(t)}make_word(t){return Be(t)}print(...t){let e=document.createElement("p");for(let n of t)e.textContent+=String(n);this.outfield.append(e)}}var Ye=i=>new Promise((t,e)=>{console.log("rename_note",i);const n=document.createElement("div");n.classList.add("bg"),n.addEventListener("click",h=>{h.target==n&&(n.remove(),e())}),document.querySelector("#page").appendChild(n);const s=document.createElement("div");s.classList.add("container"),n.appendChild(s);const l=document.createElement("h2");l.innerHTML="rename note";const a=document.createElement("input");a.value=i.tostring();const o=document.createElement("p"),d=()=>{const h=W(a.value);h!=i?(t(h),n.remove()):o.innerHTML="invalid name"};a.addEventListener("keyup",h=>{h.key=="Enter"&&d()});const u=document.createElement("button");u.innerHTML="rename",u.onclick=()=>d(),s.appendChild(l),s.appendChild(a),s.appendChild(o),s.appendChild(document.createElement("br")),s.appendChild(u)});class H{constructor(t,e){w(this,"creator");w(this,"element");w(this,"head");w(this,"content");w(this,"language");w(this,"call_hist",[]);this.path=()=>t,this.creator=e,this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new le(this,t),this.element.append(this.head.element),this.language=t.get_language(),this.language=="txt"?this.content=new $(this,t):this.language=="js"?this.content=new _e(this,t):this.language=="py"?this.content=new Je(this,t):this.content=new $(this,t),e&&(this.call_hist=e.parent.call_hist.concat(e.parent.path()))}path(){return this.content.data.Path}remove(){this.content.save(),this.content.save_linkstate(),this.element.remove()}create_child(t,e){return new H(t,e)}rename(t){var s,l,a;let e=x.getitem(t,o=>{this.content.data.id=o.id,this.content.save()});this.content.data.Path=t,this.content.data.id=e.id,(s=this.creator)==null||s.set_path(t);let n=new le(this,t);(l=this.head)==null||l.element.replaceWith(n.element),this.head=n,(a=this.creator)==null||a.parent.content.save()}}class le{constructor(t,e){w(this,"note");w(this,"element");this.note=t,this.element=document.createElement("div"),this.element.classList.add("head"),this.element.contentEditable="false";let n=document.createElement("h2"),s;this.note.creator?s=e.title_string(this.note.creator.parent.path()):s=e.title_string(),n.textContent=s,this.element.append(n),this.note.element.append(this.element),this.element.addEventListener("click",l=>{Ye(this.note.content.data.Path).then(a=>{a&&this.note.rename(a)}).catch(()=>{})}),this.element.addEventListener("contextmenu",l=>{Fe(l,this.note)})}}var V=new Map,X=[],ee=!1;function Ge(){for(let i=0;i<localStorage.length;i++){const t=localStorage.key(i);try{const e=JSON.parse(t);e.location&&Xe(e)}catch{}}}function Xe(i){const t=(i.pub?"":"_")+i.location.join(".")+":"+i.author,e=V.size;V.set(t,i),e!=V.size&&(ee=!0)}function Qe(){return ee&&(X=Array.from(V),X.sort((i,t)=>i[0].localeCompare(t[0])),ee=!1),X}function Ze(){const i=prompt("enter openai key");i&&We.set(i)}const $e={tags:["openai","ai","gpt"],rep:"âš™ï¸ add openai key",executor:Ze};function ve(i,t){return typeof i=="string"?i.startsWith(t):typeof i=="function"?i(t):i.reduce((e,n)=>e||ve(n,t),!1)}let et=[{tags:["lightmode","darkmode"],rep:"âš™ï¸ switch lightmode",executor:()=>{Q.set(!A(Q))}},{tags:["account","login","signup","sign in","log out","sign out","user account"],rep:"âš™ï¸ account settings",executor:()=>{window.location.pathname="login"}},$e],ke;function tt(){let i=Qe().map(t=>{const e=decodeURI(t[0]).replaceAll("_"," ").trimStart(),n=(t[1].pub?"ðŸ“ƒ ":"ðŸ”’ ")+e.replace(":"," by ");return{tags:e,rep:n,executor:()=>{const l=new fe(t[1].pub,t[1].author,t[1].location).tostring();window.location.search=l.replace("#",""),O.update(a=>(a[n]=Date.now(),a)),console.log(A(O))}}}).sort((t,e)=>(A(O)[e.rep]??0)-(A(O)[t.rep]??0));ke=et.concat(...i)}function nt(i,t=10){return ke.filter(n=>ve(n.tags,i)).slice(0,t)}function ae(i,t,e){const n=i.slice();return n[11]=t[e],n[13]=e,n}function it(i){let t,e,n,s;return{c(){t=P("button"),e=R("âš™ï¸Ž"),this.h()},l(l){t=N(l,"BUTTON",{id:!0});var a=S(t);e=j(a,"âš™ï¸Ž"),a.forEach(v),this.h()},h(){C(t,"id","search_btn")},m(l,a){L(l,t,a),E(t,e),n||(s=J(t,"click",i[7]),n=!0)},p:K,d(l){l&&v(t),n=!1,s()}}}function st(i){let t,e,n,s;return{c(){t=P("span"),e=R(">> Cmd + P"),this.h()},l(l){t=N(l,"SPAN",{id:!0});var a=S(t);e=j(a,">> Cmd + P"),a.forEach(v),this.h()},h(){C(t,"id","search_btn")},m(l,a){L(l,t,a),E(t,e),n||(s=J(t,"click",i[6]),n=!0)},p:K,d(l){l&&v(t),n=!1,s()}}}function oe(i){let t,e=(typeof i[11].rep=="string"?i[11].rep:i[11].rep(i[2]))+"",n,s,l,a,o,d;function u(){return i[10](i[11])}return{c(){t=P("p"),n=R(e),l=M(),a=P("br"),this.h()},l(h){t=N(h,"P",{class:!0});var c=S(t);n=j(c,e),c.forEach(v),l=D(h),a=N(h,"BR",{}),this.h()},h(){C(t,"class",s=i[13]==i[4]?"highlighted":"")},m(h,c){L(h,t,c),E(t,n),L(h,l,c),L(h,a,c),o||(d=J(t,"click",u),o=!0)},p(h,c){i=h,c&12&&e!==(e=(typeof i[11].rep=="string"?i[11].rep:i[11].rep(i[2]))+"")&&ue(n,e),c&16&&s!==(s=i[13]==i[4]?"highlighted":"")&&C(t,"class",s)},d(h){h&&v(t),h&&v(l),h&&v(a),o=!1,d()}}}function lt(i){let t,e,n,s,l,a,o,d,u,h,c;function g(f,p){return f[5]?st:it}let k=g(i),r=k(i),m=i[3],y=[];for(let f=0;f<m.length;f+=1)y[f]=oe(ae(i,m,f));return{c(){r.c(),t=M(),e=P("div"),n=P("p"),s=R(re),l=M(),a=P("input"),o=M(),d=P("div");for(let f=0;f<y.length;f+=1)y[f].c();this.h()},l(f){r.l(f),t=D(f),e=N(f,"DIV",{class:!0});var p=S(e);n=N(p,"P",{id:!0});var _=S(n);s=j(_,re),_.forEach(v),l=D(p),a=N(p,"INPUT",{placeholder:!0,type:!0}),o=D(p),d=N(p,"DIV",{class:!0});var b=S(d);for(let T=0;T<y.length;T+=1)y[T].l(b);b.forEach(v),p.forEach(v),this.h()},h(){C(n,"id","searchsuggestion"),C(a,"placeholder","search..."),C(a,"type","text"),C(d,"class","results"),C(e,"class","searchbar"),e.hidden=u=!i[0]},m(f,p){r.m(f,p),L(f,t,p),L(f,e,p),E(e,n),E(n,s),E(e,l),E(e,a),i[8](a),te(a,i[2]),E(e,o),E(e,d);for(let _=0;_<y.length;_+=1)y[_].m(d,null);h||(c=J(a,"input",i[9]),h=!0)},p(f,[p]){if(k===(k=g(f))&&r?r.p(f,p):(r.d(1),r=k(f),r&&(r.c(),r.m(t.parentNode,t))),p&4&&a.value!==f[2]&&te(a,f[2]),p&28){m=f[3];let _;for(_=0;_<m.length;_+=1){const b=ae(f,m,_);y[_]?y[_].p(b,p):(y[_]=oe(b),y[_].c(),y[_].m(d,null))}for(;_<y.length;_+=1)y[_].d(1);y.length=m.length}p&1&&u!==(u=!f[0])&&(e.hidden=u)},i:K,o:K,d(f){r.d(f),f&&v(t),f&&v(e),i[8](null),Ce(y,f),h=!1,c()}}}let re="";function at(i,t,e){let n=!1,s="",l=[],a=0;window.addEventListener("keydown",r=>{r.key=="p"?r.metaKey&&(r.preventDefault(),e(0,n=!0)):r.key=="Escape"&&e(0,n=!1)}),window.addEventListener("keyup",r=>{if(n&&!(r.key=="Meta"||r.key=="Escape"))if(r.key=="ArrowUp")e(4,a=Math.max(a-1,0));else if(r.key=="ArrowDown")e(4,a=Math.min(a+1,l.length-1));else if(r.key=="Tab"){r.preventDefault();let m=l[a].tags;typeof m=="string"&&(m=m.split(":")[0],m=m.split(".").slice(0,s.split(".").length).join("."),e(2,s=m),o.focus())}else if(r.key=="Enter")l[a].executor(s);else{if(s==""){e(3,l=[]);return}e(4,a=0),e(3,l=nt(s)),l.length==0&&e(3,l=[{tags:m=>!0,rep:m=>`âš™ï¸ create Page: ${m}`,executor:m=>{const y=new H(W("#"+m));x.setitem(y.content.data),window.location.search=m}},{tags:m=>!0,rep:m=>`âš™ï¸ create secret Page: ${m}`,executor:m=>{const y=new H(W("_"+m));x.setitem(y.content.data),window.location.search="_"+m}}]),l[0]}}),window.addEventListener("click",r=>{r.target.id!="search_btn"&&(e(0,n=!1),e(5,d=!1))});let o,d=!1;const u=()=>{e(5,d=!1),e(0,n=!0)},h=r=>{e(5,d=!0)};function c(r){Le[r?"unshift":"push"](()=>{o=r,e(1,o)})}function g(){s=this.value,e(2,s)}const k=r=>{r.executor(s)};return i.$$.update=()=>{i.$$.dirty&3&&n&&(tt(),pe().then(()=>{o.focus()}))},[n,o,s,l,a,d,u,h,c,g,k]}class ot extends ce{constructor(t){super(),he(this,t,at,lt,de,{})}}function rt(i){let t,e,n,s,l,a=i[1]?"":"offline",o,d,u,h;return t=new ot({}),{c(){xe(t.$$.fragment),e=M(),n=P("h2"),s=new Pe(!1),l=M(),o=R(a),d=M(),u=P("div"),this.h()},l(c){Ne(t.$$.fragment,c),e=D(c),n=N(c,"H2",{id:!0});var g=S(n);s=Se(g,!1),l=D(g),o=j(g,a),g.forEach(v),d=D(c),u=N(c,"DIV",{id:!0});var k=S(u);k.forEach(v),this.h()},h(){s.a=l,C(n,"id","fullheader"),C(u,"id","page")},m(c,g){Te(t,c,g),L(c,e,g),L(c,n,g),s.m(i[0],n),E(n,l),E(n,o),L(c,d,g),L(c,u,g),h=!0},p(c,[g]){(!h||g&1)&&s.p(c[0]),(!h||g&2)&&a!==(a=c[1]?"":"offline")&&ue(o,a)},i(c){h||(Ae(t.$$.fragment,c),h=!0)},o(c){Me(t.$$.fragment,c),h=!1},d(c){De(t,c),c&&v(e),c&&v(n),c&&v(d),c&&v(u)}}}function ct(i,t,e){let n,s;ne(i,U,r=>e(8,n=r)),ne(i,He,r=>e(1,s=r));let{data:l}=t;document.title=window.location.hostname;var a,o="<br>";a=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,o=a,pe().then(k);let d;const u=`Click me and write something: xzxysl ... &^

You can create a new link with # followed by text, for example: #link #recursion #whatever

Click on a link to open a page. If the page already exists, it will be displayed to you.

Almost forgot! Create an account: {}/login, and then you can create public pages.

If you want to learn more, check out: #sciepedia:kormann
`;let h,c;n[0];let g={path:"_home:"+n};async function k(){Ge(),window.fetch=l.fetch,Q.subscribe(p=>{p?document.body.classList.add("light"):document.body.classList.remove("light")}),d=document.createElement("div"),d.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",d.id="pred",a=`<a href=/ onclick="setTimeout(()=>{window.location.href='${window.origin}'})" id=homebtn>sciepedia</a>`,e(0,o=a);let r=window.location.search;c=[W(g.path)],r&&r.length>1&&(r=decodeURI(r.slice(1)),q(r)||(r="#"+r),console.log("searching:",r),q(r)&&(c.push(c[0]),g.path=r)),h=document.querySelector("#page");const m=W("_tutorial:"+n);x.has(m)||x.setitem({Path:m,Content:u.replace("{}",window.location.origin),id:crypto.randomUUID()});let y=W(g.path);if(!x.has(y)){const p={Path:y,Content:`welcome to #sciepedia:kormann
if you're new try out the tutorial: _tutorial`,id:crypto.randomUUID()};localStorage[JSON.stringify(p.Path)]=JSON.stringify(p)}let f=new H(y);h.appendChild(f.element),window.addEventListener("onunload",p=>{localStorage.unloading=!0,f.remove(),localStorage.unloaded=!0})}return i.$$set=r=>{"data"in r&&e(2,l=r.data)},[o,s,l]}class mt extends ce{constructor(t){super(),he(this,t,ct,rt,de,{data:2})}}export{mt as component,ft as universal};
