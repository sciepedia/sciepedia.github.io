var Ee=Object.defineProperty;var Le=(i,n,e)=>n in i?Ee(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e;var y=(i,n,e)=>(Le(i,typeof n!="symbol"?n+"":n,e),e);import{J as W,S as ce,i as de,s as he,a as D,k as T,q as j,c as M,l as P,m as S,r as U,h as k,n as L,b as C,G as E,K as ne,L as J,H as V,M as Ce,t as pe,u as ue,w as xe,y as Ne,N as Te,z as Pe,O as Se,A as De,g as Me,d as Ae,B as He,I as se}from"../chunks/index.393b6558.js";import{u as We,s as x,i as O,a as Ie,b as Re,m as ze,c as Oe,d as X,P as me,g as A,e as je,o as Ue,f as F,l as Q,h as Fe}from"../chunks/data_store.a6111d2b.js";import{_ as qe}from"../chunks/preload-helper.41c905a7.js";function Ve({fetch:i,params:n}){return{fetch:i}}const Ct=Object.freeze(Object.defineProperty({__proto__:null,load:Ve},Symbol.toStringTag,{value:"Module"}));function Be(i,n){i.preventDefault();let e=document.createElement("div");e.style.position="fixed",e.style.top=i.pageY-window.scrollY+"px",e.style.left=i.pageX+"px",e.style.backgroundColor="var(--focus)",e.style.border="2px solid grey",e.style.padding=".5em",e.style.cursor="pointer";{const s=[{tag:"share link",fn:async l=>{await navigator.clipboard.writeText(location.origin+"?"+n.path().tostring().replace("#","")),l.textContent="copied."}},{tag:`expand note ${n.path().tostring()}`,fn:async l=>{window.location.search=n.path().tostring().replace("#","")}}];for(let{tag:l,fn:a}of s){let o=document.createElement("p");o.textContent=l,o.addEventListener("click",c=>a(o)),o.style.padding=".2em",e.append(o)}}let t=document.querySelector("#page");t==null||t.appendChild(e),window.addEventListener("click",()=>e.remove()),e.addEventListener("mouseleave",()=>e.remove())}let fe=new WeakMap,ie=0;function Z(i){return fe.get(i)}class B{constructor(n,e,t=!1){y(this,"name","");y(this,"parent");y(this,"element");y(this,"open");y(this,"child");y(this,"path");y(this,"linenumber",null);const s=n.split(".");let l=s[s.length-1];/^[0-9]+$/.test(l)&&(this.linenumber=+l),this.name=n,this.parent=e,this.element=document.createElement("span"),this.element.textContent=n,this.element.classList.add("link"),this.element.spellcheck=!1,this.open=t,this.element.addEventListener("click",()=>{this.set_open(!this.open),this.parent.content.save_linkstate()}),ie++,this.element.id=`L${ie}`,fe.set(this.element,this),this.path=this.parent.path().create_child(this.name)}set_path(n){console.log("renaming link to",n.tostring(),this.parent.path().tostring()),this.path=n,this.name=n.relative_path_string(this.parent.path()),this.element.textContent=this.name}set_collapsed(n){this.open||this.path.get_language()!="txt"||(n?this.element.textContent=this.path.collapsed_link_name(this.parent.path()):this.element.textContent=this.name)}remove(){var n;(n=this.child)==null||n.remove()}set_open(n){if(n!=this.open){if(this.element.classList.toggle("open"),n){this.set_collapsed(!1);let e=this.element.parentElement;if(this.child=this.parent.create_child(this.path,this),e.append(this.child.element),this.linenumber!=null){console.log(this.linenumber);let t=this.child.content.element.childNodes.item(this.linenumber-1);t.style.background="var(--focus)"}}else this.child.remove();this.open=n}}}class ge{constructor(n){y(this,"element");y(this,"editable");let e=n.split("#");console.log(n);let t=decodeURI(e[1]);n=e[0],this.editable=!1,this.element=document.createElement("img"),this.element.classList.add("image"),this.element.src=n,this.element.style.width=t,document.addEventListener("click",s=>{s.target!=this.element&&s.target!=this.element.parentElement&&this.set_sizable(!1)}),this.element.addEventListener("dblclick",()=>{this.set_sizable(!0)})}set_sizable(n){var e;if(n){let t=document.createElement("div");this.element.replaceWith(t),t.style.width=this.element.style.width,this.element.style.width="100%",t.appendChild(this.element),t.style.resize="both",t.style.overflow="auto",t.style.border="2px solid white"}else if(this.editable){let t=this.element.width;this.element.style.width=`min(${t}px, 100%)`,(e=this.element.parentElement)==null||e.replaceWith(this.element)}this.editable=n}}function Ke(i){console.log("create image",i);const n=new ge("");return We(crypto.randomUUID(),i).then(e=>n.element.src=e),n}class _e{constructor(n){y(this,"note");y(this,"element");y(this,"data");y(this,"saves_pending");this.note=n,this.element=document.createElement("div"),this.element.classList.add("content"),n.element.append(this.element),this.data=x.getitem(n.path(),e=>{this.set_data(e)}),this.set_data(this.data),le++,this.element.id=`C${le}`,we.set(this.element,this),this.saves_pending=!1}set_data(n){throw"not implemented"}on_input(n){}get_text(){let n=[];for(let e of this.element.children)e.nodeName=="P"&&n.push(this.get_line_text(e));return n.join(`
`)}save(){this.data.Content=this.get_text(),this.saves_pending=!1,x.setitem(this.data)}save_linkstate(){let n=[];this.get_links().forEach(e=>n.push(e.open)),x.set_linkstate(this.note.path(),n)}save_lazy(){this.saves_pending||(this.saves_pending=!0,setTimeout(()=>{this.saves_pending&&this.save()},1e3))}get_links(){let n=[];return this.element.childNodes.forEach(e=>{e.nodeName=="P"&&e.childNodes.forEach(t=>{if($(t)){let s=Z(t);s&&n.push(s)}})}),n}get_line_text(n){let e="";return n.childNodes.forEach(t=>{if($(t)){let s=t;Z(s)==null?e+="":e+=s.textContent}else if(t.classList&&t.classList.contains("image")){let s=t;console.log(s==null?void 0:s.style.width),e+=`##image:${s==null?void 0:s.src}#${encodeURI(s==null?void 0:s.style.width)}`,console.log(e)}else t.classList&&t.classList.contains("youtubeplayer")?e+=t.src:(t.nodeName=="#text"||t.nodeName=="SPAN")&&(e+=t.textContent)}),e}make_word(n){return new Text(n)}make_line(n,e=!0){if(n==""){let a=document.createElement("p");return a.innerHTML="<br>",a}n=n.replaceAll(" "," "),n=n.replace(/(\S)\u00A0(\S)/g,"$1 $2");let t=n.split(/([\s+[\]{}(),])/),s=document.createElement("p"),l=[];for(let a in t){let o=t[a];if(O(o)&&(!o.startsWith(".")||/\s+| | /.test(t[+a-1])||t[+a-1]==null))try{const c=new B(o,this.note);l.push(c.element)}catch(c){console.log("failed link",o,c),l.push(this.make_word(o))}else if(Ie(o))Re(o)?l.push(ze(o)):l.push(Oe(o));else if(o.startsWith("##image:")){const c=new ge(n.slice(8));l.push(c.element);break}else l.push(this.make_word(o))}return l.forEach(a=>{s.appendChild(a)}),s}}let we=new WeakMap,le=0;function $(i){return i instanceof HTMLElement&&i.classList.contains("link")}function Je(i){return we.get(i)}function I(i,n){var s,l;let e=i.firstChild;for(;n>((s=e==null?void 0:e.textContent)==null?void 0:s.length);)n-=(l=e==null?void 0:e.textContent)==null?void 0:l.length,e=e==null?void 0:e.nextSibling;let t=null;return e!=null&&(e.nodeName=="SPAN"?(t=e,e=e.firstChild):t=e),Ye(e,n),t}function Ye(i,n){var e=document.createRange(),t=window.getSelection();try{e.setStart(i,n),e.collapse(!0)}catch{}t!=null&&(t.removeAllRanges(),t.addRange(e))}class Ge extends _e{constructor(e){var h;super(e);y(this,"table");y(this,"rows");y(this,"columns");this.element.innerHTML="",this.element.contentEditable="false",this.element.style.padding="0";let t=document.createElement("div"),s=document.createElement("div");(h=this.note.head)==null||h.element.remove(),t.classList.add("tablecontainer"),s.classList.add("supercontainer"),this.table=document.createElement("table"),this.table.classList.add("tablecontent");let l=this.data.Content.split(`
`).map(r=>this.make_line(r,!0));console.log("creating table",this.data.Content),this.table.append(...l),this.rows=this.table.childNodes.length,this.columns=this.table.childNodes[0].childNodes.length,this.element.innerHTML="",this.element.replaceWith(s),this.element=s;const a=document.createElement("tr");for(var o=0;o<this.columns;o++)o==0?a.append(document.createElement("span")):a.append(this.removecolumn(this.table,o));this.table.prepend(a),s.append(t),t.append(this.table);const c=document.createElement("button");c.addEventListener("click",r=>{this.table.childNodes.forEach((f,_)=>{let d;_==0?d=this.removecolumn(this.table,this.columns):(d=document.createElement("td"),d.append(super.make_line("")),console.log(d)),f.appendChild(d)}),this.columns++}),c.classList.add("newcolumn"),c.innerHTML="+",t.appendChild(c);const p=document.createElement("button");p.addEventListener("click",r=>{this.table.insertRow(-1).replaceWith(this.make_line(",".repeat(this.columns-2)))}),p.innerHTML="+",p.classList.add("newrow"),s.append(p),this.element.addEventListener("click",r=>{var _;let f=r.target;if(f.nodeName!="BUTTON"&&(f.nodeName=="TD"||((_=f.parentNode)==null?void 0:_.nodeName)=="TD")){let d=r.target.nodeName=="TD"?r.target:r.target.parentNode;d.contentEditable="true";let m=d.querySelector("p");if([m,m.parentElement].includes(document.activeElement))return;m.focus(),I(m,this.get_line_text(m).length)}}),this.element.addEventListener("input",r=>{var f;(r.target.nodeName=="TD"||((f=r.target.parentNode)==null?void 0:f.nodeName)=="TD")&&this.on_input(r)})}set_data(e){}removecolumn(e,t){let s=document.createElement("td"),l=document.createElement("span");return l.innerHTML="-",l.addEventListener("click",a=>{console.log("remove col",t),e.childNodes.forEach((o,c)=>o.childNodes[t].remove())}),this.save_lazy(),l.style.width="100%",s.style.padding="0",s.append(l),s.classList.add("removecolumn"),s.style.border="unset",s}make_line(e,t){const s=document.createElement("tr");s.append(this.removerow(s));for(let l of e.split(",")){let a=document.createElement("td");a.append(super.make_line(l)),s.append(a)}return s}removerow(e){let t=document.createElement("button");return t.innerHTML="-",t.addEventListener("click",()=>e.remove()),t.classList.add("removerow"),t}get_text(){const e=this.element.querySelector("table");let t="";for(let s=1;s<e.childNodes.length;s++){const l=e==null?void 0:e.childNodes[s];for(let a=1;a<l.childNodes.length;a++){const o=l.childNodes[a];console.log(o);let c=this.get_line_text(o.querySelector("p"));t+=c+","}t=t.slice(0,-1)+`
`}return t=t.slice(0,-1),console.log(t),t}async on_input(e){this.save_lazy()}}class ee extends _e{constructor(e){super(e);y(this,"on_paste",e=>{for(var t=e.target;t.nodeName!="DIV";)if(t=t.parentElement,t==null)return;if(t!=this.element)return;const s=e.clipboardData;for(var l=0;l<s.items.length;l++)if(s.items[l].type.indexOf("image")!==-1){var a=s.items[l].getAsFile();if(a){const c=Ke(a);this.insert_text(c.element)}}let o=e.clipboardData.getData("text");if(o=je(o),o.startsWith(window.location.origin)&&o.includes("?")){console.log("pasting link"),e.preventDefault();let c=o.split("?")[1];O(c)||(c="#"+c);const p=new B(c,this.note,!1);this.insert_text(p.element)}else console.log("pasting normal text",o),e.preventDefault(),this.insert_text(document.createTextNode(o)),o.includes(`
`)&&this.get_text();this.save_lazy()});this.element.addEventListener("keydown",l=>{l.key=="Tab"&&l.target==this.element&&(l.preventDefault(),this.insert_text(document.createTextNode("  ")))});function t(l){for(;!(l.classList&&l.classList.contains("content"));)l=l.parentNode;return l}this.element.addEventListener("input",l=>{var c;let a=t((c=window.getSelection())==null?void 0:c.focusNode),o=Je(a);o==null||o.on_input(l)}),this.element.addEventListener("paste",this.on_paste),this.element.contentEditable=String(this.data.Path.author==W(X)),this.element.contentEditable=="false"&&this.element.addEventListener("click",()=>{let l=new me(this.data.Path.pub,W(X),this.data.Path.location),a=window.prompt(`to edit ${this.data.Path.author}'s note you need to make a copy`,l.tostring());a!=null&&(console.log(a),this.note.rename(A(a)))});let s=x.get_linkstate(e.path());this.get_links().forEach((l,a)=>{s[a]&&!this.note.call_hist.includes(l.path)&&l.set_open(!0)})}set_data(e){this.element.innerHTML="",this.data=e,this.setText(this.data.Content)}setText(e){let t=e.split(`
`);for(let s of t)this.element.append(this.make_line(s))}on_input(e){var p,h,r,f,_,d,m,w,g,v;if(e.type=="input"&&["¨"].includes(e.data))return;const t=window.getSelection(),s=t==null?void 0:t.focusNode;var l=t==null?void 0:t.focusOffset,a;if(s.nodeName=="P")a=s;else if(s.nodeName=="DIV")a=s.firstChild;else if(((p=s.parentElement)==null?void 0:p.nodeName)=="P")a=s.parentElement;else if(((r=(h=s.parentElement)==null?void 0:h.parentElement)==null?void 0:r.nodeName)=="P")a=(f=s.parentElement)==null?void 0:f.parentElement;else{this.element.childNodes.forEach(u=>{if(u.nodeName!="P"){const b=document.createElement("p");u.nodeName=="DIV"?(u.replaceWith(b),b.appendChild(u.firstChild)):(u.replaceWith(b),b.appendChild(u)),I(b,0)}});return}if(e.inputType=="insertParagraph"){const u=a.previousElementSibling;((_=u.lastChild)==null?void 0:_.textContent)==""&&((d=u.lastChild)==null||d.remove()),this.reload_line(u),(w=a.firstChild)==null||w.replaceWith((m=a.firstChild)==null?void 0:m.textContent);const b=this.reload_line(a);I(b,0);const N=u.textContent;if(N){const Y=(N==null?void 0:N.length)-N.trimStart().length+(["{","[","("].includes(N.slice(-1))?2:0);Y&&(this.insert_text(document.createTextNode(" ".repeat(Y))),I(b,Y))}return}let o=this.get_line_text(a);if(o!=""){let u=s;if(s.nodeName=="P"?(u=s.childNodes[l],l=0):((g=s.parentElement)==null?void 0:g.nodeName)=="SPAN"&&(u=s.parentElement),u==null){console.warn("prev is undefined");return}for(u=u.previousSibling;u!=null;)l+=(v=u.textContent)==null?void 0:v.length,u=u.previousSibling}else l=0;const c=this.reload_line(a,o);I(c,l),this.save_lazy()}reload_line(e,t){t==null&&(t=this.get_line_text(e));const s=this.make_line(t);return e.replaceWith(s),e.childNodes.forEach(l=>{if($(l)){const a=Z(l);a==null||a.remove()}}),s}insert_text(e){const t=window.getSelection();t.deleteFromDocument(),t.getRangeAt(0).insertNode(e),e.parentElement instanceof HTMLBRElement&&(e.parentElement.replaceWith(e),console.log("replaced br")),t.collapseToEnd();const s=document.createRange();s.selectNodeContents(e),s.collapse(!1);const l=window.getSelection();l.removeAllRanges(),l.addRange(s)}}class ye extends ee{constructor(e){super(e);y(this,"outfield");this.element.classList.add("js"),this.element.spellcheck=!1;let t=document.createElement("div");t.classList.add("runbutton"),t.textContent="▶",t.contentEditable="false",t.addEventListener("click",async s=>{t.textContent="O",await this.execute(),t.textContent="▶"}),this.element.addEventListener("keydown",s=>{console.log(s),s.ctrlKey&&s.key=="Enter"&&(t.textContent="O",console.log("start running"),this.execute(),t.textContent="▶")}),this.element.parentElement.append(t),this.outfield=document.createElement("div"),this.outfield.classList.add("content"),this.outfield.contentEditable="false",this.element.parentElement.append(this.outfield)}make_word(e){let t=new Text(e);return Qe.forEach(s=>{s.pattern(e)&&(t=document.createElement("span"),t.textContent=e,t.style.color=s.color)}),t}async get_flat_text(e,t){e=e.replaceAll(/print\s*\(/g,"print(");const s=e.split(`
`);let l=[];return[(await Promise.all(s.map(async(o,c)=>{if(/print\s*\(/.test(o)&&(o=o.replaceAll(/print\s*\(/g,`print('${t.data.Path.tostring()}:${c+1}',`)),o.trimStart().startsWith("//"))return;let p=o.split(/([\s+[\]{}(),])/);return(await Promise.all(p.map(async(h,r)=>{if(O(h)&&(!h.startsWith(".")||/\s+| | /.test(p[r-1])||p[r-1]==null)){const f=new B(h,t.note,!0),_=f.path.tostring().replaceAll(".","$").replaceAll(":","$$$$").replace("#","");return l.push([_,f]),_}return h}))).join("")}))).filter(o=>!(o!=null&&o.startsWith("//"))).join(`
`),l]}async get_content_text(e,t,s){const l=(await x.getitemblocking(t)).Content;let[a,o]=await this.get_flat_text(l,e);for(let[c,p]of o)if(!s.vars.has(c)){s.vars.add(c);const h=new H(p.path,p),r=await this.get_content_text(h.content,p.path,s);s.values.push([c,r])}return a}async execute(){this.save(),this.outfield.innerHTML="",window.print=(...s)=>{this.print(...s)},window.putout=s=>this.outfield.append(s);let e={vars:new Set,values:new Array},t=await this.get_content_text(this,this.data.Path,e);for(let[s,l]of e.values)t=`${s} = ${l};
`+t;console.log(t);try{let l=await Function(`return async()=>{${t}}`)()();console.log(l),this.print(l)}catch(s){console.error(s)}}print(...e){let t=e[0];e=e.slice(1);let s=document.createElement("p");if(t!=null){let l=new B(t,this.note);l.element.style.float="right",s.append(l.element)}for(let l of e)s.append(ve(l)),s.append(document.createTextNode(" "));this.outfield.append(s)}}let Xe=["abstract","arguments","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function ve(i){console.log("parse",i);let n=s=>["string","number","boolean","symbol","undefined","function"].includes(typeof s)||s==null,e=document.createElement("span"),t=i.constructor.name;if(n(i)){["number","boolean"].includes(typeof i)&&(e.style.color="orange");let s=String(i);e.textContent=s}else{let s=function(){l=!0,a=document.createElement("p"),a.style.paddingLeft="2em",e.append(a);for(let p of Object.keys(i))a.append(p,": "),a.append(ve(i[p])),a.append(document.createElement("br"))};t+=` [${Object.keys(i).length}]`,e.style.color="var(--blue)",e.style.cursor="pointer";let l=!1,a;e.addEventListener("click",p=>{if(p.target==e){if(l){a==null||a.remove(),l=!1;return}s()}});let o=[];for(let p of Object.keys(i)){if(o.length>3){o.push("...");break}let h="";i instanceof Array||(h+=p+": "),h+=i[p],o.push(h)}let c=document.createElement("span");c.textContent=o.join(", "),c.style.color="var(--color)",e.textContent=t+" ",e.append(c)}return e}const Qe=[{pattern:i=>/[\[\]{}()]/.test(i),color:"yellow"},{pattern:i=>Xe.includes(i),color:"lightblue"},{pattern:i=>!isNaN(parseFloat(i)),color:"orange"},{pattern:i=>/^"(.*)"/.test(i),color:"orange"}];let R,z=null,K=(...i)=>{z==null||z.print(...i)};async function Ze(){console.log("python setup..."),K("python setup ..."),await qe(()=>import("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"),[],import.meta.url),R=await loadPyodide({stdout:K}),z.outfield.innerHTML=""}async function $e(i){console.log("run python"),R==null&&await Ze(),await R.loadPackage("micropip");let n=i.split(`
`),e=n.filter(s=>/^\%pip\s*install/.test(s)).map(s=>s.split(/^\%pip\s*install/)[1].trim());for(let s of e)await R.loadPackage(s);return i=n.filter(s=>!/^\%pip\s*install/.test(s)).join(`
`),R.runPythonAsync(i)}let et=["False","await","else","import","pass","None","break","except","in","raise","True","class","finally","is","return","and","continue","for","lambda","try","as","def","from","nonlocal","while","assert","del","global","not","with","async","elif","if","or","yield"];const tt=[{pattern:i=>/[\[\]{}()]/.test(i),color:"yellow"},{pattern:i=>et.includes(i),color:"lightblue"},{pattern:i=>!isNaN(parseFloat(i)),color:"orange"},{pattern:i=>/^"(.*)"/.test(i),color:"orange"}];function nt(i){let n=new Text(i);return tt.forEach(e=>{e.pattern(i)&&(n=document.createElement("span"),n.textContent=i,n.style.color=e.color)}),n}class st extends ye{async execute(){this.outfield.innerHTML="";let n=this.get_text();z=this,n=n.replaceAll(" "," ");try{let e=await $e(n);e!=null&&K(e)}catch(e){console.log(e),this.handle_error(e)}}handle_error(n){let e=n.stack.split(`
`);console.log(e),e.filter(t=>t.startsWith('  File "<exec>", line')||!t.startsWith(" ")&&!t.startsWith("PythonError:")).map(t=>K(t))}on_input(n){super.on_input(n)}make_word(n){return nt(n)}print(...n){let e=document.createElement("p");for(let t of n)e.textContent+=String(t);this.outfield.append(e)}}var it=i=>new Promise((n,e)=>{console.log("rename_note",i);const t=document.createElement("div");t.classList.add("bg"),t.addEventListener("click",h=>{h.target==t&&(t.remove(),e())}),document.querySelector("#page").appendChild(t);const s=document.createElement("div");s.classList.add("container"),t.appendChild(s);const l=document.createElement("h2");l.innerHTML="rename note";const a=document.createElement("input");a.value=i.tostring();const o=document.createElement("p"),c=()=>{const h=A(a.value);h!=i?(n(h),t.remove()):o.innerHTML="invalid name"};a.addEventListener("keyup",h=>{h.key=="Enter"&&c()});const p=document.createElement("button");p.innerHTML="rename",p.onclick=()=>c(),s.appendChild(l),s.appendChild(a),s.appendChild(o),s.appendChild(document.createElement("br")),s.appendChild(p)});class H{constructor(n,e){y(this,"creator");y(this,"element");y(this,"head");y(this,"content");y(this,"language");y(this,"call_hist",[]);y(this,"init_path");this.init_path=n,console.log("creating note",n),this.creator=e,this.element=document.createElement("div"),this.element.classList.add("note"),this.head=new lt(this,n),this.element.append(this.head.element),this.language=n.get_language(),this.language=="txt"?this.content=new ee(this):this.language=="js"?this.content=new ye(this):this.language=="py"?this.content=new st(this):this.language=="csv"?(console.log("creating csv"),this.content=new Ge(this)):this.content=new ee(this),e&&(this.call_hist=e.parent.call_hist.concat(e.parent.path()))}path(){try{return this.content.data.Path}catch{return this.init_path}}remove(){this.content.save(),this.content.save_linkstate(),this.element.remove()}create_child(n,e){return new H(n,e)}rename(n){let e=x.getitem(n,s=>{this.content.data.id=s.id,this.content.save()});this.content.data.Path=n,this.content.data.id=e.id,this.content.get_links().forEach(s=>{s.set_path(s.path)}),this.content.save();let t=new H(this.path());this.element.replaceWith(t.element),this.creator?(this.creator.set_path(n),this.creator.child=t,this.creator.parent.content.save()):window.location.search=n.tostring().replace("#","")}}class lt{constructor(n,e){y(this,"note");y(this,"element");this.note=n,this.element=document.createElement("div"),this.element.classList.add("head"),this.element.contentEditable="false";let t=document.createElement("h2"),s;this.note.creator?s=e.title_string(this.note.creator.parent.path()):s=e.title_string(),t.textContent=s,this.element.append(t),this.note.element.append(this.element),this.element.addEventListener("click",l=>{it(this.note.content.data.Path).catch(()=>{}).then(a=>{a&&this.note.rename(a)})}),this.element.addEventListener("contextmenu",l=>{Be(l,this.note)})}}var q=new Map,G=[],te=!1;function at(){for(let i=0;i<localStorage.length;i++){const n=localStorage.key(i);try{const e=JSON.parse(n);e.location&&ot(e)}catch{}}}function ot(i){const n=(i.pub?"":"_")+i.location.join(".")+":"+i.author,e=q.size;q.set(n,i),e!=q.size&&(te=!0)}function rt(){return te&&(G=Array.from(q),G.sort((i,n)=>i[0].localeCompare(n[0])),te=!1),G}function ct(){const i=prompt("enter openai key");i&&Ue.set(i)}const dt={tags:["openai","ai","gpt"],rep:"⚙️ add openai key",executor:ct};function ke(i,n){return typeof i=="string"?i.startsWith(n):typeof i=="function"?i(n):i.reduce((e,t)=>e||ke(t,n),!1)}let ht=[{tags:["lightmode","darkmode"],rep:"⚙️ switch lightmode",executor:()=>{Q.set(!W(Q))}},{tags:["account","login","signup","sign in","log out","sign out","user account"],rep:"⚙️ account settings",executor:()=>{window.location.pathname="login"}},dt],be;function pt(){let i=rt().map(n=>{const e=decodeURI(n[0]).replaceAll("_"," ").trimStart(),t=(n[1].pub?"📃 ":"🔒 ")+e.replace(":"," by ");return{tags:e,rep:t,executor:()=>{const l=new me(n[1].pub,n[1].author,n[1].location).tostring();window.location.search=l.replace("#",""),F.update(a=>(a[t]=Date.now(),a)),console.log(W(F))}}}).sort((n,e)=>(W(F)[e.rep]??0)-(W(F)[n.rep]??0));be=ht.concat(...i)}function ut(i,n=10){return be.filter(t=>ke(t.tags,i)).slice(0,n)}function ae(i,n,e){const t=i.slice();return t[11]=n[e],t[13]=e,t}function mt(i){let n,e,t,s;return{c(){n=T("button"),e=j("⚙︎"),this.h()},l(l){n=P(l,"BUTTON",{id:!0});var a=S(n);e=U(a,"⚙︎"),a.forEach(k),this.h()},h(){L(n,"id","search_btn")},m(l,a){C(l,n,a),E(n,e),t||(s=J(n,"click",i[7]),t=!0)},p:V,d(l){l&&k(n),t=!1,s()}}}function ft(i){let n,e,t,s;return{c(){n=T("span"),e=j(">> Cmd + P"),this.h()},l(l){n=P(l,"SPAN",{id:!0});var a=S(n);e=U(a,">> Cmd + P"),a.forEach(k),this.h()},h(){L(n,"id","search_btn")},m(l,a){C(l,n,a),E(n,e),t||(s=J(n,"click",i[6]),t=!0)},p:V,d(l){l&&k(n),t=!1,s()}}}function oe(i){let n,e=(typeof i[11].rep=="string"?i[11].rep:i[11].rep(i[2]))+"",t,s,l,a,o,c;function p(){return i[10](i[11])}return{c(){n=T("p"),t=j(e),l=D(),a=T("br"),this.h()},l(h){n=P(h,"P",{class:!0});var r=S(n);t=U(r,e),r.forEach(k),l=M(h),a=P(h,"BR",{}),this.h()},h(){L(n,"class",s=i[13]==i[4]?"highlighted":"")},m(h,r){C(h,n,r),E(n,t),C(h,l,r),C(h,a,r),o||(c=J(n,"click",p),o=!0)},p(h,r){i=h,r&12&&e!==(e=(typeof i[11].rep=="string"?i[11].rep:i[11].rep(i[2]))+"")&&ue(t,e),r&16&&s!==(s=i[13]==i[4]?"highlighted":"")&&L(n,"class",s)},d(h){h&&k(n),h&&k(l),h&&k(a),o=!1,c()}}}function gt(i){let n,e,t,s,l,a,o,c,p,h,r;function f(g,v){return g[5]?ft:mt}let _=f(i),d=_(i),m=i[3],w=[];for(let g=0;g<m.length;g+=1)w[g]=oe(ae(i,m,g));return{c(){d.c(),n=D(),e=T("div"),t=T("p"),s=j(re),l=D(),a=T("input"),o=D(),c=T("div");for(let g=0;g<w.length;g+=1)w[g].c();this.h()},l(g){d.l(g),n=M(g),e=P(g,"DIV",{class:!0});var v=S(e);t=P(v,"P",{id:!0});var u=S(t);s=U(u,re),u.forEach(k),l=M(v),a=P(v,"INPUT",{placeholder:!0,type:!0}),o=M(v),c=P(v,"DIV",{class:!0});var b=S(c);for(let N=0;N<w.length;N+=1)w[N].l(b);b.forEach(k),v.forEach(k),this.h()},h(){L(t,"id","searchsuggestion"),L(a,"placeholder","search..."),L(a,"type","text"),L(c,"class","results"),L(e,"class","searchbar"),e.hidden=p=!i[0]},m(g,v){d.m(g,v),C(g,n,v),C(g,e,v),E(e,t),E(t,s),E(e,l),E(e,a),i[8](a),ne(a,i[2]),E(e,o),E(e,c);for(let u=0;u<w.length;u+=1)w[u].m(c,null);h||(r=J(a,"input",i[9]),h=!0)},p(g,[v]){if(_===(_=f(g))&&d?d.p(g,v):(d.d(1),d=_(g),d&&(d.c(),d.m(n.parentNode,n))),v&4&&a.value!==g[2]&&ne(a,g[2]),v&28){m=g[3];let u;for(u=0;u<m.length;u+=1){const b=ae(g,m,u);w[u]?w[u].p(b,v):(w[u]=oe(b),w[u].c(),w[u].m(c,null))}for(;u<w.length;u+=1)w[u].d(1);w.length=m.length}v&1&&p!==(p=!g[0])&&(e.hidden=p)},i:V,o:V,d(g){d.d(g),g&&k(n),g&&k(e),i[8](null),Ce(w,g),h=!1,r()}}}let re="";function _t(i,n,e){let t=!1,s="",l=[],a=0;window.addEventListener("keydown",d=>{d.key=="p"?d.metaKey&&(d.preventDefault(),e(0,t=!0)):d.key=="Escape"&&e(0,t=!1)}),window.addEventListener("keyup",d=>{if(t&&!(d.key=="Meta"||d.key=="Escape"))if(d.key=="ArrowUp")e(4,a=Math.max(a-1,0));else if(d.key=="ArrowDown")e(4,a=Math.min(a+1,l.length-1));else if(d.key=="Tab"){d.preventDefault();let m=l[a].tags;typeof m=="string"&&(m=m.split(":")[0],m=m.split(".").slice(0,s.split(".").length).join("."),e(2,s=m),o.focus())}else if(d.key=="Enter")l[a].executor(s);else{if(s==""){e(3,l=[]);return}e(4,a=0),e(3,l=ut(s)),l.length==0&&e(3,l=[{tags:m=>!0,rep:m=>`⚙️ create Page: ${m}`,executor:m=>{const w=new H(A("#"+m));x.setitem(w.content.data),window.location.search=m}},{tags:m=>!0,rep:m=>`⚙️ create secret Page: ${m}`,executor:m=>{const w=new H(A("_"+m));x.setitem(w.content.data),window.location.search="_"+m}}]),l[0]}}),window.addEventListener("click",d=>{d.target.id!="search_btn"&&(e(0,t=!1),e(5,c=!1))});let o,c=!1;const p=()=>{e(5,c=!1),e(0,t=!0)},h=d=>{e(5,c=!0)};function r(d){xe[d?"unshift":"push"](()=>{o=d,e(1,o)})}function f(){s=this.value,e(2,s)}const _=d=>{d.executor(s)};return i.$$.update=()=>{i.$$.dirty&3&&t&&(pt(),pe().then(()=>{o.focus()}))},[t,o,s,l,a,c,p,h,r,f,_]}class wt extends ce{constructor(n){super(),de(this,n,_t,gt,he,{})}}function yt(i){let n,e,t,s,l,a=i[1]?"":"offline",o,c,p,h;return n=new wt({}),{c(){Ne(n.$$.fragment),e=D(),t=T("h2"),s=new Te(!1),l=D(),o=j(a),c=D(),p=T("div"),this.h()},l(r){Pe(n.$$.fragment,r),e=M(r),t=P(r,"H2",{id:!0});var f=S(t);s=Se(f,!1),l=M(f),o=U(f,a),f.forEach(k),c=M(r),p=P(r,"DIV",{id:!0});var _=S(p);_.forEach(k),this.h()},h(){s.a=l,L(t,"id","fullheader"),L(p,"id","page")},m(r,f){De(n,r,f),C(r,e,f),C(r,t,f),s.m(i[0],t),E(t,l),E(t,o),C(r,c,f),C(r,p,f),h=!0},p(r,[f]){(!h||f&1)&&s.p(r[0]),(!h||f&2)&&a!==(a=r[1]?"":"offline")&&ue(o,a)},i(r){h||(Me(n.$$.fragment,r),h=!0)},o(r){Ae(n.$$.fragment,r),h=!1},d(r){He(n,r),r&&k(e),r&&k(t),r&&k(c),r&&k(p)}}}function vt(i,n,e){let t,s;se(i,X,_=>e(7,t=_)),se(i,Fe,_=>e(1,s=_));let{data:l}=n;document.title=window.location.hostname;var a,o="<br>";a=`<a href=/ onclick="window.location.href = '${window.origin}'; location.reload();" id=homebtn>sciepedia</a>`,o=a,pe().then(f);let c;const p=`Click me and write something: xzxysl ... &^

You can create a new link with # followed by text, for example: #link #recursion #whatever

Click on a link to open a page. If the page already exists, it will be displayed to you.

Almost forgot! Create an account: {}/login, and then you can create public pages.

If you want to learn more, check out: #sciepedia:kormann
`;let h,r=A("_home:"+t);async function f(){if(at(),window.fetch=l.fetch,Q.subscribe(w=>{w?document.body.classList.add("light"):document.body.classList.remove("light")}),c=document.createElement("div"),c.innerHTML="<p>this is a pred</p><p>this is a pred</p><p>this is a pred</p>",c.id="pred",a=`<a href=/ onclick="setTimeout(()=>{window.location.href='${window.origin}'})" id=homebtn>sciepedia</a>`,e(0,o=a),!x.has(r)){const w={Path:r,Content:`welcome to #sciepedia:kormann
if you're new try out the tutorial: _tutorial`,id:crypto.randomUUID()};localStorage[JSON.stringify(w.Path)]=JSON.stringify(w)}const _=A("_tutorial:"+t);x.has(_)||x.setitem({Path:_,Content:p.replace("{}",window.location.origin),id:crypto.randomUUID()});let d=window.location.search;d&&d.length>1&&(d=decodeURI(d.slice(1)),O(d)||(d="#"+d),console.log("searching:",d),O(d)&&(r=A(d))),h=document.querySelector("#page");let m=new H(r);h.appendChild(m.element),window.addEventListener("onunload",w=>{localStorage.unloading=!0,m.remove(),localStorage.unloaded=!0})}return i.$$set=_=>{"data"in _&&e(2,l=_.data)},[o,s,l]}class xt extends ce{constructor(n){super(),de(this,n,vt,yt,he,{data:2})}}export{xt as component,Ct as universal};
